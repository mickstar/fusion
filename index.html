
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Fusion API</title>

    <style media="screen">
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cpf {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s, .highlight .sa, .highlight .dl {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf, .highlight .fm {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv, .highlight .vm {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .nl {
  color: #f92672;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <style media="print">
      * {
        -webkit-transition:none!important;
        transition:none!important;
      }
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight, .highlight .w {
  color: #586e75;
}
.highlight .err {
  color: #002b36;
  background-color: #dc322f;
}
.highlight .c, .highlight .ch, .highlight .cd, .highlight .cm, .highlight .cpf, .highlight .c1, .highlight .cs {
  color: #657b83;
}
.highlight .cp {
  color: #b58900;
}
.highlight .nt {
  color: #b58900;
}
.highlight .o, .highlight .ow {
  color: #93a1a1;
}
.highlight .p, .highlight .pi {
  color: #93a1a1;
}
.highlight .gi {
  color: #859900;
}
.highlight .gd {
  color: #dc322f;
}
.highlight .gh {
  color: #268bd2;
  background-color: #002b36;
  font-weight: bold;
}
.highlight .k, .highlight .kn, .highlight .kp, .highlight .kr, .highlight .kv {
  color: #6c71c4;
}
.highlight .kc {
  color: #cb4b16;
}
.highlight .kt {
  color: #cb4b16;
}
.highlight .kd {
  color: #cb4b16;
}
.highlight .s, .highlight .sb, .highlight .sc, .highlight .dl, .highlight .sd, .highlight .s2, .highlight .sh, .highlight .sx, .highlight .s1 {
  color: #859900;
}
.highlight .sa {
  color: #6c71c4;
}
.highlight .sr {
  color: #2aa198;
}
.highlight .si {
  color: #d33682;
}
.highlight .se {
  color: #d33682;
}
.highlight .nn {
  color: #b58900;
}
.highlight .nc {
  color: #b58900;
}
.highlight .no {
  color: #b58900;
}
.highlight .na {
  color: #268bd2;
}
.highlight .m, .highlight .mb, .highlight .mf, .highlight .mh, .highlight .mi, .highlight .il, .highlight .mo, .highlight .mx {
  color: #859900;
}
.highlight .ss {
  color: #859900;
}
    </style>
    <link href="stylesheets/screen-39b62b57.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print-953e3353.css" rel="stylesheet" media="print" />
      <script src="javascripts/all-4efdf0d8.js"></script>

    <script>
      $(function() { setupCodeCopy(); });
    </script>
  </head>

  <body class="index" data-languages="[&quot;json&quot;,&quot;java&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar-cad8cdcb.png" alt="" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo-5dd9e93d.png" class="logo" alt="" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">JSON</a>
              <a href="#" data-language-name="java">Java</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#getting-started" class="toc-h1 toc-link" data-title="Getting started">Getting started</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#getting-started-create-a-test-account" class="toc-h2 toc-link" data-title="Create a test account">Create a test account</a>
					
                  </li>
                  <li>
                    <a href="#getting-started-design-your-integration" class="toc-h2 toc-link" data-title="Design your integration">Design your integration</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#getting-started-design-your-integration-payment-lifecycle" class="toc-h3 toc-link" data-title="Payment lifecycle">Payment lifecycle</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-terminal-linking" class="toc-h3 toc-link" data-title="Terminal linking">Terminal linking</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-sale-system-settings" class="toc-h3 toc-link" data-title="Sale System settings">Sale System settings</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-payment-types" class="toc-h3 toc-link" data-title="Payment types">Payment types</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-payment-identification" class="toc-h3 toc-link" data-title="Payment identification">Payment identification</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-receipt-printing" class="toc-h3 toc-link" data-title="Receipt printing">Receipt printing</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-payment-user-interface" class="toc-h3 toc-link" data-title="Payment user interface">Payment user interface</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-product-data" class="toc-h3 toc-link" data-title="Product data">Product data</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-cash-out" class="toc-h3 toc-link" data-title="Cash out">Cash out</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-settlement" class="toc-h3 toc-link" data-title="Settlement">Settlement</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-tokenisation" class="toc-h3 toc-link" data-title="Tokenisation">Tokenisation</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-split-payments" class="toc-h3 toc-link" data-title="Split payments">Split payments</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-tipping" class="toc-h3 toc-link" data-title="Tipping">Tipping</a>
						  </li>
						  <li>
							<a href="#getting-started-design-your-integration-dynamic-surcharge" class="toc-h3 toc-link" data-title="Dynamic surcharge">Dynamic surcharge</a>
						  </li>
					  </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#cloud-api-reference" class="toc-h1 toc-link" data-title="Cloud API Reference">Cloud API Reference</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#cloud-api-reference-reference-code" class="toc-h2 toc-link" data-title="Reference code">Reference code</a>
					
                  </li>
                  <li>
                    <a href="#cloud-api-reference-security-requirements" class="toc-h2 toc-link" data-title="Security requirements">Security requirements</a>
					
                  </li>
                  <li>
                    <a href="#cloud-api-reference-endpoints" class="toc-h2 toc-link" data-title="Endpoints">Endpoints</a>
					
                  </li>
                  <li>
                    <a href="#cloud-api-reference-message-format" class="toc-h2 toc-link" data-title="Message format">Message format</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#cloud-api-reference-message-format-messageheader" class="toc-h3 toc-link" data-title="MessageHeader">MessageHeader</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-message-format-payload" class="toc-h3 toc-link" data-title="Payload">Payload</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-message-format-securitytrailer" class="toc-h3 toc-link" data-title="SecurityTrailer">SecurityTrailer</a>
						  </li>
					  </ul>
                  </li>
                  <li>
                    <a href="#cloud-api-reference-perform-a-purchase" class="toc-h2 toc-link" data-title="Perform a purchase">Perform a purchase</a>
					
                  </li>
                  <li>
                    <a href="#cloud-api-reference-perform-a-refund" class="toc-h2 toc-link" data-title="Perform a refund">Perform a refund</a>
					
                  </li>
                  <li>
                    <a href="#cloud-api-reference-methods" class="toc-h2 toc-link" data-title="Methods">Methods</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#cloud-api-reference-methods-login" class="toc-h3 toc-link" data-title="Login">Login</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-logout" class="toc-h3 toc-link" data-title="Logout">Logout</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-payment" class="toc-h3 toc-link" data-title="Payment">Payment</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-display" class="toc-h3 toc-link" data-title="Display">Display</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-input" class="toc-h3 toc-link" data-title="Input">Input</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-print" class="toc-h3 toc-link" data-title="Print">Print</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-transaction-status" class="toc-h3 toc-link" data-title="Transaction status">Transaction status</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-abort-transaction" class="toc-h3 toc-link" data-title="Abort transaction">Abort transaction</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-reconciliation" class="toc-h3 toc-link" data-title="Reconciliation">Reconciliation</a>
						  </li>
						  <li>
							<a href="#cloud-api-reference-methods-card-acquisition" class="toc-h3 toc-link" data-title="Card acquisition">Card acquisition</a>
						  </li>
					  </ul>
                  </li>
                  <li>
                    <a href="#cloud-api-reference-error-handling" class="toc-h2 toc-link" data-title="Error handling">Error handling</a>
					
                  </li>
              </ul>
          </li>
          <li>
            <a href="#satellite-api-reference" class="toc-h1 toc-link" data-title="Satellite API Reference">Satellite API Reference</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#satellite-api-reference-message-format" class="toc-h2 toc-link" data-title="Message format">Message format</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#satellite-api-reference-message-format-intent-request" class="toc-h3 toc-link" data-title="Intent request">Intent request</a>
						  </li>
						  <li>
							<a href="#satellite-api-reference-message-format-intent-response" class="toc-h3 toc-link" data-title="Intent response">Intent response</a>
						  </li>
						  <li>
							<a href="#satellite-api-reference-message-format-request-response-object" class="toc-h3 toc-link" data-title="Request/response object">Request/response object</a>
						  </li>
						  <li>
							<a href="#satellite-api-reference-message-format-messageheader" class="toc-h3 toc-link" data-title="MessageHeader">MessageHeader</a>
						  </li>
						  <li>
							<a href="#satellite-api-reference-message-format-payload" class="toc-h3 toc-link" data-title="Payload">Payload</a>
						  </li>
					  </ul>
                  </li>
                  <li>
                    <a href="#satellite-api-reference-methods" class="toc-h2 toc-link" data-title="Methods">Methods</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#satellite-api-reference-methods-payment" class="toc-h3 toc-link" data-title="Payment">Payment</a>
						  </li>
					  </ul>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#data-dictionary" class="toc-h1 toc-link" data-title="Data dictionary">Data dictionary</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#data-dictionary-account" class="toc-h2 toc-link" data-title="Account">Account</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-additionalproductinfo" class="toc-h2 toc-link" data-title="AdditionalProductInfo">AdditionalProductInfo</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-additionalresponse" class="toc-h2 toc-link" data-title="AdditionalResponse">AdditionalResponse</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-algorithm" class="toc-h2 toc-link" data-title="Algorithm">Algorithm</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-allowedpaymentbrands" class="toc-h2 toc-link" data-title="AllowedPaymentBrands">AllowedPaymentBrands</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-applicationname" class="toc-h2 toc-link" data-title="ApplicationName">ApplicationName</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-cardbrand" class="toc-h2 toc-link" data-title="CardBrand">CardBrand</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-categories" class="toc-h2 toc-link" data-title="Categories">Categories</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-certificationcode" class="toc-h2 toc-link" data-title="CertificationCode">CertificationCode</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-datetime" class="toc-h2 toc-link" data-title="DateTime">DateTime</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-eanupc" class="toc-h2 toc-link" data-title="EanUpc">EanUpc</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-encrypteddata" class="toc-h2 toc-link" data-title="EncryptedData">EncryptedData</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-encryptedkey" class="toc-h2 toc-link" data-title="EncryptedKey">EncryptedKey</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-entrymode" class="toc-h2 toc-link" data-title="EntryMode">EntryMode</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-errorcondition" class="toc-h2 toc-link" data-title="ErrorCondition">ErrorCondition</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-eventtonotify" class="toc-h2 toc-link" data-title="EventToNotify">EventToNotify</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-eventdetails" class="toc-h2 toc-link" data-title="EventDetails">EventDetails</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-forceentrymode" class="toc-h2 toc-link" data-title="ForceEntryMode">ForceEntryMode</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-forceonlineflag" class="toc-h2 toc-link" data-title="ForceOnlineFlag">ForceOnlineFlag</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-infoqualify" class="toc-h2 toc-link" data-title="InfoQualify">InfoQualify</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-inputcommand" class="toc-h2 toc-link" data-title="InputCommand">InputCommand</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-itemamount" class="toc-h2 toc-link" data-title="ItemAmount">ItemAmount</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-itemid" class="toc-h2 toc-link" data-title="ItemID">ItemID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-keyidentifier" class="toc-h2 toc-link" data-title="KeyIdentifier">KeyIdentifier</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-keyversion" class="toc-h2 toc-link" data-title="KeyVersion">KeyVersion</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-mac" class="toc-h2 toc-link" data-title="MAC">MAC</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-maintenanceallowed" class="toc-h2 toc-link" data-title="MaintenanceAllowed">MaintenanceAllowed</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-maskedpan" class="toc-h2 toc-link" data-title="MaskedPAN">MaskedPAN</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-merchantcategorycode" class="toc-h2 toc-link" data-title="MerchantCategoryCode">MerchantCategoryCode</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-messageclass" class="toc-h2 toc-link" data-title="MessageClass">MessageClass</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-messagecategory" class="toc-h2 toc-link" data-title="MessageCategory">MessageCategory</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-messagetype" class="toc-h2 toc-link" data-title="MessageType">MessageType</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-operatorid" class="toc-h2 toc-link" data-title="OperatorId">OperatorId</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-originalpoitransaction" class="toc-h2 toc-link" data-title="OriginalPOITransaction">OriginalPOITransaction</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-outputformat" class="toc-h2 toc-link" data-title="OutputFormat">OutputFormat</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-outputxhtml" class="toc-h2 toc-link" data-title="OutputXHTML">OutputXHTML</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymentacquirerdata-acquirerid" class="toc-h2 toc-link" data-title="PaymentAcquirerData.AcquirerID">PaymentAcquirerData.AcquirerID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymentbrand" class="toc-h2 toc-link" data-title="PaymentBrand">PaymentBrand</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymentcurrency" class="toc-h2 toc-link" data-title="PaymentCurrency">PaymentCurrency</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymenttransaction-transactionconditions-acquirerid" class="toc-h2 toc-link" data-title="PaymentTransaction.TransactionConditions.AcquirerID">PaymentTransaction.TransactionConditions.AcquirerID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymenttype" class="toc-h2 toc-link" data-title="PaymentType">PaymentType</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-poiid" class="toc-h2 toc-link" data-title="POIID">POIID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-poireconciliationid" class="toc-h2 toc-link" data-title="POIReconciliationID">POIReconciliationID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-poiserialnumber" class="toc-h2 toc-link" data-title="POISerialNumber">POISerialNumber</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-poitransactionid" class="toc-h2 toc-link" data-title="POITransactionID">POITransactionID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-productcode" class="toc-h2 toc-link" data-title="ProductCode">ProductCode</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-protocolversion" class="toc-h2 toc-link" data-title="ProtocolVersion">ProtocolVersion</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-provideridentification" class="toc-h2 toc-link" data-title="ProviderIdentification">ProviderIdentification</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymentinstrumentdata" class="toc-h2 toc-link" data-title="PaymentInstrumentData">PaymentInstrumentData</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymentinstrumenttype" class="toc-h2 toc-link" data-title="PaymentInstrumentType">PaymentInstrumentType</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-paymenttoken" class="toc-h2 toc-link" data-title="PaymentToken">PaymentToken</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-productlabel" class="toc-h2 toc-link" data-title="ProductLabel">ProductLabel</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-quantity" class="toc-h2 toc-link" data-title="Quantity">Quantity</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-responserequiredflag" class="toc-h2 toc-link" data-title="ResponseRequiredFlag">ResponseRequiredFlag</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-result" class="toc-h2 toc-link" data-title="Result">Result</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-salecapabilities" class="toc-h2 toc-link" data-title="SaleCapabilities">SaleCapabilities</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-saleid" class="toc-h2 toc-link" data-title="SaleID">SaleID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-saleitem" class="toc-h2 toc-link" data-title="SaleItem">SaleItem</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#data-dictionary-saleitem-sale-items-with-a-upc-ean-isbn" class="toc-h3 toc-link" data-title="Sale items with a UPC/EAN/ISBN">Sale items with a UPC/EAN/ISBN</a>
						  </li>
						  <li>
							<a href="#data-dictionary-saleitem-sale-items-with-modifiers" class="toc-h3 toc-link" data-title="Sale items with modifiers">Sale items with modifiers</a>
						  </li>
						  <li>
							<a href="#data-dictionary-saleitem-item-bundles" class="toc-h3 toc-link" data-title="Item bundles">Item bundles</a>
						  </li>
						  <li>
							<a href="#data-dictionary-saleitem-discounts" class="toc-h3 toc-link" data-title="Discounts">Discounts</a>
						  </li>
						  <li>
							<a href="#data-dictionary-saleitem-refunds" class="toc-h3 toc-link" data-title="Refunds">Refunds</a>
						  </li>
						  <li>
							<a href="#data-dictionary-saleitem-saleitem-fields" class="toc-h3 toc-link" data-title="SaleItem fields">SaleItem fields</a>
						  </li>
					  </ul>
                  </li>
                  <li>
                    <a href="#data-dictionary-salechannel" class="toc-h2 toc-link" data-title="SaleChannel">SaleChannel</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-salereferenceid" class="toc-h2 toc-link" data-title="SaleReferenceID">SaleReferenceID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-saletransactionid" class="toc-h2 toc-link" data-title="SaleTransactionID">SaleTransactionID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-shiftnumber" class="toc-h2 toc-link" data-title="ShiftNumber">ShiftNumber</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-serviceid" class="toc-h2 toc-link" data-title="ServiceID">ServiceID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-softwareversion" class="toc-h2 toc-link" data-title="SoftwareVersion">SoftwareVersion</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-splitpaymentflag" class="toc-h2 toc-link" data-title="SplitPaymentFlag">SplitPaymentFlag</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-taxcode" class="toc-h2 toc-link" data-title="TaxCode">TaxCode</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-totalsgroupid" class="toc-h2 toc-link" data-title="TotalsGroupId">TotalsGroupId</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-transactiontype" class="toc-h2 toc-link" data-title="TransactionType">TransactionType</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-terminalenvironment" class="toc-h2 toc-link" data-title="TerminalEnvironment">TerminalEnvironment</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-timestamp" class="toc-h2 toc-link" data-title="TimeStamp">TimeStamp</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-tokenrequestedtype" class="toc-h2 toc-link" data-title="TokenRequestedType">TokenRequestedType</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-transactionid" class="toc-h2 toc-link" data-title="TransactionID">TransactionID</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-unitofmeasure" class="toc-h2 toc-link" data-title="UnitOfMeasure">UnitOfMeasure</a>
					
                  </li>
                  <li>
                    <a href="#data-dictionary-unitprice" class="toc-h2 toc-link" data-title="UnitPrice">UnitPrice</a>
					
                  </li>
              </ul>
          </li>
          <li>
            <a href="#testing" class="toc-h1 toc-link" data-title="Testing">Testing</a>
          </li>
          <li>
            <a href="#production" class="toc-h1 toc-link" data-title="Production">Production</a>
          </li>
          <li>
            <a href="#appendix" class="toc-h1 toc-link" data-title="Appendix">Appendix</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#appendix-glossary-of-terms" class="toc-h2 toc-link" data-title="Glossary of terms">Glossary of terms</a>
					
                  </li>
                  <li>
                    <a href="#appendix-protocolversion-updates-from-3-1-to-3-1-dmg" class="toc-h2 toc-link" data-title="ProtocolVersion updates from 3.1 to 3.1-dmg">ProtocolVersion updates from 3.1 to 3.1-dmg</a>
					
                  </li>
                  <li>
                    <a href="#appendix-terminal-configuration" class="toc-h2 toc-link" data-title="Terminal configuration">Terminal configuration</a>
					
					  <ul class="toc-list-h3">
						  <li>
							<a href="#appendix-terminal-configuration-pax-terminals" class="toc-h3 toc-link" data-title="PAX terminals">PAX terminals</a>
						  </li>
					  </ul>
                  </li>
              </ul>
          </li>
      </ul>
        <ul class="toc-footer">
            <li>2020-09-13</li>
            <li><a href='https://www.datameshgroup.com'>DataMesh Group</a></li>
            <li><a href='https://github.com/datameshgroup'>GitHub</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <!--

TODO

Matched refunds - we require a POS to match refunds to original purchases. This is to enable support for alternative payments (e.g. Alipay/WeChat). 

At the moment we require a field which isn't a "human readable" field (a GUID) that isn't present on the receipt. This will work when a POS can look 
up a previous sale (i.e. when they have a central database between stores) but not for POS systems which don't have connectivity. 

Fix for this is to add a new "Transaction" status request which will work based on details from the receipt (e.g. TID/MID/DATETIME/STAN etc)

-----------

Not Implemented
In the payment request, nothing under PaymentTransaction.TransactionConditions isn’t implements

-----------

Do we want barcode/QR code in the receipts?

What is ApprovalCode
What is LastTransactionFlag
SplitPaymentFlag - not included, therefor no special processing for split payments? Why support PaidAmount and MinimumSplitAmount?.
Split - does basket need to match RequestedAmount? How do we deal with baskets when split payments? 
Tokenisation


TODO: 

Add DiscountReason / DiscountDesc
Add ProductURL, ProductImageURL
Add RestrictedItem
Re-word "total amount of the main sale item"
Ensure SaleItem is the same for all instances
Ensure deep links for each item are valid

Update AdditionalInfo (Comments, Cooking instructions etc)

Add example; 2-for-1 ??

Explain
/Cash /
/Giftcard /


Ports open in production 
wss://prod1.datameshgroup.io:4000
5000 for POS

-->
<h1 id='introduction'>Introduction</h1>
<p>The DataMesh Fusion API enables a POS (the <em>Sale System</em>) to take payments using a DataMesh Satellite terminal (the <em>POI terminal</em>). </p>

<p>The API is organised around websockets and a JSON message interface which is based on and guided by the open, industry standard Nexo Retailer Sale to POI Protocol V3.1. It is highly recommended that this document is read alongside the official <a href="https://www.nexo-standards.org/">NEXO Standard documentation</a>.</p>

<p>Both POI Terminal and Sale System connect to Unify (the POI System) - a high-performance, resilient, financial switching platform created by DataMesh.</p>

<p>Unify orchestrates the message flow between Sale System and terminal, and assists with error recovery and reconciliation. </p>

<p><img src="images/overview-diagram-97ee9e2a.png" alt="" /></p>
<h1 id='getting-started'>Getting started</h1>
<p>The steps outlined below will guide you through creating a dev account, scoping your Sale System requirements based on the DataMesh functionality, coding and testing your integration, getting accredited with DataMesh and finally deploying your solution into production.</p>

<ol>
<li><a href="#getting-started-create-a-test-account">Create a test account</a></li>
<li><a href="#getting-started-design-your-integration">Design your integration</a></li>
<li><a href="#cloud-api-reference">Code your POS integration</a></li>
<li><a href="#testing">POS accreditation</a></li>
<li><a href="#production">Production deployment</a></li>
</ol>
<h2 id='getting-started-create-a-test-account'>Create a test account</h2>
<p>Integration into the DataMesh payment platform requires a DataMesh Satellite terminal, and a DataMesh Unify development account. </p>

<p>After creating your development account, you will be provided the following settings which are associated with a Sale System version. These settings must be included in each login request.</p>

<ul>
<li><code>ProviderIdentification</code>, the name of the busniess which creates the Sale System.</li>
<li><code>ApplicationName</code>, the name of the Sale System.</li>
<li><code>CertificationCode</code>, a GUID which uniquly identifies the Sale System. </li>
<li><code>SoftwareVersion</code>, the internal build version of this Sale System. DataMesh must configure this value on Unify. </li>
</ul>

<p>When the Sale System accreditation is complete and the Sale System is ready for production deployment, DataMesh will provide production settings to be included with the production Sale System build.</p>

<p>Each Sale System lane is authenticated and authorised with a unique <a href="#data-dictionary-saleid">SaleID</a> + <a href="#data-dictionary-kek">KEK</a> combination, and each POI Terminal is identified by a unique <a href="#data-dictionary-poiid">POIID</a>. </p>

<p>DataMesh associates <a href="#data-dictionary-saleid">SaleID</a> and <a href="#data-dictionary-poiid">POIID</a> values on Unify to enforce access restrictions between specific Sale System lanes and terminals.</p>

<p>When requesting a development account, let us know if you plan on working with multiple Sale System instances connected to the same terminal, or multiple terminals connected to one Sale System. 
DataMesh will provide the correct number of <a href="#data-dictionary-saleid">SaleID</a>, <a href="#data-dictionary-kek">KEK</a>, and <a href="#data-dictionary-poiid">POIID</a> values and terminals, and ensure the correct associations are implemented on Unify. </p>

<p>You can request a terminal and a development account via <a href="mailto:integrations@datameshgroup.com">integrations@datameshgroup.com</a></p>
<h2 id='getting-started-design-your-integration'>Design your integration</h2>
<aside class="notice">
This section will make reference to methods and data structures documented in the <a href="#cloud-api-reference">Cloud API Reference</a>. 
</aside>

<p>Before development commences, you should familiarise yourself with the DataMesh payment platform, including mandatory an optional features available. </p>

<p>This will enable you to scope the development work required to complete the DataMesh integration with your Sale System.</p>

<p><strong>Mandatory features checklist</strong></p>

<p>You should refer to the accreditation <a href="#testing">test script</a> as a guide to ensure the Sale System has successfully implemented the mandatory integration requirements. </p>

<p>Below is a an overview of the mandatory integration requirements.</p>

<ul>
<li>Support for <a href="#cloud-api-reference-perform-a-purchase">purchase</a> and <a href="#cloud-api-reference-perform-a-refund">refund</a> payment types</li>
<li>Include <a href="#getting-started-design-your-integration-product-data">product data</a> in each payment request</li>
<li>Support for TLS and other <a href="#cloud-api-reference-security-requirements">security requirements</a></li>
<li>Additional fields will be added to the message specification over time. To ensure forwards compatibility the Sale System must ignore when extra objects and fields are present in response messages. This includes valid MAC handling in the SecurityTrailer.</li>
<li>Implement <a href="#getting-started-design-your-integration-sale-system-settings">Sale System settings</a> requirements</li>
<li>Implement <a href="#getting-started-design-your-integration-payment-user-interface">Payments user interface</a> which handles the <code>Initial UI</code>, <code>Final UI</code>, <code>Display UI</code>, and <code>cancelling a sale in progress</code></li>
<li>Handle error scenarios as outlined in <a href="#cloud-api-reference-error-handling">error handling</a></li>
<li>Ensure Sale System provides a unique <a href="#getting-started-design-your-integration-payment-identification">payment identification</a></li>
<li>Pass the accreditation <a href="#testing">test script</a></li>
</ul>

<p><strong>Other features</strong></p>

<ul>
<li><a href="#getting-started-design-your-integration-dynamic-surcharge">Dynamic Surcharge</a></li>
<li><a href="#getting-started-design-your-integration-tipping">Tipping</a></li>
<li>Payments <a href="#getting-started-design-your-integration-user-interface">user interface</a> for all displays and inputs</li>
<li>Sale System <a href="#getting-started-design-your-integration-receipt-printing">receipt printing</a></li>
<li><a href="#getting-started-design-your-integration-tokenisation">Tokenisation</a></li>
<li><a href="#getting-started-design-your-integration-settlement">Settlement</a></li>
<li><a href="#getting-started-design-your-integration-cash-out">Cash out</a></li>
</ul>

<aside class="success">
For help on scoping your development work, or to discuss integration requirements, please contact the Data Mesh integrations team at <a href="mailto:integrations@datameshgroup.com">integrations@datameshgroup.com</a>
</aside>
<h3 id='getting-started-design-your-integration-payment-lifecycle'>Payment lifecycle</h3>
<p>The payment lifecycle, including the required API requests, is outlined in the diagram below. </p>

<ol>
<li>Merchant launches the Sale System</li>
<li>Sale System opens the websocket connection</li>
<li>Sale System has the option to <a href="#terminal-linking">link</a> with a POI Terminal by performing a <a href="#cloud-api-reference-methods-login">login request</a> either: 

<ol>
<li>When the Sale System launches or</li>
<li>Before the first payment request is sent</li>
</ol></li>
<li>Sale System receives a successful login response</li>
<li>Merchant initiates a payment</li>
<li>Sale System sends a <a href="#cloud-api-reference-methods-payment">payment request</a></li>
<li>Sale System handles <a href="#cloud-api-reference-methods-display">display requests</a>, <a href="#cloud-api-reference-methods-print">print requests</a>, and <a href="#cloud-api-reference-methods-input">input requests</a></li>
<li>Sale System receives a payment response</li>
<li>Merchant closes the Sale System</li>
<li>Sale System can optionally send a <a href="#cloud-api-reference-methods-logout">logout request</a></li>
<li>Sale System closes the websocket</li>
</ol>

<p><img src="images/payment-lifecycle-basic-a1b6433d.png" alt="" /></p>
<h3 id='getting-started-design-your-integration-terminal-linking'>Terminal linking</h3>
<p>The POS (Sale System) communicates with a POI terminal using both a <a href="#data-dictionary-saleid">SaleID</a> and <a href="#data-dictionary-kek">KEK</a> (which identifies the Sale System) and <a href="#data-dictionary-poiid">POIID</a> (which identifies the terminal).</p>

<p>Before a payment is processed, the Sale System must be &#39;linked&#39; to a POI terminal by sending a <a href="#cloud-api-reference-methods-login">login</a> request. </p>

<p>It is possible for a Sale System to &#39;link&#39; with multiple POI terminals, and for each POI terminal to be &#39;linked&#39; to multiple Sale Systems. In this 
instance the Sale System should record multiple <a href="#data-dictionary-poiid">POIID</a> values and enable the operator to select the desired POI terminal as part of the payment flow.</p>

<aside class="success">
The Sale System must store the <code>KEK</code> in a secure location. 
</aside>
<h3 id='getting-started-design-your-integration-sale-system-settings'>Sale System settings</h3>
<p>The Sale System must support configuration of both static Sale System settings, and cashier configurable settings.</p>
<h4 id='getting-started-design-your-integration-sale-system-settings-static-sale-system-settings'>Static Sale System settings</h4>
<p>Static Sale System settings are provided by DataMesh and are linked to the build of the Sale System. i.e. they will be the same for all merchants using the Sale System build.</p>

<p>These settings can be contained in a database or configuration file editable by a Sale System engineer, or hard coded into the Sale System build. </p>

<p>Regardless of where they are stored, the Sale System must ensure the cashier or merchant is never required to configure the static settings, as they will not be aware of the required values. </p>

<p>DataMesh will provide two sets of static settings; one set for the test environment, and one set for production. It is the responsibility of the Sale System to ensure the correct values 
are included in a test or production build. </p>

<p>The static Sale System settings are</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-provideridentification">ProviderIdentification</a></td>
<td>✔</td>
<td>String</td>
<td>The name of the company supplying the Sale System. Provided by DataMesh. Sent in the login request.</td>
</tr>
<tr>
<td><a href="#data-dictionary-applicationname">ApplicationName</a></td>
<td>✔</td>
<td>String</td>
<td>The name of the Sale System application. Provided by DataMesh. Sent in the login request.</td>
</tr>
<tr>
<td><a href="#data-dictionary-softwareversion">SoftwareVersion</a></td>
<td>✔</td>
<td>String</td>
<td>Must indicate the software version of the current Sale System build. Sent in the login request.</td>
</tr>
<tr>
<td><a href="#data-dictionary-certificationcode">CertificationCode</a></td>
<td>✔</td>
<td>String</td>
<td>Certification code for this Sale System. Provided by DataMesh. Sent in the login request.</td>
</tr>
</tbody></table>
<h4 id='getting-started-design-your-integration-sale-system-settings-cashier-configurable-settings'>Cashier configurable settings</h4>
<p>The <a href="#data-dictionary-saleid">SaleID</a>, <a href="#data-dictionary-kek">KEK</a>, and <a href="#data-dictionary-poiid">POIID</a> are cashier configurable settings which may be different for each lane.</p>

<p>The Sale System must ensure there is a user interface accessible by the cashier which enables these settings to be configured.</p>

<p>The <a href="#data-dictionary-saleid">SaleID</a> and <a href="#data-dictionary-poiid">POIID</a> should be visible to the cashier. The <a href="#data-dictionary-kek">KEK</a> should be masked after entry by the cashier. </p>

<p>If the Sale System is to support many-to-one configuration (i.e. one Sale System linked to many POI terminals) it should support the entry of <a href="#data-dictionary-saleid">SaleID</a> and <a href="#data-dictionary-kek">KEK</a> to identify the  Sale System lane, and a <a href="#data-dictionary-poiid">POIID</a> for each POI terminal linked.</p>

<aside class="success">
A "pairing" API request will be available in a future API release which will enable the delivery of <code>SaleID</code>, <code>POIID</code>, and <code>KEK</code> to the Sale System in place of the manual entry of these data fields. 
</aside>

<p><em>Example setting UI</em></p>

<p><img src="images/settings-ui-bf29005d.png" alt="" /></p>
<h3 id='getting-started-design-your-integration-payment-types'>Payment types</h3>
<p>Supported <a href="#cloud-api-reference-methods-payment">payment</a> types are:</p>

<ul>
<li>Purchase</li>
<li>Cash-Out</li>
<li>Purchase with Cash-Out</li>
<li>Refund</li>
</ul>

<!--
- Pre-authorisation
- Pre-authorisation top-up
- Completion
-->

<p>The Sale System indicates the payment type in the payment request with the <a href="#data-dictionary-paymenttype">PaymentType</a> field.</p>
<h3 id='getting-started-design-your-integration-payment-identification'>Payment identification</h3>
<p>Each transaction request and response is identified by a <code>TransactionIdentification</code> object which contains the fields: </p>

<ul>
<li><a href="#data-dictionary-transactionid">TransactionID</a></li>
<li><a href="#data-dictionary-timestamp">TimeStamp</a></li>
</ul>

<p>In a payment request, the Sale System sends this identification in <a href="#data-dictionary-saletransactionid">SaleData.SaleTransactionID</a>. The Sale System must ensure the <a href="#data-dictionary-saletransactionid">SaleData.SaleTransactionID</a> uniquely identifies a <strong>sale</strong> for a given <a href="#data-dictionary-saleid">SaleId</a>.</p>

<p>In a payment response, the POI System sends this identification in <a href="#data-dictionary-poitransactionid">SaleData.POITransactionID</a>. The POI System will ensure the <a href="#data-dictionary-poitransactionid">SaleData.POITransactionID</a> uniquely identifies a <strong>payment</strong> for a given <a href="#data-dictionary-poiid">POIId</a>.</p>

<aside class="success">
Whilst the <a href="#data-dictionary-saletransactionid">SaleTransactionID</a> in the payment request uniquely identifies the sale, it isn't neccessarily unique for each payment sent from the <a href="#data-dictionary-saleid">SaleId</a> (for example, in the case of split payments, where one sale is paid with multiple payments). However the <a href="#data-dictionary-poitransactionid">POITransactionID</a> returned in the payment response is guaranteed to be unique for a given <a href="#data-dictionary-poiid">POIID</a>.
</aside>

<p><img src="images/payment-identification-73e9e38c.png" alt="" /></p>
<h3 id='getting-started-design-your-integration-receipt-printing'>Receipt printing</h3>
<p>The POI Terminal will produce payment receipts which must be printed as a part of the transaction flow.</p>

<p>Some terminals have a built-in printer which can handle receipt printing. However, in order to support terminals without a built-in printer and improve the customer experience the Sale System should also handle printing receipts produced by the POI Terminal.</p>

<p>To enable printing receipts from the Sale System, include &quot;PrinterReceipt&quot; in the list of available <a href="#data-dictionary-salecapabilities">SaleTerminalData.SaleCapabilities</a> when sending the <a href="#cloud-api-reference-methods-login">LoginRequest</a>. </p>

<aside class="success">
The Sale System must print the receipt as formatted by DataMesh and not create a custom formatted receipt.
</aside>

<p>Receipts may be delivered to the Sale System using two methods</p>

<ul>
<li><strong>PrintReceipt request</strong> - One or more PrintReceipt requests may fire during the sale</li>
<li><strong>Payment response</strong> - A customer receipt is returned in the payment response in <a href="#data-dictionary-outputxhtml">OutputContent.OutputXHTML</a> formatted as the format defined in <a href="#data-dictionary-outputformat">OutputContent.OutputFormat</a></li>
</ul>

<p>It is recommended that the Sale System embed the customer payment receipt content in the customer sale receipt produced by the Sale System.</p>

<p><em>Example receipt format</em></p>

<div style="color:black;background:white;font-family:monospace;width:200px;">
*** CUSTOMER COPY ***            </br>
DD/MM/YYYY hh:mm:ss              </br>
Merchant ID: XXXXXXXX            </br>
Terminal ID: XXXXXXXX            </br>
                                 </br>
<b>Purchase Transaction</b>      </br>   
Amount:          $10.00          </br> 
Tip:              $1.00          </br> 
Surcharge 2.00%:  $0.22          </br>
-----------------------          </br> 
Total Amount:    $11.22          </br>
                                 </br> 
VISA: 4xxxxxxxxxxxxxxx(T)        </br> 
Credit Account                   </br>
                                 </br>
<b>Approved</b>                  </br>
                                 </br>
Reference: 0000 0000 0000        </br> 
Auth Code: 000000                </br> 
AID: A0000000000000000           </br>
ATC: 000X                        </br> 
TVR: 000000000000                </br>
ARQC: XXXXXXXXXXXXXXXX           </br> 
</div>
<h3 id='getting-started-design-your-integration-payment-user-interface'>Payment user interface</h3>
<aside class="warning">

The Sale System should implement <code>Initial UI</code>, <code>Final UI</code>, <code>Display UI</code> and the ability to <code>cancel a sale in progress</code>. 

The <code>Input UI</code> elements are not currently available, and will be supported by a future Unify release. Support for these elements by the Sale System is optional.

</aside>

<p>If capable, the Sale System should present UI to the cashier for the duration of a payment. The content of the UI is set by the <a href="#cloud-api-reference-methods-input">input</a> and <a href="#cloud-api-reference-methods-display">display</a> request messages sent from the POI System.</p>

<p>In the examples presented below the UI is contained in a modal shadow box. This is an example to help illustrate how this UI may be implemented. The Sale System should implement this UI in a way that fits the look and feel of the rest of the system.</p>

<p>The Sale System must not block communication with the POI System when displaying the payments UI. The POI System may send a display or input request, followed by another display or input request, or the payment response. For example, the POI System may send a &quot;SELECT ACCOUNT&quot; display, followed by a &quot;PROCESSING&quot; display when the card holder selects their account on the POI terminal. The POI System may send a &quot;SIGNATURE APPROVED&quot; input request, followed by a &quot;TIMEOUT&quot; display and payment response, if the cashier doesn&#39;t approve the signature in time.</p>

<p>To enable display and input handling on the Sale System, <a href="#data-dictionary-salecapabilities">SaleTerminalData.SaleCapabilities</a> in the <a href="#cloud-api-reference-methods-login">login</a> request contains &quot;CashierStatus&quot;, &quot;CashierError&quot;, &quot;CashierInput&quot;, and &quot;CustomerAssistance&quot;.</p>

<aside class="success">
The DataMesh Nexo API is event based. The Sale System sends a payment request, handles events as they are received, and eventually receives a payment response.
</aside>
<h4 id='getting-started-design-your-integration-payment-user-interface-cancelling-a-sale-in-progress'>Cancelling a sale in progress</h4>
<p>Whilst a payment is in progress the Sale System should present UI to the cashier which enables them to request a cancellation of the payment. </p>

<p>If the cashier initiates a payment cancellation, the Sale System sends an <a href="#cloud-api-reference-methods-abort-transaction">abort transaction request</a> and continues to wait for the payment response. </p>

<p>The Sale System may allow the cashier to continue to request cancellation of the payment until a payment result has been received.</p>

<aside class="success">
There are a number of instances where the Terminal may be unable to cancel a payment in progress upon receiving a <a href="#abort-transaction">abort transaction request</a>. The Sale System must <b>always</b> await a payment response after sending an abort transaction request. 
</aside>
<h4 id='getting-started-design-your-integration-payment-user-interface-initial-ui'>Initial UI</h4>
<p>The Sale System should immediately display an initial UI after sending a <a href="#cloud-api-reference-methods-payment">payment</a> request which informs the cashier the payment is in progress. This UI is required to handle instances where the first display/input message from the POI System is not present, or delayed.</p>

<p>This UI should also enable the cashier to request a cancellation of the transaction.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-initial-ui-55c3ef23.png" alt="" /></p>
<h4 id='getting-started-design-your-integration-payment-user-interface-display-ui'>Display UI</h4>
<blockquote>
<p>Display request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Display"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"DisplayRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"DisplayOutput"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"ResponseRequiredFlag"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"CashierDisplay"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"Status"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"OutputContent"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"OutputText"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"Text"</span><span class="p">:</span><span class="s2">"LINE OF TEXT MAX 40 CHARACTERS"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>The POI system will send zero or more <a href="#cloud-api-reference-methods-display">display request</a> messages to the Sale System during a transaction. The Sale System should display these messages and continue to wait for the payment response.</p>

<ul>
<li>Each display request will contain at least 1 line of text.</li>
<li>Each line of text will be up to 40 characters wide.</li>
<li>The POI System should display the text centred.</li>
<li>The POI System should include the option to cancel the transaction.</li>
<li>The POI System should display an &quot;in progress&quot; indicator to the cashier.</li>
<li>The POI System may optionally colour the display text based on the <a href="#data-dictionary-infoqualify">InfoQualify</a> field set as &quot;Error&quot; or &quot;Status&quot;</li>
</ul>

<p><em>Example</em></p>

<p><img src="images/dialog-display-509f218b.png" alt="" /></p>
<h4 id='getting-started-design-your-integration-payment-user-interface-input-ui'>Input UI</h4>
<aside class="warning">
The <code>Input UI</code> elements are not currently available, and will be supported by a future Unify release. Support for these elements by the Sale System is optional.
</aside>

<p>The POI system will send zero or more <a href="#cloud-api-reference-methods-input">input request</a> messages to the Sale System during a transaction. The Sale System should display these input requests, allow the cashier the option to answer the input request, and continue to wait for the payment response. The Sale System should not block on an input request, as the POI System may continue with the transaction before the Sale System has sent an input response.</p>

<ul>
<li>There are six types of input request. The <a href="#data-dictionary-inputcommand">InputCommand</a> indicates which input request type the Sale System should present:

<ul>
<li>GetAnyKey - Wait for any key press. For example, to get confirmation from the cashier that a display has been read. </li>
<li>GetConfirmation - Yes/No answer as in the case when prompting for &quot;Signature OK?&quot;. The result of this command is boolean true/false.</li>
<li>Password - A merchant password as in the case during a refund transaction.</li>
<li>GetMenuEntry - A selection from a list of options. For example, assisting the card holder by selecting the account type: Savings, Cheque or Credit.</li>
<li>TextString - A text string.</li>
<li>DigitString - A string of digits.</li>
<li>DecimalString - A string of digits with a decimal point. </li>
</ul></li>
<li>The input request has a single line of text, up to 40 characters wide.</li>
<li>The POI System should display the text centred.</li>
<li>The POI System should include the option to cancel the transaction.</li>
<li>The <a href="#minlength">MinLength</a> and <a href="#maxlength">MaxLength</a> fields may be present for some input commands.</li>
<li>The <a href="#maxinputtime">MaxInputTime</a> field may be present which indicates the input timeout in seconds.</li>
</ul>

<p><strong>Input - GetAnyKey</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;GetAnyKey&quot; indicates the Sale System should wait for any key press. This is most often used to display a request which the cashier must acknowledge to continue.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-input-getanykey-fb29b31d.png" alt="" /></p>

<p><strong>Input - GetConfirmation</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;GetConfirmation&quot; indicates the Sale System should present a yes/no option to the cashier. The response to this request is boolean true/false.</p>

<aside class="notice">
The option for the cashier to 'Cancel' is optional on the <code>GetConfirmation</code> input UI.
</aside>

<p><em>Example</em></p>

<p><img src="images/dialog-input-getconfirmation-6075df06.png" alt="" /></p>

<p><strong>Input - Password</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;Password&quot; indicates the Sale System should allow the user to enter text of any format as a password. </p>

<p>The Sale System should ensure cashier input conforms to <a href="#minlength">MinLength</a> and/or <a href="#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>

<p>The <a href="#maskcharactersflag">MaskCharactersFlag</a> field indicates if the Sale System should mask the cashier input on screen.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-input-getpassword-c37ffeac.png" alt="" /></p>

<p><strong>Input - TextString</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;TextString&quot; indicates the Sale System should allow the user to enter text of any format. </p>

<p>The Sale System should ensure cashier input conforms to <a href="#minlength">MinLength</a> and/or <a href="#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-input-textstring-3cc10854.png" alt="" /></p>

<p><strong>Input - DigitString</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;DigitString&quot; indicates the Sale System should allow the user to enter a string of digits only.</p>

<p>The Sale System should ensure cashier input conforms to <a href="#minlength">MinLength</a> and/or <a href="#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-input-digitstring-cc757920.png" alt="" /></p>

<p><strong>Input - DecimalString</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;DigitString&quot; indicates the Sale System should allow the user to enter a string of digits with a decimal point (e.g. an amount)</p>

<p>The Sale System should ensure cashier input conforms to <a href="#minlength">MinLength</a> and/or <a href="#maxlength">MaxLength</a> fields if they are present and display an informational error if it does not.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-input-decimalstring-37c8e80a.png" alt="" /></p>

<p><strong>Input - GetMenuEntry</strong></p>

<p>An <a href="#data-dictionary-inputcommand">InputCommand</a> of &quot;GetMenuEntry&quot; indicates the Sale System should allow the cashier to select one of a number of options available.</p>

<p>The number of available options will be 1..n. The <code>MenuEntry</code> object contains the options to be displayed.</p>

<p><em>Example</em></p>

<p><img src="images/dialog-input-getmenuentry-28430f31.png" alt="" /></p>
<h4 id='getting-started-design-your-integration-payment-user-interface-final-ui'>Final UI</h4>
<p>The Sale System should display a final UI after the response has been received to inform the cashier of the transaction result. </p>

<p>This UI is constructed using the <a href="#data-dictionary-result">Result</a>, <a href="#data-dictionary-errorcondition">ErrorCondition</a>, and <a href="#additionalresponse">AdditionalResponse</a> fields of the <code>Response</code> object.</p>

<p><em>Result=&quot;Success&quot; Example</em></p>

<p><img src="images/dialog-final-ui-success-e77fd509.png" alt="" /></p>

<p><em>Result=&quot;Failure&quot; Example</em></p>

<p><img src="images/dialog-final-ui-failure-c1bf753f.png" alt="" /></p>
<h3 id='getting-started-design-your-integration-product-data'>Product data</h3>
<p>The Sale System must include product information about the sale items attached to each purchase request. </p>

<p>It can accomplish this by including an array of <a href="#data-dictionary-saleitem">SaleItem</a> objects in the <code>PaymentRequest</code>.</p>

<p>Each <a href="#data-dictionary-saleitem">SaleItem</a> record contains the following mandatory fields: </p>

<ul>
<li><strong>ItemID</strong> a unique identifier for the sale item within the context of this payment. e.g. a 0..n integer which increments by one for each sale item.</li>
<li><strong>ProductCode</strong> - a unique identifier for the product within the merchant, such as the SKU. For example if two customers purchase the same product at two different stores owned by the merchant, both purchases should contain the same <code>ProductCode</code>.</li>
<li><strong>ItemAmount</strong> - total amount of the sale item.</li>
<li><strong>ProductLabel</strong> - a short, human readable, descriptive name of the product.  For example, <code>ProductLabel</code> could contain the product name typically printed on the customer receipt. </li>
<li><strong>Quantity</strong> - item unit quantity</li>
<li><strong>UnitOfMeasure</strong> - unit of measure of the <code>Quantity</code>. See <a href="#data-dictionary-unitofmeasure">UnitOfMeasure</a></li>
<li><strong>UnitPrice</strong> - price per item unit. </li>
</ul>

<p>See <a href="#data-dictionary-saleitem">SaleItem</a> for all available fields and examples. </p>

<aside class="success">
Including all available product information in each payment request will improve the merchant experiance. See <a href="#data-dictionary-saleitem">SaleItem</a> for a full list of available fields. 
</aside>
<h3 id='getting-started-design-your-integration-cash-out'>Cash out</h3>
<p>The Sale System can optionally support cash out payments on the POI Terminal. There are two cash out methods supported based on where the cash out amount is entered; cash out on Sale System, and cash out on POI Terminal. </p>
<h4 id='getting-started-design-your-integration-cash-out-cash-out-on-sale-system'>Cash out on Sale System</h4>
<p>When perfoming cash out on the Sale System, the cash out amount is entered by the cashier on the Sale System before the purchase is sent. </p>

<p>A cash out sale can be cash out only, or cash out + purchase. </p>

<ul>
<li>Cash out only (no sale items are included)

<ul>
<li>Set <a href="#data-dictionary-paymenttype">PaymentData.PaymentType</a> to &quot;CashAdvance&quot;</li>
<li>Set <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to the cash out amount </li>
<li>Set <a href="#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> to the cash out amount </li>
</ul></li>
<li>Purchase plus cash out (sale items are included)

<ul>
<li>Set <a href="#data-dictionary-paymenttype">PaymentData.PaymentType</a> to &quot;Normal&quot;</li>
<li>Set <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to the value of the sale items, plus the cash out amount </li>
<li>Set <a href="#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> to the cash out amount </li>
</ul></li>
</ul>
<h4 id='getting-started-design-your-integration-cash-out-cash-out-on-poi-terminal'>Cash out on POI Terminal</h4>
<p>When performing cash out on the POI Terminal, the Sale System sends the payment request to the POI Terminal without a cash out amount. The POI Terminal gives the option for the card holder to enter a cash out amount. The payment response will contain any cash out amount entered by the card holder.</p>

<p>A cash out sale can be cash out only, or cash out + purchase. </p>

<ul>
<li>Cash out only (no sale items are included)

<ul>
<li>Set <a href="#data-dictionary-paymenttype">PaymentData.PaymentType</a> to &quot;CashAdvance&quot;</li>
<li>Set <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to 0</li>
<li>Set <a href="#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> to 0</li>
<li>Set <a href="#maximumcashbackamount">PaymentTransaction.AmountsReq.MaximumCashBackAmount</a> to the maximum about the terminal should allow the card holder to enter </li>
<li>The <a href="#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> field in the payment response will reflect the cash back amount entered by the card holder</li>
<li>The <a href="#authorizedamount">PaymentTransaction.AmountsReq.AuthorizedAmount</a> field in the payment response will include the cash back amount entered by the card holder<br></li>
</ul></li>
<li>Purchase plus cash out (sale items are included)

<ul>
<li>Set <a href="#data-dictionary-paymenttype">PaymentData.PaymentType</a> to &quot;Normal&quot;</li>
<li>Set <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to the value of the sale items</li>
<li>Set <a href="#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> to 0</li>
<li>Set <a href="#maximumcashbackamount">PaymentTransaction.AmountsReq.MaximumCashBackAmount</a> to the maximum about the terminal should allow the card holder to enter </li>
<li>The <a href="#cashbackamount">PaymentTransaction.AmountsReq.CashBackAmount</a> field in the payment response will reflect the cash back amount entered by the card holder</li>
<li>The <a href="#authorizedamount">PaymentTransaction.AmountsReq.AuthorizedAmount</a> field in the payment response will include the cash back amount entered by the card holder</li>
</ul></li>
</ul>
<h3 id='getting-started-design-your-integration-settlement'>Settlement</h3>
<p>The Sale System can reconcile with the POI System periodically but should normally be once a day as it affects settlements with acquirers.</p>

<p>Use the <a href="#cloud-api-reference-methods-reconciliation">Reconciliation</a> request to initiate a settlement.</p>
<h3 id='getting-started-design-your-integration-tokenisation'>Tokenisation</h3>
<p>Cards can be pre-tokenised by the Sale System if required. This supports mobile apps, eCommerce and Sale System type systems.</p>

<p>Customer tokens are supported:</p>

<ul>
<li><strong>Customer</strong> - token which is scoped to the customer. For example, if the same card is tokenised on two different POI Terminals owned by the merchant, the same token will be returned. A <code>Customer</code> token can be used to represent the card holder and perform operations for a longer period.</li>
</ul>

<!-- TODO - future version
Two types of token can be requested: 

- **Transaction** - token limited to the scope of a single transaction. For example, if the same card is tokenised twice on a POI Terminal, two different `Transaction` tokens would be returned. The `Transaction` token can be used to perform subsequent follow-up transactions, for example refunding or voiding a purchase.
- **Customer** - token which is scoped to the customer. For example, if the same card is tokenised on two different POI Terminals owned by the merchant, the same token will be returned. A `Customer` token can be used to represent the card holder and perform operations for a longer period.
-->
<h4 id='getting-started-design-your-integration-tokenisation-tokenise-a-card-used-for-a-payment'>Tokenise a card used for a payment</h4>
<p>To tokenise a card as part of a <a href="#cloud-api-reference-methods-payment">payment</a>, set <a href="#data-dictionary-tokenrequestedtype">SaleData.TokenRequestedType</a> in the payment request to &quot;Transaction&quot; or &quot;Customer&quot;.</p>

<p>When <a href="#data-dictionary-tokenrequestedtype">SaleData.TokenRequestedType</a> is set, the token will be returned as part of the payment response in <a href="#data-dictionary-paymenttoken">PaymentResult.PaymentInstrumentData.CardData.PaymentToken</a>.</p>
<h4 id='getting-started-design-your-integration-tokenisation-tokenise-a-card-without-payment'>Tokenise a card without payment</h4>
<p>The <a href="#cloud-api-reference-methods-card-acquisition">card acquisition</a> request allows the Sale System to tokenise a card which can be used in future payment requests.</p>

<!-- TODO - need to validate how this works

#### Use a token for a payment 

To perform a [payment](#cloud-api-reference-methods-payment) request using a token: 

- Populate [PaymentTransaction.OriginalPOITransaction](#data-dictionary-originalpoitransaction) with details of the sale used to acquire the token
- Set [PaymentTransaction.OriginalPOITransaction.ReuseCardDataFlag](#reusecarddataflag) to true
- Populate values in the `PaymentTransaction.PaymentData.PaymentInstrumentData.CardData.PaymentToken` object 
  - [TokenRequestedType](#data-dictionary-tokenrequestedtype) - "Transaction" or "Customer". Must match the type of token recorded in the POI System.
  - [TokenValue](#tokenvalue) - Token previously returned from the POI System in the payment, or card acquisition response 

-->
<h3 id='getting-started-design-your-integration-split-payments'>Split payments</h3>
<p>To perform a split payment, the Sale System should send multiple <a href="#cloud-api-reference-methods-payment">payment</a> requests, one for each split. </p>

<p>Split is allowed when <a href="#data-dictionary-paymenttype">PaymentType</a> is &quot;Normal&quot;.</p>

<p>The following data elements should be set by the Sale System for a split payment in a <a href="#cloud-api-reference-methods-payment">payment</a> request:</p>

<ul>
<li>All split payments which are part of the same sale should include the same <a href="#data-dictionary-saletransactionid">SaleData.SaleTransactionID</a>. </li>
<li><a href="#data-dictionary-saleitem">PaymentTransaction.SaleItem</a> array, which may reflect

<ul>
<li>Just the items involved in that payment, in the case of a split basket.</li>
<li>All the items in the sale, in the case the sale is being split by amount. Note when splitting by amount the sum of the item amounts could more than the <a href="#requestedamount">RequestedAmount</a>.</li>
</ul></li>
<li><a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> set to the amount of the split payment</li>
<li>[PaymentData.SplitPaymentFlag] set to true</li>
<li><a href="#minimumsplitamount">PaymentTransaction.AmountsReq.MinimumSplitAmount</a> set to the minimum split amount </li>
<li><a href="#paidamount">PaymentTransaction.AmountsReq.PaidAmount</a> set to the total amount of previous split payment associated with this sale</li>
</ul>

<p>An example, when splitting by sale item:
- A sale contains two items, &quot;Product A&quot; ($80) and &quot;Product B&quot; ($20)
- The card holder wishes to pay for each item with a different card
- The cashier sends the first payment for $80, the basket contains &quot;Product A&quot;
- The cashier sends a second payment for $20, the basket contains &quot;Product B&quot;</p>

<p>An example, when splitting by amount:
- A sale contains two items, &quot;Product A&quot; ($80) and &quot;Product B&quot; ($20)
- The card holder wishes to split the sale equally between two cards
- The cashier sends the first payment for $50, the basket contains both &quot;Product A&quot; and &quot;Product B&quot;
- The cashier sends a second payment for $50, the basket contains both &quot;Product A&quot; and &quot;Product B&quot;</p>

<p><img src="images/payment-split-d9af4888.png" alt="" /></p>
<h3 id='getting-started-design-your-integration-tipping'>Tipping</h3>
<p>There are two tipping methods supported; tip on Sale System, and tip on POI Terminal. </p>
<h4 id='getting-started-design-your-integration-tipping-tip-on-sale-system'>Tip on Sale System</h4>
<p>When tipping on the Sale System the tip amount is entered by the cashier on the Sale System before the purchase is sent.</p>

<p>For example: </p>

<ol>
<li>Cashier prints a sale ticket for $100 and presents to the card holder</li>
<li>Card holder signs and writes a tip of $10</li>
<li>Cashier opens $100 sale on the Sale System, enters tip of $10 and initiates payment</li>
<li>Sale System sends a <a href="#cloud-api-reference-methods-payment">payment request</a> request to the POI Terminal and sets

<ul>
<li><a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to $110 (sale amount + tip)</li>
<li><a href="#tipamount">PaymentTransaction.AmountsReq.TipAmount</a> to $10</li>
</ul></li>
<li>POI Terminal processes a payment of $110 and includes tip amount on the payment receipt</li>
<li>POI Terminal approves payment and returns the result to the Sale System</li>
</ol>
<h4 id='getting-started-design-your-integration-tipping-tip-on-poi-terminal'>Tip on POI Terminal</h4>
<p>When tipping on the POI Terminal, the Sale System sends the payment request to the POI Terminal without a tip. The POI Terminal gives the option for the card holder to enter a tip amount. The payment response will contain any tip entered by the card holder.</p>

<p>For example: </p>

<ol>
<li>Cashier opens $100 sale on the Sale System and initiates payment</li>
<li>Sale System sends a <a href="#cloud-api-reference-methods-payment">payment request</a> request to the POI Terminal and sets

<ul>
<li><a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to $110 (sale amount + tip)</li>
<li><a href="#tipamount">PaymentTransaction.AmountsReq.TipAmount</a> to $0</li>
</ul></li>
<li>POI Terminal presents UI to the card holder which allows them to enter a tip</li>
<li>Card holder enters tip amount of $10</li>
<li>POI Terminal processes a payment of $110 and includes tip amount on the payment receipt</li>
<li>POI Terminal approves payment and returns the result to the Sale System with 

<ul>
<li><a href="#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> set to $110</li>
<li><a href="#tipamount">PaymentResult.AmountsResp.TipAmount</a> set to $10</li>
</ul></li>
<li>The Sale System records the approved payment, and optionally records the tip amount of $10</li>
</ol>

<aside class="success">
The amount returned in <a href="#authorizedamount">AuthorizedAmount</a> in the payment result may be differ from the <a href="#requestedamount">RequestedAmount</a> sent in the payment request
</aside>
<h3 id='getting-started-design-your-integration-dynamic-surcharge'>Dynamic surcharge</h3>
<p>Dynamic surcharging allows the merchant to recover their &#39;cost of acceptance&#39; by enabling the POI Terminal to automatically add a surcharge percentage to the purchase amount based on the card type presented by the customer.</p>

<p>A distinct percentage can be applied to the card types: 
- Visa / MasterCard credit
- Debit (EFTPOS or Visa or MasterCard)
- Amex / Diners</p>

<p>The dynamic surcharging settings are managed on Unify per merchant. In development, contact <a href="mailto:integrations@datameshgroup.com">DataMesh</a> to configure dynamic surcharging on your development account.</p>

<p>Dynamic surcharge example:</p>

<ol>
<li>Merchant enables dynamic surcharge on Unify for their terminal fleet and configures a 1.9% surcharge on Amex/Diners cards</li>
<li>Cashier opens $100 sale on the Sale System and initiates payment</li>
<li>Sale System sends a <a href="#cloud-api-reference-methods-payment">payment request</a> request to the POI Terminal and sets <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a> to $100</li>
<li>Card holder presents their Amex card</li>
<li>POI Terminal calcualtes new total based on the card type and processes a payment of $101.90 </li>
<li>POI Terminal approves payment and returns the result to the Sale System with 

<ul>
<li>A receipt containing lines with the requested amount, surcharge percentage, surcharge amount, and new total amount</li>
<li><a href="#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> set to $101.90</li>
<li><a href="#surchargeamount">PaymentResult.AmountsResp.SurchargeAmount</a> set to $1.90</li>
</ul></li>
<li>The Sale System records the <code>AuthorizedAmount</code>, and optionally records the <code>SurchargeAmount</code> of $1.90</li>
</ol>

<aside class="success">
The amount returned in <a href="#authorizedamount">AuthorizedAmount</a> in the payment result may be differ from the <a href="#requestedamount">RequestedAmount</a> sent in the payment request
</aside>
<h4 id='getting-started-design-your-integration-dynamic-surcharge-merchant-responsibilities'>Merchant responsibilities</h4>
<ul>
<li>Merchants are required to notify the cardholder that a surcharge will be applied. For example, by ensuring signage at the point of purchase</li>
<li>The RBA surcharge framework indicates merchants should review the level of any surcharge applied at least once a year</li>
<li>Any refund of a purchase with surcharge applied needs to include the full purchase + surcharge amount</li>
</ul>

<!-- 
### Pay at Table 
<aside class="warning">TODO</aside>
-->
<h1 id='cloud-api-reference'>Cloud API Reference</h1>
<p>The Fusion Cloud API allows the Sale System to communicate with a POI terminal via a Websocket connected to the DataMesh Unify switch. </p>
<h2 id='cloud-api-reference-reference-code'>Reference code</h2>
<ul>
<li>A DotNet NuGet package implementing the DataMesh Fusion API is available <a href="https://www.nuget.org/packages/DataMeshGroup.Fusion.FusionClient/">on Nuget</a></li>
<li>Source is on <a href="https://github.com/datameshgroup/sdk-dotnet">GitHub</a></li>
<li>Demo applications implementing the sdk are also available on <a href="https://github.com/datameshgroup/sdk-dotnet-purchasedemo">GitHub</a></li>
</ul>
<h2 id='cloud-api-reference-security-requirements'>Security requirements</h2>
<p>Unify utilises secure websockets for communication between Sale System and POI Server.</p>

<ul>
<li>The Sale System and merchant environment must support outgoing TCP connections to <code>*.datameshgroup.io:443</code> and <code>*.datameshgroup.io:5000</code> for both the terminal and Sale System</li>
<li>As a cloud service, Unify may run on several IP addresses. 

<ul>
<li>The Sale System must always use the DNS endpoints provided by DataMesh and never limit connectivity to a specific IP address</li>
</ul></li>
<li>The Sale System websocket connection must use TLS v1.2 or v1.3 with the SNI extension and one of the following ciphers:

<ul>
<li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 (TLS v1.2)</li>
<li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 (TLS v1.2)</li>
<li>TLS_AES_128_GCM_SHA256 (TLS v1.3)</li>
<li>TLS_CHACHA20_POLY1305_SHA256 (TLS v1.3)</li>
<li>TLS_AES_256_GCM_SHA384 (TLS v1.3)</li>
</ul></li>
<li>The Sale System must ensure the connection to Unify is trusted by validating the server-side certificate chain

<ul>
<li>Unify utilises a self-signed root CA provided by DataMesh which can be downloaded from <a href="files/rootca.datameshgroup.io.zip">here</a></li>
<li>Intermediate certificates in the chain will be provided by the TLS session</li>
<li>Contact <a href="mailto:integrations@datameshgroup.com">integrations@datameshgroup.com</a> for alternative connection methods if the supporting the DataMesh root CA is unmanageable (for example, in a browser-based POS)</li>
<li>If certificate validation fails the Sale System must display an error and drop the connection.</li>
</ul></li>
<li>The Sale System must resolve the DNS address before each connection attempt, and never hard code IP addresses</li>
<li>The Sale System should manage SSL certificate revocation lists and ensure OS security updates are applied</li>
<li>The Sale System should store the <a href="#data-dictionary-saleid">SaleID</a>, <a href="#data-dictionary-poiid">POIID</a>, and <a href="#data-dictionary-kek">KEK</a> in a secure location. These values are used to identify the Sale System and authenticate the <a href="#securitytrailer">SecurityTrailer</a></li>
</ul>

<!--  - Unify utilises one of the root CA's provided by [Sectigo](https://sectigo.com/resource-library/sectigo-root-intermediate-certificate-files) and [Digicert](https://www.digicert.com/kb/digicert-root-certificates.htm). The Sale System must ensure all certificate authorities from these sources are loaded into the certificate store used to validate the server. 
  - A full list of ca files can be downloaded from [here](files/root-ca-list.zip). -->

<aside class="success">
Over time, Data Mesh may require the Sale System to update the TLS requirements provided above if a security risk is identified. In this situation Data Mesh will provide the new requirements and allow a reasonable amount of time to allow the Sale System to meet the new requirements. 
</aside>
<h2 id='cloud-api-reference-endpoints'>Endpoints</h2>
<p>All endpoints are on port 443 and valid for secure websocket connections.</p>

<p>Production environment</p>

<p><code>wss://prod1.datameshgroup.io:5000</code></p>

<!--
`wss://nexo.aus.datameshgroup.io/nexocloudpos`
-->

<p>Test environment</p>

<p><code>wss://www.cloudposintegration.io/nexouat1</code></p>

<!--
`wss://nexo.aus.datameshgroup.io/nexocloudpos`


`wss://nexo.nonprod.aus.datameshgroup.io/nexocloudpos`
-->
<h2 id='cloud-api-reference-message-format'>Message format</h2>
<blockquote>
<p>SaleToPOIRequest</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"PaymentRequest"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>SaleToPOIResponse</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"PaymentResponse"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>All messages use JSON format with UTF-8 encoding. </p>

<p>Supported primitive data elements are:</p>

<ol>
<li><strong>String</strong> text string of variable length</li>
<li><strong>Boolean</strong> true or false</li>
<li><strong>Number</strong> defined in this document as either <code>integer</code> or <code>decimal</code>. For all number fields the Sale System <em>MUST</em> remove the digits equal to zero on left and the right of the value and any useless 
decimal point (eg. 00320.00 is expressed 320, and 56.10 is expressed 56.1). This simplifies parsing and MAC calculations.</li>
<li><strong>Null</strong> optional types can be represented as null</li>
</ol>

<aside class="success">
Additional fields will be added to the message specification over time. To ensure forwards compatibility 
the Sale System must ignore when extra objects and fields are present in response messages. 
</aside>

<p>The base of every message is the <code>SaleToPOIRequest</code> object for requests, and <code>SaleToPOIResponse</code> object for responses. </p>

<p>The <code>SaleToPOIRequest</code> and <code>SaleToPOIResponse</code> contain three objects: </p>

<ol>
<li>A <a href="#messageheader">MessageHeader</a> object.</li>
<li>A <a href="#payload">Payload</a> object of variable types.</li>
<li>A <a href="#securitytrailer">SecurityTrailer</a> object. </li>
</ol>
<h3 id='cloud-api-reference-message-format-messageheader'>MessageHeader</h3>
<blockquote>
<p>MessageHeader</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"ProtocolVersion"</span><span class="p">:</span><span class="s2">"3.1-dmg"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>A <code>MessageHeader</code> is included with each request and response. It defines the protocol, message type, sale and POI id.</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-protocolversion">ProtocolVersion</a></td>
<td>✔</td>
<td>String</td>
<td>Version of the Sale to POI protocol specifications. Set to &quot;3.1-dmg&quot;. Present when <code>MessageCategory</code> is &quot;Login&quot; otherwise absent.</td>
</tr>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>Informs the receiver of the class of message. Possible values are &quot;Service&quot;, &quot;Device&quot;, or &quot;Event&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the category of message. Possible values are &quot;CardAcquisition&quot;, &quot;Display&quot;, &quot;Login&quot;, &quot;Logout&quot;, &quot;Payment&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>Type of message. Possible values are &quot;Request&quot;, &quot;Response&quot;, or &quot;Notification&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the Sale System. The <a href="#data-dictionary-saleid">SaleID</a> is provided by DataMesh, and must match the SaleID configured in Unify.</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal. The <a href="#data-dictionary-poiid">POIID</a> is provided by DataMesh, and must match the POIID configured in Unify. For Sale Systems that do not need a POI Terminal, the value must be &quot;POI Server&quot;</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-message-format-payload'>Payload</h3>
<p>An object which defines fields for the request/response. The object name depends on the <a href="#data-dictionary-messagecategory">MessageCategory</a> defined in the <code>MessageHeader</code></p>

<p>e.g. a login will include <code>LoginRequest</code>/<code>LoginResponse</code>, and a payment will include a <code>PaymentRequest</code>/<code>PaymentResponse</code>.</p>

<p>The <a href="#cloud-api-reference">Cloud API Reference</a> outlines the expected payload for each supported request.  </p>
<h3 id='cloud-api-reference-message-format-securitytrailer'>SecurityTrailer</h3>
<blockquote>
<p>SecurityTrailer</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-ctauthData"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"AuthenticatedData"</span><span class="p">:{</span><span class="w">
   </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v0"</span><span class="p">,</span><span class="w">
 </span><span class="nl">"Recipient"</span><span class="p">:{</span><span class="w">
   </span><span class="nl">"KEK"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v4"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"KEKIdentifier"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"KeyIdentifier"</span><span class="p">:</span><span class="s2">"SpecV2TestMACKey"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"KeyVersion"</span><span class="p">:</span><span class="s2">"20191122164326.594"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"KeyEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"EncryptedKey"</span><span class="p">:</span><span class="s2">"834EAB305DD18724B9ADF361FC698CE0"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"MACAlgorithm"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"id-retail-cbc-mac-sha-256"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"EncapsulatedContent"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"iddata"</span><span class="w">
   </span><span class="p">},</span><span class="w">
   </span><span class="nl">"MAC"</span><span class="p">:</span><span class="s2">"C5142F4DB828AA1C"</span><span class="w">
 </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>A <code>SecurityTrailer</code> object is included with each request and response. </p>

<p>Unify authenticates requests from the Sale System by examining the <code>SecurityTrailer</code>, along with the <a href="#data-dictionary-saleid">SaleID</a>, <a href="#data-dictionary-poiid">POIID</a>, and <code>CertificationCode</code></p>

<p>Session Keys are used to generate/verify a Message Authentication Code (MAC) to prove the authenticity of transactions. They are also used to protect Sensitive Card Data if sent from the Sale System. Session keys must change for every message.</p>

<p><strong>SecurityTrailer</strong></p>

<table><thead>
<tr>
<th><div style="width:300px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#contenttype">ContentType</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;id-ctauthData&quot;</td>
</tr>
<tr>
<td><em>AuthenticatedData</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <a href="#version">Version</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;v0&quot;</td>
</tr>
<tr>
<td> <em>Recipient</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <em>KEK</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#version">Version</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;v4&quot;</td>
</tr>
<tr>
<td>   <em>KEKIdentifier</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>    <a href="#data-dictionary-keyidentifier">KeyIdentifier</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;SpecV2TestMACKey&quot; for test environment, and &quot;SpecV2ProdMACKey&quot; for production</td>
</tr>
<tr>
<td>    <a href="#data-dictionary-keyversion">KeyVersion</a></td>
<td>✔</td>
<td>String</td>
<td>An incrementing value. Either a counter or date formatted as YYYYMMDDHHmmss.mmm. See <a href="#data-dictionary-keyversion">KeyVersion</a></td>
</tr>
<tr>
<td>   <em>KeyEncryptionAlgorithm</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>    <a href="#data-dictionary-algorithm">Algorithm</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;des-ede3-cbc&quot;.</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-encryptedkey">EncryptedKey</a></td>
<td>✔</td>
<td>String</td>
<td>A double length 3DES key. See <a href="#data-dictionary-encryptedkey">EncryptedKey</a></td>
</tr>
<tr>
<td>  <em>MACAlgorithm</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-algorithm">Algorithm</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;id-retail-cbc-mac-sha-256&quot;</td>
</tr>
<tr>
<td>   <em>EncapsulatedContent</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>    <a href="#contenttype">ContentType</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;iddata&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-mac">MAC</a></td>
<td>✔</td>
<td>String</td>
<td>MAC of message content. See <a href="#data-dictionary-mac">MAC</a></td>
</tr>
</tbody></table>

<aside class="notice">
For brevity the <code>SecurityTrailer</code> has been excluded from examples.
</aside>
<h2 id='cloud-api-reference-perform-a-purchase'>Perform a purchase</h2>
<p>To perform a purchase the Sale System will need to implement requests, and handle responses outlined in the <a href="#getting-started-design-your-integration-payment-lifecycle">payment lifecycle</a>.</p>

<ul>
<li>If a login hasn&#39;t already been sent for the session, send a login request as detailed in <a href="#cloud-api-reference-methods-login">login request</a> 

<ul>
<li>Ensure &quot;PrinterReceipt&quot; is included in <a href="#data-dictionary-salecapabilities">SaleTerminalData.SaleCapabilities</a> if payment receipts are to be redirected to the Sale System</li>
</ul></li>
<li>Await the a login response and

<ul>
<li>Ensure the <a href="#data-dictionary-serviceid">ServiceID</a> in the result matches the request</li>
<li>Record the <a href="#data-dictionary-poiserialnumber">POISerialNumber</a> to be sent in subsequent login requests</li>
</ul></li>
<li>Send a payment request, including all required fields, as detailed in <a href="#cloud-api-reference-methods-payment">payment request</a> 

<ul>
<li>Set <a href="#data-dictionary-paymenttype">PaymentData.PaymentType</a> to &quot;Normal&quot;</li>
<li>Set the purchase amount in <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a></li>
<li>Set <a href="#data-dictionary-saletransactionid">SaleTransactionID</a> to a unique value for the sale on this Sale System</li>
<li>Populate the <a href="#data-dictionary-saleitem">SaleItem</a> array with the product basket for the transaction </li>
</ul></li>
<li>If configured in <a href="#data-dictionary-salecapabilities">SaleTerminalData.SaleCapabilities</a>, handle any <a href="#cloud-api-reference-methods-display">display</a>, <a href="#cloud-api-reference-methods-print">print</a>, and <a href="#cloud-api-reference-methods-input">input</a> events the POI System sends

<ul>
<li>The expected user interface handling is outlined in <a href="#user-interface">user interface</a></li>
<li>The expected payment receipt handling is outlined in <a href="#receipt-printing">receipt printing</a></li>
</ul></li>
<li>Await the payment response 

<ul>
<li>Ensure the <a href="#data-dictionary-serviceid">ServiceID</a> in the result matches the request</li>
<li>Check <a href="#data-dictionary-result">Response.Result</a> for the transaction result </li>
<li>If <a href="#data-dictionary-result">Response.Result</a> is &quot;Success&quot;, record the following to enable future matched refunds: <a href="#data-dictionary-saleid">SaleID</a>, <a href="#data-dictionary-poiid">POIID</a>, and <a href="#data-dictionary-poitransactionid">POITransactionID</a></li>
<li>Check <a href="#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> (it may not equal the <code>RequestedAmount</code> in the payment request)</li>
<li>If the Sale System is handling tipping or surcharge, check the <a href="#tipamount">PaymentResult.AmountsResp.TipAmount</a>, and <a href="#surchargeamount">PaymentResult.AmountsResp.SurchargeAmount</a></li>
<li>Print the receipt contained in <code>PaymentReceipt</code></li>
</ul></li>
<li>Implement error handling outlined in <a href="#cloud-api-reference-error-handling">error handling</a></li>
</ul>
<h2 id='cloud-api-reference-perform-a-refund'>Perform a refund</h2>
<!-- TODO need to add support here for matched refunds -->

<p>To perform a refund the Sale System will need to implement requests, and handle responses outlined in the <a href="#getting-started-design-your-integration-payment-lifecycle">payment lifecycle</a>.</p>

<p>If refunding a previous purchase, the Sale System should include details of the original purchase. </p>

<ul>
<li>If a login hasn&#39;t already been sent for the session, send a login request as detailed in <a href="#cloud-api-reference-methods-login">login request</a> 

<ul>
<li>Ensure &quot;PrinterReceipt&quot; is included in <a href="#data-dictionary-salecapabilities">SaleTerminalData.SaleCapabilities</a> if payment receipts are to be redirected to the Sale System</li>
</ul></li>
<li>Await the a login response and

<ul>
<li>Ensure the <a href="#data-dictionary-serviceid">ServiceID</a> in the result matches the request</li>
<li>Record the <a href="#data-dictionary-poiserialnumber">POISerialNumber</a> to be sent in subsequent login requests</li>
</ul></li>
<li>Send a payment request, including all required fields, as detailed in <a href="#cloud-api-reference-methods-payment">payment request</a> 

<ul>
<li>Set <a href="#data-dictionary-paymenttype">PaymentData.PaymentType</a> to &quot;Refund&quot;</li>
<li>Set the refund amount in <a href="#requestedamount">PaymentTransaction.AmountsReq.RequestedAmount</a></li>
<li>Set <a href="#data-dictionary-saletransactionid">SaleTransactionID</a> to a unique value for the sale on this Sale System</li>
<li>If refunding a previous purchase, set the following fields in <a href="#data-dictionary-originalpoitransaction">PaymentTransaction.OriginalPOITransaction</a></li>
<li>Set <a href="#data-dictionary-saleid">SaleID</a> to the <a href="#data-dictionary-saleid">SaleID</a> of the original purchase payment request </li>
<li>Set <a href="#data-dictionary-poiid">POIID</a> to the <a href="#data-dictionary-poiid">POIID</a> of the original purchase payment request </li>
<li>Set <a href="#data-dictionary-poitransactionid">POITransactionID</a> to the value returned in <a href="#data-dictionary-poitransactionid">POIData.POITransactionID</a> of the original purchase payment response </li>
<li>The product basket is not required for refunds</li>
</ul></li>
<li>If configured in <a href="#data-dictionary-salecapabilities">SaleTerminalData.SaleCapabilities</a>, handle any <a href="#cloud-api-reference-methods-display">display</a>, <a href="#cloud-api-reference-methods-print">print</a>, and <a href="#cloud-api-reference-methods-input">input</a> events the POI System sends

<ul>
<li>The expected user interface handling is outlined in <a href="#user-interface">user interface</a></li>
<li>The expected payment receipt handling is outlined in <a href="#receipt-printing">receipt printing</a></li>
</ul></li>
<li>Await the payment response 

<ul>
<li>Ensure the <a href="#data-dictionary-serviceid">ServiceID</a> in the result matches the request</li>
<li>Check <a href="#data-dictionary-result">Response.Result</a> for the transaction result </li>
<li>Check <a href="#authorizedamount">PaymentResult.AmountsResp.AuthorizedAmount</a> (it may not equal the <code>RequestedAmount</code> in the payment request)</li>
<li>Print the receipt contained in <code>PaymentReceipt</code></li>
</ul></li>
<li>Implement error handling outlined in <a href="#cloud-api-reference-error-handling">error handling</a></li>
</ul>
<h2 id='cloud-api-reference-methods'>Methods</h2><h3 id='cloud-api-reference-methods-login'>Login</h3>
<p>The Sale System sends a NEXO Login request when it is ready to pair with a POI terminal and 
before any Reconciliation Request. The Sale System can pair with multiple POI terminals by 
sending another NEXO Login request.</p>
<h4 id='cloud-api-reference-methods-login-login-request'>Login request</h4>
<blockquote>
<p>Login request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"ProtocolVersion"</span><span class="p">:</span><span class="s2">"3.1-dmg"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Login"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"LoginRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"DateTime"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleSoftware"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"ProviderIdentification"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ApplicationName"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SoftwareVersion"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"CertificationCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"SaleTerminalData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"TerminalEnvironment"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleCapabilities"</span><span class="p">:[</span><span class="w">
               </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"TotalsGroupID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"OperatorLanguage"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"OperatorID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ShiftNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POISerialNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-protocolversion">ProtocolVersion</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;3.1-dmg&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Login&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>LoginRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-datetime">DateTime</a></td>
<td>✔</td>
<td>String</td>
<td>Current Sale System time, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</td>
</tr>
<tr>
<td><strong>SaleSoftware</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object containing Sale System identification</td>
</tr>
<tr>
<td> <a href="#data-dictionary-provideridentification">ProviderIdentification</a></td>
<td>✔</td>
<td>String</td>
<td>The name of the company supplying the Sale System. Provided by DataMesh.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-applicationname">ApplicationName</a></td>
<td>✔</td>
<td>String</td>
<td>The name of the Sale System application. Provided by DataMesh.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-softwareversion">SoftwareVersion</a></td>
<td>✔</td>
<td>String</td>
<td>The software version of the Sale System. Must be the software version of the current build.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-certificationcode">CertificationCode</a></td>
<td>✔</td>
<td>String</td>
<td>Certification code for this Sale System. Provided by DataMesh.</td>
</tr>
<tr>
<td><strong>SaleTerminalData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object containing Sale System configuration</td>
</tr>
<tr>
<td> <a href="#data-dictionary-terminalenvironment">TerminalEnvironment</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Attended&quot;, &quot;SemiAttended&quot;, or &quot;Unattended&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
<td>✔</td>
<td>Array</td>
<td>Advises the POI System of the Sale System capabilities. See <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-totalsgroupid">TotalsGroupId</a></td>
<td></td>
<td>String</td>
<td>Groups transactions in a login session</td>
</tr>
<tr>
<td><a href="#operatorlanguage">OperatorLanguage</a></td>
<td></td>
<td>String</td>
<td>Operator language. Set to &#39;en&#39;</td>
</tr>
<tr>
<td><a href="#data-dictionary-operatorid">OperatorId</a></td>
<td></td>
<td>String</td>
<td>Groups transactions under this operator id</td>
</tr>
<tr>
<td><a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>Groups transactions under this shift number</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiserialnumber">POISerialNumber</a></td>
<td></td>
<td>String</td>
<td>The POISerialNumber from the last login response, or absent if this is the first login</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-login-login-response'>Login response</h4>
<blockquote>
<p>Login response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"ProtocolVersion"</span><span class="p">:</span><span class="s2">"3.1-dmg"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Login"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"LoginResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"POISystemData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"DateTime"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"POISoftware"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"ProviderIdentification"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ApplicationName"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"SoftwareVersion"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"POITerminalData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TerminalEnvironment"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"POICapabilities"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"POIProfile"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"GenericProfile"</span><span class="p">:</span><span class="s2">"Custom"</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="nl">"POISerialNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"POIStatus"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"GlobalStatus"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"PEDOKFlag"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CardReaderOKFlag"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"PrinterStatus"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CommunicationOKFlag"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"FraudPreventionFlag"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"TokenRequestStatus"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-protocolversion">ProtocolVersion</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;3.1-dmg&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Login&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
</tbody></table>

<p><strong>LoginResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Response</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object indicating the result of the login</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><strong>POISystemData</strong></td>
<td></td>
<td>Object</td>
<td>Only present when <code>Result</code> is &quot;Success&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-datetime">DateTime</a></td>
<td>✔</td>
<td>String</td>
<td>Time on the POI System, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</td>
</tr>
<tr>
<td> <a href="#tokenrequeststatus">TokenRequestStatus</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if POI tokenisation of PANs is available and usable</td>
</tr>
<tr>
<td> <strong>POITerminalData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object representing the POI Terminal</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-terminalenvironment">TerminalEnvironment</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td>  <a href="#poicapabilities">POICapabilities</a></td>
<td>✔</td>
<td>Array</td>
<td>An array of strings which reflect the hardware capabilities of the POI Terminal. &quot;MagStripe&quot;, &quot;ICC&quot;, and &quot;EMVContactless&quot;</td>
</tr>
<tr>
<td>  <a href="#genericprofile">GenericProfile</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;Custom&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-poiserialnumber">POISerialNumber</a></td>
<td>✔</td>
<td>String</td>
<td>If POIID is &quot;POI Server&quot;, then a virtual POI Terminal Serial Number. Otherwise the serial number of the POI Terminal</td>
</tr>
<tr>
<td> <strong>POIStatus</strong></td>
<td>✔</td>
<td>String</td>
<td>Object representing the current status of the POI Terminal</td>
</tr>
<tr>
<td>  <a href="#globalstatus">GlobalStatus</a></td>
<td>✔</td>
<td>String</td>
<td>The current status of the POI Terminal. &quot;OK&quot; when the terminal is available. &quot;Maintenance&quot; if unavailable due to maintenance processing. &quot;Unreachable&quot; if unreachable or not responding</td>
</tr>
<tr>
<td>  <a href="#securityokflag">SecurityOKFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if the security module is present</td>
</tr>
<tr>
<td>  <a href="#pedokflag">PEDOKFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if PED is available and usable for PIN entry</td>
</tr>
<tr>
<td>  <a href="#cardreaderokflag">CardReaderOKFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if card reader is available and usable</td>
</tr>
<tr>
<td>  <a href="#printerstatus">PrinterStatus</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates terminal printer status. Possible values are &quot;OK&quot;, &quot;PaperLow&quot;, &quot;NoPaper&quot;, &quot;PaperJam&quot;, &quot;OutOfOrder&quot;</td>
</tr>
<tr>
<td>  <a href="#communicationokflag">CommunicationOKFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if terminal&#39;s communication is available and usable</td>
</tr>
<tr>
<td>  <a href="#fraudpreventionflag">FraudPreventionFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if the POI detects possible fraud</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-logout'>Logout</h3>
<p>Logging out is optional.</p>

<p>If sent, it tells the POI system that it won’t send new transactions to the POI Terminal 
and unpairs the Sale Terminal from the POI Terminal. Any further transactions to that POI Terminal 
will be rejected by the POI System until the next Login.</p>

<p>The Sale System may send multiple Login requests without a Logout request.</p>
<h4 id='cloud-api-reference-methods-logout-logout-request'>Logout request</h4>
<blockquote>
<p>Logout request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Logout"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"LogoutRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MaintenanceAllowed"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Logout&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>LogoutRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-maintenanceallowed">MaintenanceAllowed</a></td>
<td></td>
<td>Boolean</td>
<td>Indicates if the POI Terminal can enter maintenance mode. Default to true if not present.</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-logout-logout-response'>Logout response</h4>
<blockquote>
<p>Logout response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Logout"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"LogoutResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"Response"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx xxxx xxxx xxxx xxxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Logout&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>LogoutResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Response</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object which represents the result of the response</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when result is &quot;Failure&quot;. Possible values are &quot;MessageFormat&quot;, &quot;Busy&quot;, &quot;DeviceOut&quot;, &quot;UnavailableService&quot; and others. Note the Sale System should handle error conditions outside the ones documented in this specification.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when result is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information of possible values.</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-payment'>Payment</h3>
<p>The payment message is used to perform purchase, purchase + cash out, cash out only, and refund requests. </p>
<h4 id='cloud-api-reference-methods-payment-payment-request'>Payment request</h4>
<blockquote>
<p>Payment request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Payment"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"PaymentRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"SaleData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"OperatorID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"OperatorLanguage"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ShiftNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleTransactionID"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"SaleReferenceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleTerminalData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TerminalEnvironment"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"SaleCapabilities"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"TotalsGroupID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"Customer | Transaction"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentTransaction"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"AmountsReq"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Currency"</span><span class="p">:</span><span class="s2">"AUD"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"RequestedAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CashBackAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TipAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"PaidAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MaximumCashBackAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MinimumSplitAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"OriginalPOITransaction"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"POITransactionID"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="nl">"ReuseCardDataFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ApprovalCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"LastTransactionFlag"</span><span class="p">:</span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"TransactionConditions"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"AllowedPaymentBrands"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"AcquirerID"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"DebitPreferredFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ForceOnlineFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MerchantCategoryCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"SaleItem"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"EanUpc"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"xx.x"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"xx.x"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"xx.x"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"TaxCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"SaleChannel"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"AdditionalProductInfo"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"CostBase"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Discount"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">],</span><span class="w">
                  </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"QuantityInStock"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Tags"</span><span class="p">:[</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">]</span><span class="w">
                  </span><span class="nl">"PageURL"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ImageURLs"</span><span class="p">:[</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">],</span><span class="w">
                  </span><span class="nl">"Size"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Colour"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Weight"</span><span class="p">:</span><span class="err">xx.xx</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"WeightUnitOfMeasure"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">                 
               </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"PaymentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PaymentInstrumentData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CardData"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"EntryMode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ProtectedCardData"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-envelopedData"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"EnvelopedData"</span><span class="p">:{</span><span class="w">
                        </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v0"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"Recipient"</span><span class="p">:{</span><span class="w">
                           </span><span class="nl">"KEK"</span><span class="p">:{</span><span class="w">
                              </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v4"</span><span class="p">,</span><span class="w">
                              </span><span class="nl">"KEKIdentifier"</span><span class="p">:{</span><span class="w">
                                 </span><span class="nl">"KeyIdentifier"</span><span class="p">:</span><span class="s2">"xxxDATKey"</span><span class="p">,</span><span class="w">
                                 </span><span class="nl">"KeyVersion"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                              </span><span class="p">},</span><span class="w">
                              </span><span class="nl">"KeyEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
                                 </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="w">
                              </span><span class="p">},</span><span class="w">
                              </span><span class="nl">"EncryptedKey"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                           </span><span class="p">}</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nl">"EncryptedContent"</span><span class="p">:{</span><span class="w">
                           </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-data"</span><span class="p">,</span><span class="w">
                           </span><span class="nl">"ContentEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
                              </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="p">,</span><span class="w">
                              </span><span class="nl">"Parameter"</span><span class="p">:{</span><span class="w">
                                 </span><span class="nl">"InitialisationVector"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                              </span><span class="p">}</span><span class="w">
                           </span><span class="p">},</span><span class="w">
                           </span><span class="nl">"EncryptedData"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                     </span><span class="p">}</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nl">"SensitiveCardData"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"PAN"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"ExpiryDate"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"CCV"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nl">"PaymentToken"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"TokenValue"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Payment&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>PaymentRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:200px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>SaleData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Sale System information attached to this payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-operatorid">OperatorID</a></td>
<td></td>
<td>String</td>
<td>Only required if different from Login Request</td>
</tr>
<tr>
<td> <a href="#operatorlanguage">OperatorLanguage</a></td>
<td></td>
<td>String</td>
<td>Set to &quot;en&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>Only required if different from Login Request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-salereferenceid">SaleReferenceID</a></td>
<td></td>
<td>String</td>
<td>Mandatory for pre-authorisation and completion, otherwise optional. See <a href="#data-dictionary-salereferenceid">SaleReferenceID</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td></td>
<td>String</td>
<td>If present, indicates which type of token should be created for this payment. See <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
</tr>
<tr>
<td> <strong>SaleTransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique reference for this sale ticket. Not necessarily unique per payment request; for example a sale with split payments will have a number of payments with the same <a href="#data-dictionary-transactionid">TransactionID</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time of initiating the payment request on the POI System, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</td>
</tr>
<tr>
<td> <strong>SaleTerminalData</strong></td>
<td></td>
<td>Object</td>
<td>Define Sale System configuration. Only include if elements within have different values to those in Login Request</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-terminalenvironment">TerminalEnvironment</a></td>
<td></td>
<td>String</td>
<td>&quot;Attended&quot;, &quot;SemiAttended&quot;, or &quot;Unattended&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
<td></td>
<td>Array</td>
<td>Advises the POI System of the Sale System capabilities. See <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-totalsgroupid">TotalsGroupId</a></td>
<td></td>
<td>String</td>
<td>Groups transactions in a login session</td>
</tr>
<tr>
<td><strong>PaymentTransaction</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <strong>AmountsReq</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object which contains the various components which make up the payment amount</td>
</tr>
<tr>
<td>  <a href="#currency">Currency</a></td>
<td>✔</td>
<td>String</td>
<td>Three character currency code. Set to &quot;AUD&quot;</td>
</tr>
<tr>
<td>  <a href="#requestedamount">RequestedAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>The requested amount for the transaction sale items, including cash back and tip requested</td>
</tr>
<tr>
<td>  <a href="#cashbackamount">CashBackAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The Cash back amount. Only if cash back is included in the transaction by the Sale System</td>
</tr>
<tr>
<td>  <a href="#tipamount">TipAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The Tip amount. Only if tip is included in the transaction</td>
</tr>
<tr>
<td>  <a href="#paidamount">PaidAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Sum of the amount of sale items – <code>RequestedAmount</code>. Present only if an amount has already been paid in the case of a split payment.</td>
</tr>
<tr>
<td>  <a href="#maximumcashbackamount">MaximumCashBackAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Available if <code>CashBackAmount</code> is not present. If present, the POI Terminal prompts for the cash back amount up to a maximum of <code>MaximumCashBackAmount</code></td>
</tr>
<tr>
<td>  <a href="#minimumsplitamount">MinimumSplitAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Present only if the POI Terminal can process an amount &lt; <code>RequestedAmount</code> as a split amount. Limits the minimum split amount allowed.</td>
</tr>
<tr>
<td> <strong><a href="#data-dictionary-originalpoitransaction">OriginalPOITransaction</a></strong></td>
<td></td>
<td>Object</td>
<td>Identifies a previous POI transaction. Mandatory for Refund and Completion. See <a href="#data-dictionary-originalpoitransaction">OriginalPOITransaction</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td><a href="#data-dictionary-saleid">SaleID</a> which performed the original transaction</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td><a href="#data-dictionary-poiid">POIID</a> which performed the original transaction</td>
</tr>
<tr>
<td>  <strong>POITransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td><code>TransactionID</code> from the original transaction</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td><code>TimeStamp</code> from the original transaction</td>
</tr>
<tr>
<td>  <a href="#reusecarddataflag">ReuseCardDataFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If &#39;true&#39; the POI Terminal will retrieve the card data from file based on the <code>PaymentToken</code> included in the request. Otherwise the POI Terminal will read the same card again.</td>
</tr>
<tr>
<td>  <a href="#approvalcode">ApprovalCode</a></td>
<td></td>
<td>String</td>
<td>Present if a referral code is obtained from an Acquirer</td>
</tr>
<tr>
<td>  <a href="#lasttransactionflag">LastTransactionFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>Set to true to process the Last Transaction with a referral code</td>
</tr>
<tr>
<td> <strong>TransactionConditions</strong></td>
<td></td>
<td>Object</td>
<td>Optional transaction configuration. Present only if any of the JSON elements within are present.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-allowedpaymentbrands">AllowedPaymentBrands</a></td>
<td></td>
<td>Array</td>
<td>Restricts the request to specified card brands. See <a href="#data-dictionary-allowedpaymentbrands">AllowedPaymentBrands</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymenttransaction.transactionconditions.acquirerid">AcquirerID</a></td>
<td></td>
<td>Array</td>
<td>Used to restrict the payment to specified acquirers. See <a href="#data-dictionary-paymenttransaction.transactionconditions.acquirerid">AcquirerID</a></td>
</tr>
<tr>
<td>  <a href="#debitpreferredflag">DebitPreferredFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If present, debit processing is preferred to credit processing.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-forceonlineflag">ForceOnlineFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If &#39;true&#39; the transaction will only be processed in online mode, and will fail if there is no response from the Acquirer.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-merchantcategorycode">MerchantCategoryCode</a></td>
<td></td>
<td>String</td>
<td>If present, overrides the MCC used for processing the transaction if allowed. Refer to ISO 18245 for available codes.</td>
</tr>
<tr>
<td> <strong><a href="#data-dictionary-saleitem">SaleItem</a></strong></td>
<td>✔</td>
<td>Array</td>
<td>Array of <a href="#data-dictionary-saleitem">SaleItem</a> objects which represent the product basket attached to this transaction. See <a href="#data-dictionary-saleitem">SaleItem</a> for examples.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-itemid">ItemID</a></td>
<td>✔</td>
<td>Integer</td>
<td>A unique identifier for the sale item within the context of this payment. e.g. a 0..n integer which increments by one for each sale item.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-productcode">ProductCode</a></td>
<td>✔</td>
<td>String</td>
<td>A unique identifier for the product within the merchant, such as the SKU. For example if two customers purchase the same product at two different stores owned by the merchant, both purchases should contain the same <code>ProductCode</code>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-eanupc">EanUpc</a></td>
<td></td>
<td>String</td>
<td>A standard unique identifier for the product. Either the UPC, EAN, or ISBN. Required for products with a UPC, EAN, or ISBN</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-unitofmeasure">UnitOfMeasure</a></td>
<td>✔</td>
<td>String</td>
<td>Unit of measure of the <code>Quantity</code>. If this item has no unit of measure, set to &quot;Other&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-quantity">Quantity</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Sale item quantity based on <code>UnitOfMeasure</code>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-unitprice">UnitPrice</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Price per sale item unit. Present if <code>Quantity</code> is included.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-itemamount">ItemAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Total amount of the sale item</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-taxcode">TaxCode</a></td>
<td></td>
<td>String</td>
<td>Type of tax associated with the sale item. Default = &quot;GST&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-salechannel">SaleChannel</a></td>
<td></td>
<td>String</td>
<td>Commercial or distribution channel of the sale item. Default = &quot;Unknown&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-productlabel">ProductLabel</a></td>
<td>✔</td>
<td>String</td>
<td>a short, human readable, descriptive name of the product.  For example, <code>ProductLabel</code> could contain the product name typically printed on the customer receipt.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-additionalproductinfo">AdditionalProductInfo</a></td>
<td></td>
<td>String</td>
<td>Additional information, or more detailed description of the product item.</td>
</tr>
<tr>
<td>  <a href="#parentitemid">ParentItemID</a></td>
<td></td>
<td>Integer</td>
<td><em>Required</em> if this item is a &#39;modifier&#39; or sub-item. Contains the <a href="#data-dictionary-itemid">ItemID</a> of the parent <code>SaleItem</code></td>
</tr>
<tr>
<td>  <a href="#costbase">CostBase</a></td>
<td></td>
<td>Decimal</td>
<td>Cost of the product to the merchant per unit</td>
</tr>
<tr>
<td>  <a href="#discount">Discount</a></td>
<td></td>
<td>Decimal</td>
<td>If applied, the amount this sale item was discounted by</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-categories">Categories</a></td>
<td></td>
<td>Array</td>
<td>Array of categories. Top level &quot;main&quot; category at categories[0]. See <a href="#data-dictionary-categories">Categories</a> for more information.</td>
</tr>
<tr>
<td>  <a href="#brand">Brand</a></td>
<td></td>
<td>String</td>
<td>Brand name - typically visible on the product packaging or label</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-quantityinstock">QuantityInStock</a></td>
<td></td>
<td>Decimal</td>
<td>Remaining number of this item in stock in same unit of measure as <code>Quantity</code></td>
</tr>
<tr>
<td>  <a href="#sale-item-tags">Tags</a></td>
<td></td>
<td>Array</td>
<td>String array with descriptive tags for the product</td>
</tr>
<tr>
<td>  <a href="#restricted">Restricted</a></td>
<td></td>
<td>Boolean</td>
<td><code>true</code> if this is a restricted item, <code>false</code> otherwise. Defaults to <code>false</code> when field is null.</td>
</tr>
<tr>
<td>  <a href="#productpageurl">PageURL</a></td>
<td></td>
<td>String</td>
<td>URL link to the sale items product page</td>
</tr>
<tr>
<td>  <a href="#productimageurls">ImageURLs</a></td>
<td></td>
<td>Array</td>
<td>String array of images URLs for this sale item</td>
</tr>
<tr>
<td>  <a href="#style">Style</a></td>
<td></td>
<td>String</td>
<td>Style of the sale item</td>
</tr>
<tr>
<td>  <a href="#size">Size</a></td>
<td></td>
<td>String</td>
<td>Size of the sale item</td>
</tr>
<tr>
<td>  <a href="#colour">Colour</a></td>
<td></td>
<td>String</td>
<td>Colour of the sale item</td>
</tr>
<tr>
<td>  <a href="#weight">Weight</a></td>
<td></td>
<td>Decimal</td>
<td>Sale item weight, based on <code>WeightUnitOfMeasure</code></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-unitofmeasure">WeightUnitOfMeasure</a></td>
<td></td>
<td>String</td>
<td>Unit of measure of the <code>Weight</code>.</td>
</tr>
<tr>
<td> <strong>PaymentData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object representing the payment method. Present only if any of the JSON elements within are present.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymenttype">PaymentType</a></td>
<td>✔</td>
<td>String</td>
<td>Defaults to &quot;Normal&quot;. Indicates the type of payment to process. &quot;Normal&quot;, &quot;Refund&quot;, or &quot;CashAdvance&quot;. See <a href="#data-dictionary-paymenttype">PaymentType</a></td>
</tr>
<tr>
<td>  <strong><a href="#data-dictionary-paymentinstrumentdata">PaymentInstrumentData</a></strong></td>
<td></td>
<td>Object</td>
<td>Object with represents card details for token or manually enter card details. See  for object structure</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-payment-payment-response'>Payment response</h4>
<blockquote>
<p>Payment response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Payment"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"PaymentResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"Success| Partial | Failure"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"SaleData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"SaleTransactionID"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"SaleReferenceID"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"POIData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"POITransactionID"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"POIReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentResult"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"PaymentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PaymentInstrumentData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CardData"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"EntryMode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"PaymentBrand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Account"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"MaskedPAN"</span><span class="p">:</span><span class="s2">"xxxxxx…xxxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"PaymentToken"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"TokenValue"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"ExpiryDateTime"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"AmountsResp"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Currency"</span><span class="p">:</span><span class="s2">"AUD"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AuthorizedAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TotalFeesAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CashBackAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TipAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"SurchargeAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"OnlineFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PaymentAcquirerData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"AcquirerID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MerchantID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AcquirerPOIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AcquirerTransactionID"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="nl">"ApprovalCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ResponseCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"HostReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"AllowedProductCodes"</span><span class="p">:[</span><span class="w">
            </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"3"</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nl">"PaymentReceipt"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nl">"DocumentQualifier"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"RequiredSignatureFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"OutputContent"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"XHTML"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"OutputXHTML"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Payment&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
</tbody></table>

<p><strong>PaymentResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:200px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Response</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object indicating the result of the payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><strong>SaleData</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <strong>SaleTransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-salereferenceid">SaleReferenceID</a></td>
<td></td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><strong>POIData</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <strong>POITransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique transaction id from the POI system</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time on the POI system, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
<td></td>
<td>String</td>
<td>Present if <code>Result</code> is &quot;Success&quot; or &quot;Partial&quot;. See <a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
</tr>
<tr>
<td><strong>PaymentResult</strong></td>
<td></td>
<td>Object</td>
<td>Object related to a processed payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-paymenttype">PaymentType</a></td>
<td></td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td> <strong>PaymentInstrumentData</strong></td>
<td></td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymentinstrumenttype">PaymentInstrumentType</a></td>
<td></td>
<td>String</td>
<td>&quot;Card&quot; or &quot;Mobile&quot;</td>
</tr>
<tr>
<td>  <strong>CardData</strong></td>
<td></td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-entrymode">EntryMode</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates how the card was presented. See <a href="#data-dictionary-entrymode">EntryMode</a></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-paymentbrand">PaymentBrand</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the card type used. See <a href="#data-dictionary-paymentbrand">PaymentBrand</a></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-maskedpan">MaskedPAN</a></td>
<td>✔</td>
<td>String</td>
<td>PAN masked with dots, first 6 and last 4 digits visible</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-account">Account</a></td>
<td></td>
<td>String</td>
<td>Present if <code>EntryMode</code> is &quot;MagStripe&quot;, &quot;ICC&quot;, or &quot;Tapped&quot;. Indicates the card account used. See <a href="#data-dictionary-account">Account</a></td>
</tr>
<tr>
<td>   <strong>PaymentToken</strong></td>
<td></td>
<td>Object</td>
<td>Object representing a token. Only present if token was requested</td>
</tr>
<tr>
<td>    <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td>    <a href="#tokenvalue">TokenValue</a></td>
<td>✔</td>
<td>String</td>
<td>The value of the token</td>
</tr>
<tr>
<td>    <a href="#expirydatetime">ExpiryDateTime</a></td>
<td>✔</td>
<td>String</td>
<td>Expiry of the token, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td> <strong>AmountsResp</strong></td>
<td></td>
<td>Object</td>
<td>Present if <code>Result</code> is &quot;Success&quot; or &quot;Partial&quot;</td>
</tr>
<tr>
<td>  <a href="#currency">Currency</a></td>
<td></td>
<td>String</td>
<td>&quot;AUD&quot;</td>
</tr>
<tr>
<td>  <a href="#authorizedamount">AuthorizedAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Authorised amount which could be more, or less than the requested amount</td>
</tr>
<tr>
<td>  <a href="#totalfeesamount">TotalFeesAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Total of financial fees associated with the payment transaction if known at time of transaction</td>
</tr>
<tr>
<td>  <a href="#cashbackamount">CashBackAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Cash back paid amount</td>
</tr>
<tr>
<td>  <a href="#tipamount">TipAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The amount of any tip added to the transaction</td>
</tr>
<tr>
<td>  <a href="#surchargeamount">SurchargeAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The amount of any surcharge added to the transaction</td>
</tr>
<tr>
<td> <a href="#onlineflag">OnlineFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if the transaction was processed online, false otherwise</td>
</tr>
<tr>
<td> <strong>PaymentAcquirerData</strong></td>
<td></td>
<td>Object</td>
<td>Data related to the response from the payment acquirer</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymentacquirerdata.acquirerid">AcquirerID</a></td>
<td>✔</td>
<td>String</td>
<td>The ID of the acquirer which processed the transaction</td>
</tr>
<tr>
<td>  <a href="#merchantid">MerchantID</a></td>
<td>✔</td>
<td>String</td>
<td>The acquirer merchant ID (MID)</td>
</tr>
<tr>
<td>  <a href="#acquirerPOIID">AcquirerPOIID</a></td>
<td>✔</td>
<td>String</td>
<td>The acquirer terminal ID (TID)</td>
</tr>
<tr>
<td>  <strong>AcquirerTransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>The acquirer transaction ID</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Timestamp from the acquirer, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td>  <a href="#approvalcode">ApprovalCode</a></td>
<td>✔</td>
<td>String</td>
<td>The Acquirer Approval Code. Also referred to as the Authentication Code</td>
</tr>
<tr>
<td>  <a href="#responsecode">ResponseCode</a></td>
<td>✔</td>
<td>String</td>
<td>The Acquirer Response Code. Also referred as the PINPad response code</td>
</tr>
<tr>
<td>  <a href="#stan">STAN</a></td>
<td></td>
<td>String</td>
<td>The Acquirer STAN if available</td>
</tr>
<tr>
<td>  <a href="#rrn">RRN</a></td>
<td></td>
<td>String</td>
<td>The Acquirer RRN if available</td>
</tr>
<tr>
<td>  <a href="#hostreconciliationid">HostReconciliationID</a></td>
<td>✔</td>
<td>String</td>
<td>Identifier of a reconciliation period with the acquirer. This normally has a date and time component in it</td>
</tr>
<tr>
<td> <a href="#allowedproductcodes">AllowedProductCodes</a></td>
<td></td>
<td>Array</td>
<td>Present if <code>ErrorCondition</code> is &quot;PaymentRestriction&quot;. Consists of a list of product codes corresponding to products that are purchasable with the given card. Items that exist in the basket but do not belong to this list corresponds to restricted items</td>
</tr>
<tr>
<td> <strong>PaymentReceipt</strong></td>
<td></td>
<td>Array</td>
<td>Array of payment receipt objects which represent receipts to be printed</td>
</tr>
<tr>
<td>  <a href="#documentqualifier">DocumentQualifier</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;CashierReceipt&quot; for a merchant receipt, otherwise &quot;CustomerReceipt&quot;</td>
</tr>
<tr>
<td>  <a href="#requiredsignatureflag">RequiredSignatureFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>If true, the card holder signature is required on the merchant CashierReceipt.</td>
</tr>
<tr>
<td>  <strong>OutputContent</strong></td>
<td></td>
<td>Array</td>
<td>Array of payment receipt objects which represent receipts to be printed</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-outputformat">OutputFormat</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;XHTML&quot;</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-outputxhtml">OutputXHTML</a></td>
<td>✔</td>
<td>String</td>
<td>The payment receipt in XHTML format but coded in BASE64</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-display'>Display</h3>
<p>During a payment, the POI System will send status and error display requests to the Sale System, which enables the Sale System to inform the cashier of the current transaction status.</p>

<p>Follow the <a href="#user-interface">user interface</a> guide for details on how to implement the required UI to handle display and input requests.</p>
<h4 id='cloud-api-reference-methods-display-display-request'>Display request</h4>
<blockquote>
<p>Display request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Display"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"DisplayRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"DisplayOutput"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"ResponseRequiredFlag"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"CashierDisplay"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"OutputContent"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"OutputText"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"Text"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Device&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Display&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment</td>
</tr>
</tbody></table>

<p><strong>DisplayRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>DisplayOutput</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object which represents the display</td>
</tr>
<tr>
<td> <a href="#data-dictionary-responserequiredflag">ResponseRequiredFlag</a></td>
<td></td>
<td>Boolean</td>
<td>Indicates if the POI System requires a <code>DisplayResponse</code> to be sent for this <code>DisplayRequest</code></td>
</tr>
<tr>
<td> <a href="#device">Device</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;CashierDisplay&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Status&quot; or &quot;Error&quot;. See <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-outputformat">OutputFormat</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Text&quot;</td>
</tr>
<tr>
<td> <a href="#text">Text</a></td>
<td>✔</td>
<td>String</td>
<td>Single line of text to display</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-display-display-response'>Display response</h4>
<blockquote>
<p>Display response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Display"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"DisplayResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"OutputResult"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>The Sale System is expected to send a <code>DisplayResponse</code> if one or more displays in <code>DisplayOutput</code> have <a href="#data-dictionary-responserequiredflag">ResponseRequiredFlag</a> set to true.</p>

<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Device&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Display&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from display request</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from display request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from display request</td>
</tr>
</tbody></table>

<p><strong>DisplayResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>OutputResult</em></td>
<td>✔</td>
<td>Object</td>
<td>Response for Device/InfoQualify pair where corresponding <code>ResponseRequiredFlag</code> in the <code>DisplayRequest</code> is set to true.</td>
</tr>
<tr>
<td> <a href="#device">Device</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from display request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from display request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Success&quot;, &quot;Partial&quot;, or &quot;Failure&quot;. See <a href="#data-dictionary-result">Result</a>.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-input'>Input</h3>
<aside class="warning">
The <code>Input UI</code> elements are not currently available, and will be supported by a future Unify release. Support for these elements by the Sale System is optional.
</aside>

<p>During a payment, the POI System will input requests to the Sale System if cashier interaction is required (e.g. signature approved yes/no)</p>

<p>Follow the <a href="#user-interface">user interface</a> guide for details on how to implement the required UI to handle display and input requests.</p>
<h4 id='cloud-api-reference-methods-input-input-request'>Input request</h4>
<blockquote>
<p>Input request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Input"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"InputRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"DisplayOutput"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"CashierDisplay"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"POIReplication"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"OutputContent"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"OutputText"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"Text"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"MenuEntry"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"Text"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"OutputText"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"Text"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"InputData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"CashierInput"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InputCommand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"MaxInputTime"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"MinLength"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"MaxLength"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"MaskCharactersFlag"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Device&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Input&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique message identifier</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
</tbody></table>

<p><strong>InputRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>DisplayOutput</strong></td>
<td></td>
<td>Object</td>
<td>Information to display and the way to process the display.</td>
</tr>
<tr>
<td> <a href="#device">Device</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;CashierDisplay&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;POIReplication&quot;. See <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
</tr>
<tr>
<td> <strong>OutputContent</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-outputformat">OutputFormat</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Text&quot;</td>
</tr>
<tr>
<td>  <strong>OutputText</strong></td>
<td>✔</td>
<td>Object</td>
<td>Wrapper for text content</td>
</tr>
<tr>
<td>   <a href="#text">Text</a></td>
<td>✔</td>
<td>String</td>
<td>Single line of text. e.g. &quot;Signature Ok?&quot;, &quot;Merchant Password&quot;, &quot;Select Account Type&quot;</td>
</tr>
<tr>
<td> <strong>MenuEntry</strong></td>
<td></td>
<td>Array</td>
<td>Conditional. Array of items to be presented as a menu. Only present if <a href="#data-dictionary-inputcommand">InputCommand</a> = &quot;GetMenuEntry&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-outputformat">OutputFormat</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Text&quot;</td>
</tr>
<tr>
<td>  <a href="#text">Text</a></td>
<td>✔</td>
<td>String</td>
<td>One of the selection String items for the cashier to select from. For example: &quot;Savings&quot;, &quot;Cheque&quot; and &quot;Credit&quot; for an account type selection.</td>
</tr>
<tr>
<td><strong>InputData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Information related to an <code>Input</code> request</td>
</tr>
<tr>
<td> <a href="#device">Device</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;CashierInput&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Input&quot; or &quot;CustomerAssistance&quot;. See <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-inputcommand">InputCommand</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;GetConfirmation&quot;, &quot;Password&quot;, &quot;TextString&quot;, &quot;DigitString&quot;, &quot;DecimalString&quot;, or &quot;GetMenuEntry&quot;. See <a href="#data-dictionary-inputcommand">InputCommand</a></td>
</tr>
<tr>
<td> <a href="#maxinputtime">MaxInputTime</a></td>
<td></td>
<td>Number</td>
<td>The maximum number of seconds allowed for providing input.  Note the Sale Terminal needs to abort the Input process if it receives a DisplayRequest or InputRequest whilst waiting on input from the Cashier.</td>
</tr>
<tr>
<td> <a href="#minlength">MinLength</a></td>
<td></td>
<td>Number</td>
<td>The minimum number of characters allowed for entry. Present if <a href="#data-dictionary-inputcommand">InputCommand</a> = &quot;Password&quot;, &quot;TextString&quot;, &quot;DigitString&quot;, or &quot;DecimalString&quot;</td>
</tr>
<tr>
<td> <a href="#maxlength">MaxLength</a></td>
<td></td>
<td>Number</td>
<td>The maximum number of characters allowed for entry. Present if <a href="#data-dictionary-inputcommand">InputCommand</a> = &quot;Password&quot;, &quot;TextString&quot;, &quot;DigitString&quot;, or &quot;DecimalString&quot;</td>
</tr>
<tr>
<td> <a href="#maskcharactersflag">MaskCharactersFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If true, input should be masked with &#39;*&#39;. Present if <a href="#data-dictionary-inputcommand">InputCommand</a> = &quot;Password&quot;</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-input-input-response'>Input response</h4>
<blockquote>
<p>Input response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Input"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"InputResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"OutputResult"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"CashierDisplay"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"POIReplication"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"InputResult"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Device"</span><span class="p">:</span><span class="s2">"CashierInput"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"InfoQualify"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"Input"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"InputCommand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ConfirmedFlag"</span><span class="p">:</span><span class="s2">"true or false"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"Password"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MenuEntryNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Device&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Input&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
</tbody></table>

<p><strong>InputResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>OutputResult</em></td>
<td></td>
<td>Object</td>
<td>Present if <code>DisplayOutput</code> is present in the request</td>
</tr>
<tr>
<td> <a href="#device">Device</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td> <em>Response</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Success&quot;, &quot;Partial&quot;, or &quot;Failure&quot;. See <a href="#data-dictionary-result">Result</a>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><em>InputResult</em></td>
<td>✔</td>
<td>Object</td>
<td>Information related to the result the input</td>
</tr>
<tr>
<td> <a href="#device">Device</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-infoqualify">InfoQualify</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td> <em>Response</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Success&quot;, &quot;Partial&quot;, or &quot;Failure&quot;. See <a href="#data-dictionary-result">Result</a>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td> <em>Input</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-inputcommand">InputCommand</a></td>
<td></td>
<td>String</td>
<td>Mirrored from input request</td>
</tr>
<tr>
<td>  <a href="#confirmedflag">ConfirmedFlag</a></td>
<td></td>
<td>Boolean</td>
<td>Result of GetConfirmation input request. Present if <a href="#data-dictionary-inputcommand">InputCommand</a> = &quot;GetConfirmation&quot;</td>
</tr>
<tr>
<td>  <a href="#password">Password</a></td>
<td></td>
<td>String</td>
<td>Password entered by the Cashier. Mandatory, if <a href="#data-dictionary-inputcommand">InputCommand</a> is &quot;Password&quot;. Not allowed, otherwise</td>
</tr>
<tr>
<td>  <a href="#menuentrynumber">MenuEntryNumber</a></td>
<td></td>
<td>Number</td>
<td>A number from 1 to n, when n is total number of objects in <code>MenuEntry</code> of <code>InputRequest</code>. Mandatory, if <a href="#data-dictionary-inputcommand">InputCommand</a> is &quot;GetMenuEntry&quot;. Not allowed, otherwise</td>
</tr>
<tr>
<td>  <a href="#textinput">TextInput</a></td>
<td></td>
<td>String</td>
<td>Value entered by the Cashier. Mandatory, if <a href="#data-dictionary-inputcommand">InputCommand</a> is &quot;TextString&quot; or &quot;DecimalString&quot;. Not allowed, otherwise</td>
</tr>
<tr>
<td>  <a href="#digitinput">DigitInput</a></td>
<td></td>
<td>String</td>
<td>Value entered by the Cashier. Mandatory, if <a href="#data-dictionary-inputcommand">InputCommand</a> is &quot;DigitInput&quot;. Not allowed, otherwise</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-print'>Print</h3>
<p>During a payment, the POI System may send print requests to the Sale System if a receipt is to be printed before the payment response can be finalised (e.g. when a signature is required).</p>

<p>In this case the Sale System should examine the properties in the print request and print the receipt accordingly. </p>

<p>The final payment receipt, which is to be included in the Sale receipt, is returned in the payment response.</p>
<h4 id='cloud-api-reference-methods-print-print-request'>Print request</h4>
<blockquote>
<p>Print request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Print"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"PrintRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"PrintOutput"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"DocumentQualifier"</span><span class="p">:</span><span class="s2">"CashierReceipt"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"IntegratedPrintFlag"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
            </span><span class="nl">"RequiredSignatureFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"OutputContent"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"XHTML"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"OutputXHTML"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
        </span><span class="p">},</span><span class="w">  
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Device&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Print&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique message identifier</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
</tbody></table>

<p><strong>PrintRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td> <strong>PrintOutput</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#documentqualifier">DocumentQualifier</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;CashierReceipt&quot; for a merchant receipt, otherwise &quot;CustomerReceipt&quot;</td>
</tr>
<tr>
<td>  <a href="#integratedprintflag">IntegratedPrintFlag</a></td>
<td></td>
<td>Boolean</td>
<td>True if the receipt should be included with the Sale receipt, false if the receipt should be printed now and paper cut (e.g. for a signature receipt)</td>
</tr>
<tr>
<td>  <a href="#requiredsignatureflag">RequiredSignatureFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>If true, the card holder signature is required on the merchant CashierReceipt.</td>
</tr>
<tr>
<td>  <strong>OutputContent</strong></td>
<td></td>
<td>Array</td>
<td>Array of payment receipt objects which represent receipts to be printed</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-outputformat">OutputFormat</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;XHTML&quot;</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-outputxhtml">OutputXHTML</a></td>
<td>✔</td>
<td>String</td>
<td>The payment receipt in XHTML format but coded in BASE64</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-print-print-response'>Print response</h4>
<blockquote>
<p>Print response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Device"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Print"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"PrintResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"DocumentQualifier"</span><span class="p">:</span><span class="s2">"CashierReceipt"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Device&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Print&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from print request</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from print request</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from print request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from print request</td>
</tr>
</tbody></table>

<p><strong>PrintResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#documentqualifier">DocumentQualifier</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from print request</td>
</tr>
<tr>
<td> <em>Response</em></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Success&quot;, &quot;Partial&quot;, or &quot;Failure&quot;. See <a href="#data-dictionary-result">Result</a>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-transaction-status'>Transaction status</h3>
<p>A transaction status request can be used to obtain the status of a previous transaction. Required for error handling. </p>
<h4 id='cloud-api-reference-methods-transaction-status-transaction-status-request'>Transaction status request</h4>
<blockquote>
<p>Transaction status request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"TransactionStatus"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"TransactionStatusRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageReference"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;TransactionStatus&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>TransactionStatusRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>MessageReference</em></td>
<td></td>
<td>Object</td>
<td>Identification of a previous POI transaction. Present if it contains any data.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td></td>
<td>String</td>
<td>&quot;Payment&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-serviceid">ServiceID</a></td>
<td></td>
<td>String</td>
<td>The <a href="#data-dictionary-serviceid">ServiceID</a> of the transaction to retrieve the status of. If not included the last payment status is returned.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-saleid">SaleID</a></td>
<td></td>
<td>String</td>
<td>The <a href="#data-dictionary-saleid">SaleID</a> of the transaction to retrieve the status of. Only required if different from the <a href="#data-dictionary-saleid">SaleID</a> provided in the <code>MessageHeader</code></td>
</tr>
<tr>
<td> <a href="#data-dictionary-poiid">POIID</a></td>
<td></td>
<td>String</td>
<td>The <a href="#data-dictionary-poiid">POIID</a> of the transaction to retrieve the status of. Only required if different from the <a href="#data-dictionary-poiid">POIID</a> provided in the <code>MessageHeader</code></td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-transaction-status-transaction-status-response'>Transaction status response</h4>
<blockquote>
<p>Transaction status response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"TransactionStatus"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"TransactionStatusResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"MessageReference"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"RepeatedMessageResponse"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
            </span><span class="nl">"RepeatedResponseMessageBody"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"PaymentResponse"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
               </span><span class="nl">"ReversalResponse"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;TransactionStatus&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request</td>
</tr>
</tbody></table>

<p><strong>TransactionStatusResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>Response</em></td>
<td>✔</td>
<td>Object</td>
<td>Object indicating the result of the payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><em>MessageReference</em></td>
<td></td>
<td>Object</td>
<td>Identification of a previous POI transaction. Present if <code>Result</code> is &quot;Success&quot;, or <code>Result</code> is &quot;Failure&quot; and <code>ErrorCondition</code> is &quot;InProgress&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request, or <code>ServiceID</code> of last transaction if not present in request.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-saleid">SaleID</a></td>
<td></td>
<td>String</td>
<td>Mirrored from request, but only if present in the request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-poiid">POIID</a></td>
<td></td>
<td>String</td>
<td>Mirrored from request, but only if present in the request</td>
</tr>
<tr>
<td><em>RepeatedMessageResponse</em></td>
<td></td>
<td>Object</td>
<td>Present if <code>Result</code> is &quot;Success&quot;</td>
</tr>
<tr>
<td> <em>MessageHeader</em></td>
<td>✔</td>
<td>Object</td>
<td><code>MessageHeader</code> of the requested payment</td>
</tr>
<tr>
<td> <em>PaymentResponse</em></td>
<td>✔</td>
<td>Object</td>
<td><code>PaymentResponse</code> of the requested payment</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-abort-transaction'>Abort transaction</h3>
<p>The Sale System can send an <code>abort transaction</code> message to request cancellation of the in-progress transaction. </p>

<aside class="success">
Cancel transaction is a "request to cancel". Cancellation of the transaction is not guaranteed. There are a number of instances where cancellation is not possible (for example, when the payment has already completed). 

After sending a cancel transaction request, the Sale System should <b>always</b> wait for the payment/card acquisition response and validate the success of the sale by checking the `Result` property.
</aside>
<h4 id='cloud-api-reference-methods-abort-transaction-abort-transaction-request'>Abort transaction request</h4>
<blockquote>
<p>Abort transaction request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Abort"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"AbortRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageReference"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"AbortReason"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Abort&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique identifier for the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>AbortRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>MessageReference</em></td>
<td>✔</td>
<td>Object</td>
<td>Identification of a POI transaction</td>
</tr>
<tr>
<td> <a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Payment&quot; or &quot;CardAcquisition&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>The <a href="#data-dictionary-serviceid">ServiceID</a> of the transaction to cancel</td>
</tr>
<tr>
<td> <a href="#data-dictionary-saleid">SaleID</a></td>
<td></td>
<td>String</td>
<td>The <a href="#data-dictionary-saleid">SaleID</a> of the transaction to cancel. Only required if different from the <a href="#data-dictionary-saleid">SaleID</a> provided in the <code>MessageHeader</code></td>
</tr>
<tr>
<td> <a href="#data-dictionary-poiid">POIID</a></td>
<td></td>
<td>String</td>
<td>The <a href="#data-dictionary-poiid">POIID</a> of the transaction to cancel. Only required if different from the <a href="#data-dictionary-poiid">POIID</a> provided in the <code>MessageHeader</code></td>
</tr>
<tr>
<td><a href="#abortreason">AbortReason</a></td>
<td>✔</td>
<td>String</td>
<td>Any text describing the reason for cancelling the transaction. For example, &quot;User cancel&quot;</td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-abort-transaction-abort-transaction-response'>Abort transaction response</h4>
<p>There is no direct response to an Abort message.</p>

<p>If the transaction can be aborted, a payment response is returned with <code>Result</code> = &quot;Failure&quot; and <code>ErrorCondition</code> = &quot;Aborted&quot;.</p>

<p>If the transaction cannot be aborted, a normal payment response is sent back in time.</p>

<p>However, if the Abort Request cannot be accepted due to a message format error or if it references a transaction that is not found, an Event Notification is returned. </p>

<blockquote>
<p>Abort transaction response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Event"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Notification"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"DeviceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"EventNotification"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"EventToNotify"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"EventDetails"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Event&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Event&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Notification&quot;</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique message identifier</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
</tbody></table>

<p><strong>EventNotification</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td> <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time of the event on the POI System, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-eventtonotify">EventToNotify</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Reject&quot; if the abort request cannot be accepted (e.g. message format error, <code>ServiceId</code> not found). &quot;CompletedMessage&quot; if payment has already completed.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-eventdetails">EventDetails</a></td>
<td>✔</td>
<td>String</td>
<td>Extra detail on the reason for the event</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-reconciliation'>Reconciliation</h3><h4 id='cloud-api-reference-methods-reconciliation-reconciliation-request'>Reconciliation request</h4>
<blockquote>
<p>Abort transaction request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Reconciliation"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ReconciliationRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"ReconciliationType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Reconciliation&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique identifier for the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>ReconciliationRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#reconciliationtype">ReconciliationType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;SaleReconciliation&quot; to close the current period, &quot;PreviousReconciliation&quot; to request the result of a previous reconciliation</td>
</tr>
<tr>
<td><a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
<td></td>
<td>String</td>
<td>Present if ReconciliationType is &quot;PreviousReconciliation&quot;. See <a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-reconciliation-reconciliation-response'>Reconciliation response</h4>
<blockquote>
<p>Reconciliation response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Reconciliation"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ReconciliationResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"ReconciliationType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"TransactionTotals"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"CardBrand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"OperatorID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"ShiftNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"TotalsGroupID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"PaymentCurrency"</span><span class="p">:</span><span class="s2">"AUD"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"PaymentTotals"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nl">"TransactionType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"TransactionCount"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"TransactionAmount"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"TipAmount"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"SurchargeAmount"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Reconciliation&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique message identifier</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
</tbody></table>

<p><strong>ReconciliationResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>Response</em></td>
<td>✔</td>
<td>Object</td>
<td>Object indicating the result of the login</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><a href="#reconciliationtype">ReconciliationType</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
<td></td>
<td>String</td>
<td>Present if <code>Result</code> is &quot;Success&quot;. The <code>ReconciliationID</code> of the period requested</td>
</tr>
<tr>
<td><em>TransactionTotals</em></td>
<td></td>
<td>Array</td>
<td>Present if <code>Result</code> is &quot;Success&quot;. An array of totals grouped by card brand, then operator, then shift, then TotalsGroupID, then payment currency.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-paymentinstrumenttype">PaymentInstrumentType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Card&quot; (card payment) or &quot;Mobile&quot; (phone/QR code payments)</td>
</tr>
<tr>
<td> <a href="#data-dictionary-cardbrand">CardBrand</a></td>
<td></td>
<td>String</td>
<td>A card brand used during this reconciliation period</td>
</tr>
<tr>
<td> <a href="#data-dictionary-operatorid">OperatorID</a></td>
<td></td>
<td>String</td>
<td>An operator id used during this reconciliation period</td>
</tr>
<tr>
<td> <a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>A shift number used during the reconciliation period</td>
</tr>
<tr>
<td> <a href="#data-dictionary-totalsgroupid">TotalsGroupID</a></td>
<td></td>
<td>String</td>
<td>A custom grouping of transactions as defined by the Sale System</td>
</tr>
<tr>
<td> <a href="#data-dictionary-paymentcurrency">PaymentCurrency</a></td>
<td></td>
<td>String</td>
<td>&quot;AUD&quot;</td>
</tr>
<tr>
<td> <em>PaymentTotals</em></td>
<td></td>
<td>Array</td>
<td>An array [0..10] of totals grouped by transaction payment type. Present if both <code>TransactionCount</code> and <code>TransactionAmount</code> are not equal to zero</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactiontype">TransactionType</a></td>
<td></td>
<td>String</td>
<td>Transaction type for this payment. See <a href="#data-dictionary-transactiontype">TransactionType</a></td>
</tr>
<tr>
<td>  <a href="#transactioncount">TransactionCount</a></td>
<td></td>
<td>String</td>
<td>The number of transactions for the transaction type for the current grouping of transactions</td>
</tr>
<tr>
<td>  <a href="#transactionamount">TransactionAmount</a></td>
<td></td>
<td>Number</td>
<td>The total amount of transactions for the transaction type for the current grouping of transactions</td>
</tr>
</tbody></table>
<h3 id='cloud-api-reference-methods-card-acquisition'>Card acquisition</h3>
<p>The card acquisition request allows the Sale System to tokenise a card which can be used in future payment requests.</p>
<h4 id='cloud-api-reference-methods-card-acquisition-card-acquisition-request'>Card acquisition request</h4>
<blockquote>
<p>Card acquisition request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"CardAcquisition"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"CardAcquisitionRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"SaleData"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"OperatorID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"OperatorLanguage"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ShiftNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"CustomerLanguage"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"SaleTransactionID"</span><span class="p">:{</span><span class="w">
          </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"SaleTerminalData"</span><span class="p">:{</span><span class="w">
          </span><span class="nl">"TerminalEnvironment"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"SaleCapabilities"</span><span class="p">:[</span><span class="w">
            </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"…"</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"CardAcquisitionTransaction"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"AllowedPaymentBrand"</span><span class="p">:[</span><span class="w">
          </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"…"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nl">"ForceEntryMode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Reconciliation&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique identifier for the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Uniquely identifies the POI Terminal</td>
</tr>
</tbody></table>

<p><strong>CardAcquisitionRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>SaleData</em></td>
<td>✔</td>
<td>Object</td>
<td>Object Sale System information attached to this payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-operatorid">OperatorID</a></td>
<td></td>
<td>String</td>
<td>Only required if different from Login Request</td>
</tr>
<tr>
<td> <a href="#operatorlanguage">OperatorLanguage</a></td>
<td></td>
<td>String</td>
<td>Set to &quot;en&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>Only required if different from Login Request</td>
</tr>
<tr>
<td> <a href="#customerlanguage">CustomerLanguage</a></td>
<td></td>
<td>String</td>
<td>Set to &quot;en&quot; for English</td>
</tr>
<tr>
<td> <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Customer&quot;</td>
</tr>
<tr>
<td> <em>SaleTransactionID</em></td>
<td></td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique reference for this sale ticket</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time of initiating the request on the POI System, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</td>
</tr>
<tr>
<td> <em>SaleTerminalData</em></td>
<td></td>
<td>Object</td>
<td>Define Sale System configuration. Only include if elements within have different values to those in Login Request</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-terminalenvironment">TerminalEnvironment</a></td>
<td></td>
<td>String</td>
<td>&quot;Attended&quot;, &quot;SemiAttended&quot;, or &quot;Unattended&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
<td></td>
<td>Array</td>
<td>Advises the POI System of the Sale System capabilities. See <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
</tr>
<tr>
<td><em>CardAcquisitionTransaction</em></td>
<td></td>
<td>Object</td>
<td>Present if any of the JSON elements within are present</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-allowedpaymentbrands">AllowedPaymentBrands</a></td>
<td></td>
<td>Array</td>
<td>Restricts the request to specified card brands. See <a href="#data-dictionary-allowedpaymentbrands">AllowedPaymentBrands</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-forceentrymode">ForceEntryMode</a></td>
<td></td>
<td>String</td>
<td>If present, restricts card presentment to the specified type. See <a href="#data-dictionary-forceentrymode">ForceEntryMode</a></td>
</tr>
</tbody></table>
<h4 id='cloud-api-reference-methods-card-acquisition-reconciliation-response'>Reconciliation response</h4>
<blockquote>
<p>Reconciliation response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Reconciliation"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"ReconciliationResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
        </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"ReconciliationType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"POIReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"TransactionTotals"</span><span class="p">:[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"CardBrand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"OperatorID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"ShiftNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"TotalsGroupID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"PaymentCurrency"</span><span class="p">:</span><span class="s2">"AUD"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"PaymentTotals"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nl">"TransactionType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"TransactionCount"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
              </span><span class="nl">"TransactionAmount"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"SecurityTrailer"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Reconciliation&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#deviceid">DeviceID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique message identifier</td>
</tr>
<tr>
<td><a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from payment request</td>
</tr>
</tbody></table>

<p><strong>ReconciliationResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><em>Response</em></td>
<td>✔</td>
<td>Object</td>
<td>Object indicating the result of the login</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><a href="#reconciliationtype">ReconciliationType</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from request</td>
</tr>
<tr>
<td><a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
<td></td>
<td>String</td>
<td>Present if <code>Result</code> is &quot;Success&quot;. The <code>ReconciliationID</code> of the period requested</td>
</tr>
<tr>
<td><em>TransactionTotals</em></td>
<td></td>
<td>Array</td>
<td>Present if <code>Result</code> is &quot;Success&quot;. An array of totals grouped by card brand, then operator, then shift, then TotalsGroupID, then payment currency.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-paymentinstrumenttype">PaymentInstrumentType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Card&quot; (card payment) or &quot;Mobile&quot; (phone/QR code payments)</td>
</tr>
<tr>
<td> <a href="#data-dictionary-cardbrand">CardBrand</a></td>
<td></td>
<td>String</td>
<td>A card brand used during this reconciliation period. See <a href="#data-dictionary-cardbrand">CardBrand</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-operatorid">OperatorID</a></td>
<td></td>
<td>String</td>
<td>An operator id used during this reconciliation period</td>
</tr>
<tr>
<td> <a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>A shift number used during the reconciliation period</td>
</tr>
<tr>
<td> <a href="#data-dictionary-totalsgroupid">TotalsGroupID</a></td>
<td></td>
<td>String</td>
<td>A custom grouping of transactions as defined by the Sale System</td>
</tr>
<tr>
<td> <a href="#data-dictionary-paymentcurrency">PaymentCurrency</a></td>
<td></td>
<td>String</td>
<td>&quot;AUD&quot;</td>
</tr>
<tr>
<td> <em>PaymentTotals</em></td>
<td></td>
<td>Array</td>
<td>An array [0..10] of totals grouped by transaction payment type. Present if both <code>TransactionCount</code> and <code>TransactionAmount</code> are not equal to zero</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactiontype">TransactionType</a></td>
<td></td>
<td>String</td>
<td>Transaction type for this payment. See <a href="#data-dictionary-transactiontype">TransactionType</a></td>
</tr>
<tr>
<td>  <a href="#transactioncount">TransactionCount</a></td>
<td></td>
<td>String</td>
<td>The number of transactions for the transaction type for the current grouping of transactions</td>
</tr>
<tr>
<td>  <a href="#transactionamount">TransactionAmount</a></td>
<td></td>
<td>Number</td>
<td>The total amount of transactions for the transaction type for the current grouping of transactions</td>
</tr>
</tbody></table>
<h2 id='cloud-api-reference-error-handling'>Error handling</h2>
<p>When the Sale System sends a request, it will receive a matching response. For example, if the Sale System sends a <a href="#payment_request">payment request</a> it will receive a <a href="#payment-response">payment response</a>.</p>

<p>The Sale System should handle errors by checking the <a href="#data-dictionary-result">Response.Result</a> and <a href="#data-dictionary-errorcondition">Response.ErrorCondition</a> fields in the response.</p>

<p>In the event the Sale System does not receive a response (for example, due to network error or timeout) it must enter an error handling loop.</p>

<p>Error handling due to network error or timeout is outlined in the diagram below. </p>

<ol>
<li>Cashier initiates a payment</li>
<li>Sale System sends a <a href="#cloud-api-reference-methods-payment">payment request</a></li>
<li>Network error or timeout occurs</li>
<li>Sale System awaits Internet availability</li>
<li>Sale System enters a loop for a maximum of 90 seconds</li>
<li>Sale System sends a <a href="#transaction-status-request">transaction status request</a> and awaits a <a href="#transaction-status-response">transaction status response</a></li>
<li>Sale System handles the transaction status response 

<ol>
<li>If <code>Response.Result</code> is &quot;Success&quot;, the transaction result will be contained in <code>RepeatedMessageResponse</code> and the Sale System can exit the error loop</li>
<li>If <code>Response.Result</code> is &quot;Failure&quot; and <code>Response.ErrorCondition</code> is &quot;InProgress&quot; the Terminal is still processing the payment. The Sale System should wait 5 seconds and send the <a href="#transaction_status_request">transaction status request</a> again.</li>
<li>If <code>Response.Result</code> is &quot;Failure&quot; and <code>Response.ErrorCondition</code> is not &quot;InProgress&quot; the payment failed</li>
</ol></li>
</ol>

<aside class="success">
If the Sale System is unable retrieve a result within 90 seconds the payment has failed.
</aside>

<p><img src="images/payment-error-handling-dee8ee36.png" alt="" /></p>

<p><strong>Power failure handling</strong></p>

<p>The Sale System can handle a power failure by checking a local transaction status on start up.</p>

<ol>
<li>Cashier initiates a payment</li>
<li>Sale System sets txn_in_progress flag</li>
<li>Sale System sends a <a href="#cloud-api-reference-methods-payment">payment request</a></li>
<li>Sale System power failure occurs</li>
<li>Sale System start up after power failure</li>
<li>Sale System checks if txn_in_progress flag is set. If so, enter error handling</li>
</ol>

<p><img src="images/payment-error-handling-power-failure-0f301d91.png" alt="" /></p>
<h1 id='satellite-api-reference'>Satellite API Reference</h1>
<aside class="warning">
The new Fusion Satellite API documented below is currently unavailable in production. Please contact the Data Mesh integrations team at <a href="mailto:integrations@datameshgroup.com">integrations@datameshgroup.com</a> for details on how to use the Fusion Satellite API.
</aside>

<p>The Fusion Satellite API allows a Sale System running on the POI terminal to communicate with the DataMesh Satellite payment application on the same POI terminal using inter-app communication with <a href="https://developer.android.com/guide/components/intents-filters">Android intents</a>.</p>
<h2 id='satellite-api-reference-message-format'>Message format</h2>
<p>The Satellite API utilises an Android intent with request/response objects based on the Nexo <code>SaleToPOIRequest</code> and <code>SaleToPOIResponse</code></p>
<h3 id='satellite-api-reference-message-format-intent-request'>Intent request</h3><div class="highlight"><pre class="highlight java tab-java"><code><span class="nc">Intent</span> <span class="n">intent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Intent</span><span class="o">(</span><span class="s">"au.com.dmg.axispay"</span><span class="o">);</span>
</code></pre></div>
<p>The intent must set the following action <code>au.com.dmg.axispay</code></p>
<div class="highlight"><pre class="highlight java tab-java"><code><span class="kd">static</span> <span class="kd">final</span> <span class="kt">int</span> <span class="no">PAYMENT_REQUEST</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
<span class="n">startActivityForResult</span><span class="o">(</span><span class="n">intent</span><span class="o">,</span> <span class="no">PAYMENT_REQUEST</span><span class="o">);</span>
</code></pre></div>
<blockquote>
<p>Note that <code>PAYMENT_REQUEST</code> may be any number.</p>
</blockquote>

<p>Launch the Satellite payment activity by calling <code>startActivityForResult</code></p>

<p>The following extra data may accompany the Intent:</p>

<table><thead>
<tr>
<th>Extra Data Name</th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-applicationname">ApplicationName</a></td>
<td>✔</td>
<td>String</td>
<td>The name of the Sale System application</td>
</tr>
<tr>
<td><a href="#data-dictionary-softwareversion">SoftwareVersion</a></td>
<td>✔</td>
<td>String</td>
<td>The software version of the Sale System</td>
</tr>
<tr>
<td><a href="#data-dictionary-operatorid">OperatorId</a></td>
<td></td>
<td>String</td>
<td>Groups transactions under this operator id</td>
</tr>
<tr>
<td><a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>Groups transactions under this shift number</td>
</tr>
<tr>
<td>Request</td>
<td>✔</td>
<td>String</td>
<td>Json <code>SaleToPOIRequest</code> object which represents the request</td>
</tr>
</tbody></table>
<h3 id='satellite-api-reference-message-format-intent-response'>Intent response</h3><div class="highlight"><pre class="highlight java tab-java"><code><span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="nc">Intent</span> <span class="n">intent</span><span class="o">)</span> <span class="o">{</span>

    <span class="k">if</span> <span class="o">(</span><span class="n">requestCode</span> <span class="o">==</span> <span class="no">PAYMENT_REQUEST</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span><span class="o">(</span><span class="n">resultCode</span> <span class="o">==</span> <span class="nc">Activity</span><span class="o">.</span><span class="na">RESULT_OK</span><span class="o">){</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">// Handle SaleToPoiResponse in response extra data</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">else</span> <span class="nf">if</span> <span class="o">(</span><span class="n">resultCode</span> <span class="o">==</span> <span class="nc">Activity</span><span class="o">.</span><span class="na">RESULT_CANCELED</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// Payment failed.</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">intent</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
              <span class="c1">// Optionally check SaleToPoiResponse in response extra data</span>
            <span class="o">}</span>           
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<p>If the result is <code>Activity.RESULT_CANCELED</code> then the transaction has been aborted and not completed. If the result is <code>Activity.RESULT_OK</code> then the transaction has completed. </p>

<p>The following extra data may accompany the response:</p>

<table><thead>
<tr>
<th>Extra Data Name</th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Response</td>
<td>✔</td>
<td>String</td>
<td>Json <code>SaleToPOIResponse</code> object which represents the response</td>
</tr>
</tbody></table>
<h3 id='satellite-api-reference-message-format-request-response-object'>Request/response object</h3>
<blockquote>
<p>SaleToPOIRequest</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"PaymentRequest"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<blockquote>
<p>SaleToPOIResponse</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="err">...</span><span class="p">},</span><span class="w">
    </span><span class="nl">"LoginRequest"</span><span class="p">:{</span><span class="err">...</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>All messages use JSON format with UTF-8 encoding. </p>

<p>Supported primitive data elements are:</p>

<ol>
<li><strong>String</strong> text string of variable length</li>
<li><strong>Boolean</strong> true or false</li>
<li><strong>Number</strong> defined in this document as either <code>integer</code> or <code>decimal</code>. For all number fields the Sale System <em>MUST</em> remove the digits equal to zero on left and the right of the value and any useless 
decimal point (eg. 00320.00 is expressed 320, and 56.10 is expressed 56.1). This simplifies parsing and MAC calculations.</li>
<li><strong>Null</strong> optional types can be represented as null</li>
</ol>

<aside class="success">
Additional fields will be added to the message specification over time. To ensure forwards compatibility 
the Sale System must ignore when extra objects and fields are present in response messages. 
</aside>

<p>The base of every message is the <code>SaleToPOIRequest</code> object for requests, and <code>SaleToPOIResponse</code> object for responses. </p>

<p>The <code>SaleToPOIRequest</code> and <code>SaleToPOIResponse</code> contain two objects: </p>

<ol>
<li>A <a href="#messageheader">MessageHeader</a> object.</li>
<li>A <a href="#payload">Payload</a> object of variable types.</li>
</ol>
<h3 id='satellite-api-reference-message-format-messageheader'>MessageHeader</h3>
<blockquote>
<p>MessageHeader</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
  </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="w">
  </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">""</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>A <code>MessageHeader</code> is included with each request and response. It defines the protocol and message type.</p>

<table><thead>
<tr>
<th>Attribute</th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>Informs the receiver of the class of message. Possible values are &quot;Service&quot;, &quot;Device&quot;, or &quot;Event&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the category of message. Possible values are &quot;CardAcquisition&quot;, &quot;Display&quot;, &quot;Login&quot;, &quot;Logout&quot;, &quot;Payment&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>Type of message. Possible values are &quot;Request&quot;, &quot;Response&quot;, or &quot;Notification&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
</tbody></table>
<h3 id='satellite-api-reference-message-format-payload'>Payload</h3>
<p>An object which defines fields for the request/response. The object name depends on the <a href="#data-dictionary-messagecategory">MessageCategory</a> defined in the <code>MessageHeader</code></p>

<p>e.g. a payment will include a <code>PaymentRequest</code>/<code>PaymentResponse</code>.</p>

<p>The <a href="#satellite-api-reference">Satellite API Reference</a> outlines the expected payload for each supported request.  </p>

<!-- 
## Perform a purchase

To perform a purchase the Sale System will need to implement requests, and handle responses outlined in the [payment lifecycle](#getting-started-design-your-integration-payment-lifecycle).


- If a login hasn't already been sent for the session, send a login request as detailed in [login request](#cloud-api-reference-methods-login) 
  - Ensure "PrinterReceipt" is included in [SaleTerminalData.SaleCapabilities](#data-dictionary-salecapabilities) if payment receipts are to be redirected to the Sale System
- Await the a login response and
  - Ensure the [ServiceID](#data-dictionary-serviceid) in the result matches the request
  - Record the [POISerialNumber](#data-dictionary-poiserialnumber) to be sent in subsequent login requests
- Send a payment request, including all required fields, as detailed in [payment request](#cloud-api-reference-methods-payment) 
  - Set [PaymentData.PaymentType](#data-dictionary-paymenttype) to "Normal"
  - Set the purchase amount in [PaymentTransaction.AmountsReq.RequestedAmount](#requestedamount)
  - Set [SaleTransactionID](#data-dictionary-saletransactionid) to a unique value for the sale on this Sale System
  - Populate the [SaleItem](#data-dictionary-saleitem) array with the product basket for the transaction 
- If configured in [SaleTerminalData.SaleCapabilities](#data-dictionary-salecapabilities), handle any [display](#cloud-api-reference-methods-display), [print](#cloud-api-reference-methods-print), and [input](#cloud-api-reference-methods-input) events the POI System sends
  - The expected user interface handling is outlined in [user interface](#user-interface)
  - The expected payment receipt handling is outlined in [receipt printing](#receipt-printing)
- Await the payment response 
  - Ensure the [ServiceID](#data-dictionary-serviceid) in the result matches the request
  - Check [Response.Result](#data-dictionary-result) for the transaction result 
  - If [Response.Result](#data-dictionary-result) is "Success", record the following to enable future matched refunds:
    - [SaleID](#data-dictionary-saleid)
    - [POIID](#data-dictionary-poiid)
    - [POITransactionID](#data-dictionary-poitransactionid)
  - Check [PaymentResult.AmountsResp.AuthorizedAmount](#authorizedamount) (it may not equal the `RequestedAmount` in the payment request)
  - If the Sale System is handling tipping or surcharge, check the [PaymentResult.AmountsResp.TipAmount](#tipamount), and [PaymentResult.AmountsResp.SurchargeAmount](#surchargeamount)
  - Print the receipt contained in `PaymentReceipt`
- Implement error handling outlined in [error handling](#cloud-api-reference-error-handling)


## Perform a refund

To perform a refund the Sale System will need to implement requests, and handle responses outlined in the [payment lifecycle](#getting-started-design-your-integration-payment-lifecycle).

In most cases the Sale System should attempt to 
//

- If a login hasn't already been sent for the session, send a login request as detailed in [login request](#cloud-api-reference-methods-login) 
  - Ensure "PrinterReceipt" is included in [SaleTerminalData.SaleCapabilities](#data-dictionary-salecapabilities) if payment receipts are to be redirected to the Sale System
- Await the a login response and
  - Ensure the [ServiceID](#data-dictionary-serviceid) in the result matches the request
  - Record the [POISerialNumber](#data-dictionary-poiserialnumber) to be sent in subsequent login requests
- Send a payment request, including all required fields, as detailed in [payment request](#cloud-api-reference-methods-payment) 
  - Set [PaymentData.PaymentType](#data-dictionary-paymenttype) to "Refund"
  - Set the refund amount in [PaymentTransaction.AmountsReq.RequestedAmount](#requestedamount)
  - Set [SaleTransactionID](#data-dictionary-saletransactionid) to a unique value for the sale on this Sale System
  - If refunding a previous purchase, set the following fields in [PaymentTransaction.OriginalPOITransaction](#data-dictionary-originalpoitransaction)
    - Set [SaleID](#data-dictionary-saleid) to the [SaleID](#data-dictionary-saleid) of the original purchase payment request 
    - Set [POIID](#data-dictionary-poiid) to the [POIID](#data-dictionary-poiid) of the original purchase payment request 
    - Set [POITransactionID](#data-dictionary-poitransactionid) to the value returned in [POIData.POITransactionID](#data-dictionary-poitransactionid) of the original purchase payment response 
    - The product basket is not required for refunds
- If configured in [SaleTerminalData.SaleCapabilities](#data-dictionary-salecapabilities), handle any [display](#cloud-api-reference-methods-display), [print](#cloud-api-reference-methods-print), and [input](#cloud-api-reference-methods-input) events the POI System sends
  - The expected user interface handling is outlined in [user interface](#user-interface)
  - The expected payment receipt handling is outlined in [receipt printing](#receipt-printing)
- Await the payment response 
  - Ensure the [ServiceID](#data-dictionary-serviceid) in the result matches the request
  - Check [Response.Result](#data-dictionary-result) for the transaction result 
  - Check [PaymentResult.AmountsResp.AuthorizedAmount](#authorizedamount) (it may not equal the `RequestedAmount` in the payment request)
  - Print the receipt contained in `PaymentReceipt`
- Implement error handling outlined in [error handling](#cloud-api-reference-error-handling)

-->
<h2 id='satellite-api-reference-methods'>Methods</h2><h3 id='satellite-api-reference-methods-payment'>Payment</h3>
<p>The payment message is used to perform purchase, purchase + cash out, cash out only, refund, pre-authorisation, and completion requests. </p>
<h4 id='satellite-api-reference-methods-payment-payment-request'>Payment request</h4>
<blockquote>
<p>Payment request</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIRequest"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Payment"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Request"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"PaymentRequest"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"SaleData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"OperatorID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"OperatorLanguage"</span><span class="p">:</span><span class="s2">"en"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ShiftNumber"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleTransactionID"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"SaleReferenceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"SaleTerminalData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TerminalEnvironment"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"SaleCapabilities"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"TotalsGroupID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"Customer | Transaction"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentTransaction"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"AmountsReq"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Currency"</span><span class="p">:</span><span class="s2">"AUD"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"RequestedAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CashBackAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TipAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"PaidAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MaximumCashBackAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MinimumSplitAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"OriginalPOITransaction"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"SaleID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"POIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"POITransactionID"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="nl">"ReuseCardDataFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ApprovalCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"LastTransactionFlag"</span><span class="p">:</span><span class="kc">true</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"TransactionConditions"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"AllowedPaymentBrands"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"AcquirerID"</span><span class="p">:[</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">],</span><span class="w">
               </span><span class="nl">"DebitPreferredFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ForceOnlineFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MerchantCategoryCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"SaleItem"</span><span class="p">:[</span><span class="w">
               </span><span class="p">{</span><span class="w">
                  </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"EanUpc"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"xx.x"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"xx.x"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"xx.x"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"TaxCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"SaleChannel"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"AdditionalProductInfo"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"CostBase"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Discount"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">],</span><span class="w">
                  </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"QuantityInStock"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Tags"</span><span class="p">:[</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">]</span><span class="w">
                  </span><span class="nl">"PageURL"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ImageURLs"</span><span class="p">:[</span><span class="s2">"xxx"</span><span class="p">,</span><span class="s2">"xxx"</span><span class="p">],</span><span class="w">
                  </span><span class="nl">"Size"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Colour"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Weight"</span><span class="p">:</span><span class="err">xx.xx</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"WeightUnitOfMeasure"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">   
               </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"PaymentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PaymentInstrumentData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CardData"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"EntryMode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ProtectedCardData"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-envelopedData"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"EnvelopedData"</span><span class="p">:{</span><span class="w">
                        </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v0"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"Recipient"</span><span class="p">:{</span><span class="w">
                           </span><span class="nl">"KEK"</span><span class="p">:{</span><span class="w">
                              </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v4"</span><span class="p">,</span><span class="w">
                              </span><span class="nl">"KEKIdentifier"</span><span class="p">:{</span><span class="w">
                                 </span><span class="nl">"KeyIdentifier"</span><span class="p">:</span><span class="s2">"xxxDATKey"</span><span class="p">,</span><span class="w">
                                 </span><span class="nl">"KeyVersion"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                              </span><span class="p">},</span><span class="w">
                              </span><span class="nl">"KeyEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
                                 </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="w">
                              </span><span class="p">},</span><span class="w">
                              </span><span class="nl">"EncryptedKey"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                           </span><span class="p">}</span><span class="w">
                        </span><span class="p">},</span><span class="w">
                        </span><span class="nl">"EncryptedContent"</span><span class="p">:{</span><span class="w">
                           </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-data"</span><span class="p">,</span><span class="w">
                           </span><span class="nl">"ContentEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
                              </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="p">,</span><span class="w">
                              </span><span class="nl">"Parameter"</span><span class="p">:{</span><span class="w">
                                 </span><span class="nl">"InitialisationVector"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                              </span><span class="p">}</span><span class="w">
                           </span><span class="p">},</span><span class="w">
                           </span><span class="nl">"EncryptedData"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                        </span><span class="p">}</span><span class="w">
                     </span><span class="p">}</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nl">"SensitiveCardData"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"PAN"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"ExpiryDate"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"CCV"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nl">"PaymentToken"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"TokenValue"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Payment&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Request&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique value which will be mirrored in the response. See <a href="#data-dictionary-serviceid">ServiceID</a>.</td>
</tr>
</tbody></table>

<p><strong>PaymentRequest</strong></p>

<table><thead>
<tr>
<th><div style="width:200px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>SaleData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Sale System information attached to this payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-operatorid">OperatorID</a></td>
<td></td>
<td>String</td>
<td>Only required if different from Login Request</td>
</tr>
<tr>
<td> <a href="#operatorlanguage">OperatorLanguage</a></td>
<td></td>
<td>String</td>
<td>Set to &quot;en&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-shiftnumber">ShiftNumber</a></td>
<td></td>
<td>String</td>
<td>Only required if different from Login Request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-salereferenceid">SaleReferenceID</a></td>
<td></td>
<td>String</td>
<td>Mandatory for pre-authorisation and completion, otherwise optional. See <a href="#data-dictionary-salereferenceid">SaleReferenceID</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td></td>
<td>String</td>
<td>If present, indicates which type of token should be created for this payment. See <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
</tr>
<tr>
<td> <strong>SaleTransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique reference for this sale ticket. Not necessarily unique per payment request; for example a sale with split payments will have a number of payments with the same <a href="#data-dictionary-transactionid">TransactionID</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time of initiating the payment request on the POI System, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</td>
</tr>
<tr>
<td> <strong>SaleTerminalData</strong></td>
<td></td>
<td>Object</td>
<td>Define Sale System configuration. Only include if elements within have different values to those in Login Request</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-terminalenvironment">TerminalEnvironment</a></td>
<td></td>
<td>String</td>
<td>&quot;Attended&quot;, &quot;SemiAttended&quot;, or &quot;Unattended&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
<td></td>
<td>Array</td>
<td>Advises the POI System of the Sale System capabilities. See <a href="#data-dictionary-salecapabilities">SaleCapabilities</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-totalsgroupid">TotalsGroupId</a></td>
<td></td>
<td>String</td>
<td>Groups transactions in a login session</td>
</tr>
<tr>
<td><strong>PaymentTransaction</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <strong>AmountsReq</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object which contains the various components which make up the payment amount</td>
</tr>
<tr>
<td>  <a href="#currency">Currency</a></td>
<td>✔</td>
<td>String</td>
<td>Three character currency code. Set to &quot;AUD&quot;</td>
</tr>
<tr>
<td>  <a href="#requestedamount">RequestedAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>The requested amount for the transaction sale items, including cash back and tip requested</td>
</tr>
<tr>
<td>  <a href="#cashbackamount">CashBackAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The Cash back amount. Only if cash back is included in the transaction by the Sale System</td>
</tr>
<tr>
<td>  <a href="#tipamount">TipAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The Tip amount. Only if tip is included in the transaction</td>
</tr>
<tr>
<td>  <a href="#paidamount">PaidAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Sum of the amount of sale items – <code>RequestedAmount</code>. Present only if an amount has already been paid in the case of a split payment.</td>
</tr>
<tr>
<td>  <a href="#maximumcashbackamount">MaximumCashBackAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Available if <code>CashBackAmount</code> is not present. If present, the POI Terminal prompts for the cash back amount up to a maximum of <code>MaximumCashBackAmount</code></td>
</tr>
<tr>
<td>  <a href="#minimumsplitamount">MinimumSplitAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Present only if the POI Terminal can process an amount &lt; <code>RequestedAmount</code> as a split amount. Limits the minimum split amount allowed.</td>
</tr>
<tr>
<td> <strong><a href="#data-dictionary-originalpoitransaction">OriginalPOITransaction</a></strong></td>
<td></td>
<td>Object</td>
<td>Identifies a previous POI transaction. Mandatory for Refund and Completion. See <a href="#data-dictionary-originalpoitransaction">OriginalPOITransaction</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-saleid">SaleID</a></td>
<td>✔</td>
<td>String</td>
<td><a href="#data-dictionary-saleid">SaleID</a> which performed the original transaction</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-poiid">POIID</a></td>
<td>✔</td>
<td>String</td>
<td><a href="#data-dictionary-poiid">POIID</a> which performed the original transaction</td>
</tr>
<tr>
<td>  <strong>POITransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td><code>TransactionID</code> from the original transaction</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td><code>TimeStamp</code> from the original transaction</td>
</tr>
<tr>
<td>  <a href="#reusecarddataflag">ReuseCardDataFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If &#39;true&#39; the POI Terminal will retrieve the card data from file based on the <code>PaymentToken</code> included in the request. Otherwise the POI Terminal will read the same card again.</td>
</tr>
<tr>
<td>  <a href="#approvalcode">ApprovalCode</a></td>
<td></td>
<td>String</td>
<td>Present if a referral code is obtained from an Acquirer</td>
</tr>
<tr>
<td>  <a href="#lasttransactionflag">LastTransactionFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>Set to true to process the Last Transaction with a referral code</td>
</tr>
<tr>
<td> <strong>TransactionConditions</strong></td>
<td></td>
<td>Object</td>
<td>Optional transaction configuration. Present only if any of the JSON elements within are present.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-allowedpaymentbrands">AllowedPaymentBrands</a></td>
<td></td>
<td>Array</td>
<td>Restricts the request to specified card brands. See <a href="#data-dictionary-allowedpaymentbrands">AllowedPaymentBrands</a></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymenttransaction.transactionconditions.acquirerid">AcquirerID</a></td>
<td></td>
<td>Array</td>
<td>Used to restrict the payment to specified acquirers. See <a href="#data-dictionary-paymenttransaction.transactionconditions.acquirerid">AcquirerID</a></td>
</tr>
<tr>
<td>  <a href="#debitpreferredflag">DebitPreferredFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If present, debit processing is preferred to credit processing.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-forceonlineflag">ForceOnlineFlag</a></td>
<td></td>
<td>Boolean</td>
<td>If &#39;true&#39; the transaction will only be processed in online mode, and will fail if there is no response from the Acquirer.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-merchantcategorycode">MerchantCategoryCode</a></td>
<td></td>
<td>String</td>
<td>If present, overrides the MCC used for processing the transaction if allowed. Refer to ISO 18245 for available codes.</td>
</tr>
<tr>
<td> <strong><a href="#data-dictionary-saleitem">SaleItem</a></strong></td>
<td>✔</td>
<td>Array</td>
<td>Array of <a href="#data-dictionary-saleitem">SaleItem</a> objects which represent the product basket attached to this transaction. See <a href="#data-dictionary-saleitem">SaleItem</a> for examples.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-itemid">ItemID</a></td>
<td>✔</td>
<td>Integer</td>
<td>A unique identifier for the sale item within the context of this payment. e.g. a 0..n integer which increments by one for each sale item.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-productcode">ProductCode</a></td>
<td>✔</td>
<td>String</td>
<td>A unique identifier for the product within the merchant, such as the SKU. For example if two customers purchase the same product at two different stores owned by the merchant, both purchases should contain the same <code>ProductCode</code>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-eanupc">EanUpc</a></td>
<td></td>
<td>String</td>
<td>A standard unique identifier for the product. Either the UPC, EAN, or ISBN. Required for products with a UPC, EAN, or ISBN</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-unitofmeasure">UnitOfMeasure</a></td>
<td>✔</td>
<td>String</td>
<td>Unit of measure of the <code>Quantity</code>. If this item has no unit of measure, set to &quot;Other&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-quantity">Quantity</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Sale item quantity based on <code>UnitOfMeasure</code>.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-unitprice">UnitPrice</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Price per sale item unit. Present if <code>Quantity</code> is included.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-itemamount">ItemAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Total amount of the sale item</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-taxcode">TaxCode</a></td>
<td></td>
<td>String</td>
<td>Type of tax associated with the sale item. Default = &quot;GST&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-salechannel">SaleChannel</a></td>
<td></td>
<td>String</td>
<td>Commercial or distribution channel of the sale item. Default = &quot;Unknown&quot;</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-productlabel">ProductLabel</a></td>
<td>✔</td>
<td>String</td>
<td>a short, human readable, descriptive name of the product.  For example, <code>ProductLabel</code> could contain the product name typically printed on the customer receipt.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-additionalproductinfo">AdditionalProductInfo</a></td>
<td></td>
<td>String</td>
<td>Additional information, or more detailed description of the product item.</td>
</tr>
<tr>
<td>  <a href="#parentitemid">ParentItemID</a></td>
<td></td>
<td>Integer</td>
<td><em>Required</em> if this item is a &#39;modifier&#39; or sub-item. Contains the <a href="#data-dictionary-itemid">ItemID</a> of the parent <code>SaleItem</code></td>
</tr>
<tr>
<td>  <a href="#costbase">CostBase</a></td>
<td></td>
<td>Decimal</td>
<td>Cost of the product to the merchant per unit</td>
</tr>
<tr>
<td>  <a href="#discount">Discount</a></td>
<td></td>
<td>Decimal</td>
<td>If applied, the amount this sale item was discounted by</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-categories">Categories</a></td>
<td></td>
<td>Array</td>
<td>Array of categories. Top level &quot;main&quot; category at categories[0]. See <a href="#data-dictionary-categories">Categories</a> for more information.</td>
</tr>
<tr>
<td>  <a href="#brand">Brand</a></td>
<td></td>
<td>String</td>
<td>Brand name - typically visible on the product packaging or label</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-quantityinstock">QuantityInStock</a></td>
<td></td>
<td>Decimal</td>
<td>Remaining number of this item in stock in same unit of measure as <code>Quantity</code></td>
</tr>
<tr>
<td>  <a href="#sale-item-tags">Tags</a></td>
<td></td>
<td>Array</td>
<td>String array with descriptive tags for the product</td>
</tr>
<tr>
<td>  <a href="#restricted">Restricted</a></td>
<td></td>
<td>Boolean</td>
<td><code>true</code> if this is a restricted item, <code>false</code> otherwise. Defaults to <code>false</code> when field is null.</td>
</tr>
<tr>
<td>  <a href="#productpageurl">PageURL</a></td>
<td></td>
<td>String</td>
<td>URL link to the sale items product page</td>
</tr>
<tr>
<td>  <a href="#productimageurls">ImageURLs</a></td>
<td></td>
<td>Array</td>
<td>String array of images URLs for this sale item</td>
</tr>
<tr>
<td>  <a href="#style">Style</a></td>
<td></td>
<td>String</td>
<td>Style of the sale item</td>
</tr>
<tr>
<td>  <a href="#size">Size</a></td>
<td></td>
<td>String</td>
<td>Size of the sale item</td>
</tr>
<tr>
<td>  <a href="#colour">Colour</a></td>
<td></td>
<td>String</td>
<td>Colour of the sale item</td>
</tr>
<tr>
<td>  <a href="#weight">Weight</a></td>
<td></td>
<td>Decimal</td>
<td>Sale item weight, based on <code>WeightUnitOfMeasure</code></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-unitofmeasure">WeightUnitOfMeasure</a></td>
<td></td>
<td>String</td>
<td>Unit of measure of the <code>Weight</code>.</td>
</tr>
<tr>
<td> <strong>PaymentData</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object representing the payment method. Present only if any of the JSON elements within are present.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymenttype">PaymentType</a></td>
<td>✔</td>
<td>String</td>
<td>Defaults to &quot;Normal&quot;. Indicates the type of payment to process. &quot;Normal&quot;, &quot;Refund&quot;, or &quot;CashAdvance&quot;. See <a href="#data-dictionary-paymenttype">PaymentType</a></td>
</tr>
<tr>
<td>  <strong><a href="#data-dictionary-paymentinstrumentdata">PaymentInstrumentData</a></strong></td>
<td></td>
<td>Object</td>
<td>Object with represents card details for token or manually enter card details. See  for object structure</td>
</tr>
</tbody></table>
<h4 id='satellite-api-reference-methods-payment-payment-response'>Payment response</h4>
<blockquote>
<p>Payment response</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"SaleToPOIResponse"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"MessageHeader"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"MessageClass"</span><span class="p">:</span><span class="s2">"Service"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageCategory"</span><span class="p">:</span><span class="s2">"Payment"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"MessageType"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ServiceID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nl">"PaymentResponse"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"Response"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"Result"</span><span class="p">:</span><span class="s2">"Success| Partial | Failure"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ErrorCondition"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"AdditionalResponse"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"SaleData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"SaleTransactionID"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"SaleReferenceID"</span><span class="p">:</span><span class="s2">"xxxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"POIData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"POITransactionID"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"POIReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentResult"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"PaymentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PaymentInstrumentData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CardData"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"EntryMode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"PaymentBrand"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"Account"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"MaskedPAN"</span><span class="p">:</span><span class="s2">"xxxxxx…xxxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"PaymentToken"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"TokenValue"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"ExpiryDateTime"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"AmountsResp"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Currency"</span><span class="p">:</span><span class="s2">"AUD"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AuthorizedAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TotalFeesAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"CashBackAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"TipAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"SurchargeAmount"</span><span class="p">:</span><span class="s2">"x.xx"</span><span class="w">
            </span><span class="p">},</span><span class="w">
            </span><span class="nl">"OnlineFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
            </span><span class="nl">"PaymentAcquirerData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"AcquirerID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"MerchantID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AcquirerPOIID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"AcquirerTransactionID"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"TransactionID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"TimeStamp"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="nl">"ApprovalCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"ResponseCode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"HostReconciliationID"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"AllowedProductCodes"</span><span class="p">:[</span><span class="w">
            </span><span class="s2">"1"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"2"</span><span class="p">,</span><span class="w">
            </span><span class="s2">"3"</span><span class="w">
         </span><span class="p">],</span><span class="w">
         </span><span class="nl">"PaymentReceipt"</span><span class="p">:[</span><span class="w">
            </span><span class="p">{</span><span class="w">
               </span><span class="nl">"DocumentQualifier"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"RequiredSignatureFlag"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="w">
               </span><span class="nl">"OutputContent"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"OutputFormat"</span><span class="p">:</span><span class="s2">"XHTML"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"OutputXHTML"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">]</span><span class="w">
      </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p><strong>MessageHeader</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-messageclass">MessageClass</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Service&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagecategory">MessageCategory</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Payment&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-messagetype">MessageType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Response&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-serviceid">ServiceID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
</tbody></table>

<p><strong>PaymentResponse</strong></p>

<table><thead>
<tr>
<th><div style="width:200px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><strong>Response</strong></td>
<td>✔</td>
<td>Object</td>
<td>Object indicating the result of the payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-result">Result</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the result of the response. Possible values are &quot;Success&quot; and &quot;Failure&quot;</td>
</tr>
<tr>
<td> <a href="#data-dictionary-errorcondition">ErrorCondition</a></td>
<td></td>
<td>String</td>
<td>Indicates the reason an error occurred. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-errorcondition">ErrorCondition</a> for more information on possible values.</td>
</tr>
<tr>
<td> <a href="#data-dictionary-additionalresponse">AdditionalResponse</a></td>
<td></td>
<td>String</td>
<td>Provides additional error information. Only present when <code>Result</code> is &quot;Failure&quot;. See <a href="#data-dictionary-additionalresponse">AdditionalResponse</a> for more information on possible values.</td>
</tr>
<tr>
<td><strong>SaleData</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <strong>SaleTransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td> <a href="#data-dictionary-salereferenceid">SaleReferenceID</a></td>
<td></td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><strong>POIData</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <strong>POITransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique transaction id from the POI system</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time on the POI system, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td> <a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
<td></td>
<td>String</td>
<td>Present if <code>Result</code> is &quot;Success&quot; or &quot;Partial&quot;. See <a href="#data-dictionary-poireconciliationid">POIReconciliationID</a></td>
</tr>
<tr>
<td><strong>PaymentResult</strong></td>
<td></td>
<td>Object</td>
<td>Object related to a processed payment</td>
</tr>
<tr>
<td> <a href="#data-dictionary-paymenttype">PaymentType</a></td>
<td></td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td> <strong>PaymentInstrumentData</strong></td>
<td></td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymentinstrumenttype">PaymentInstrumentType</a></td>
<td></td>
<td>String</td>
<td>&quot;Card&quot; or &quot;Mobile&quot;</td>
</tr>
<tr>
<td>  <strong>CardData</strong></td>
<td></td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-entrymode">EntryMode</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates how the card was presented. See <a href="#data-dictionary-entrymode">EntryMode</a></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-paymentbrand">PaymentBrand</a></td>
<td>✔</td>
<td>String</td>
<td>Indicates the card type used. See <a href="#data-dictionary-paymentbrand">PaymentBrand</a></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-maskedpan">MaskedPAN</a></td>
<td>✔</td>
<td>String</td>
<td>PAN masked with dots, first 6 and last 4 digits visible</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-account">Account</a></td>
<td></td>
<td>String</td>
<td>Present if <code>EntryMode</code> is &quot;MagStripe&quot;, &quot;ICC&quot;, or &quot;Tapped&quot;. Indicates the card account used. See <a href="#data-dictionary-account">Account</a></td>
</tr>
<tr>
<td>   <strong>PaymentToken</strong></td>
<td></td>
<td>Object</td>
<td>Object representing a token. Only present if token was requested</td>
</tr>
<tr>
<td>    <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td>    <a href="#tokenvalue">TokenValue</a></td>
<td>✔</td>
<td>String</td>
<td>The value of the token</td>
</tr>
<tr>
<td>    <a href="#expirydatetime">ExpiryDateTime</a></td>
<td>✔</td>
<td>String</td>
<td>Expiry of the token, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td> <strong>AmountsResp</strong></td>
<td></td>
<td>Object</td>
<td>Present if <code>Result</code> is &quot;Success&quot; or &quot;Partial&quot;</td>
</tr>
<tr>
<td>  <a href="#currency">Currency</a></td>
<td></td>
<td>String</td>
<td>&quot;AUD&quot;</td>
</tr>
<tr>
<td>  <a href="#authorizedamount">AuthorizedAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Authorised amount which could be more, or less than the requested amount</td>
</tr>
<tr>
<td>  <a href="#totalfeesamount">TotalFeesAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Total of financial fees associated with the payment transaction if known at time of transaction</td>
</tr>
<tr>
<td>  <a href="#cashbackamount">CashBackAmount</a></td>
<td></td>
<td>Decimal</td>
<td>Cash back paid amount</td>
</tr>
<tr>
<td>  <a href="#tipamount">TipAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The amount of any tip added to the transaction</td>
</tr>
<tr>
<td>  <a href="#surchargeamount">SurchargeAmount</a></td>
<td></td>
<td>Decimal</td>
<td>The amount of any surcharge added to the transaction</td>
</tr>
<tr>
<td> <a href="#onlineflag">OnlineFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>True if the transaction was processed online, false otherwise</td>
</tr>
<tr>
<td> <strong>PaymentAcquirerData</strong></td>
<td></td>
<td>Object</td>
<td>Data related to the response from the payment acquirer</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-paymentacquirerdata.acquirerid">AcquirerID</a></td>
<td>✔</td>
<td>String</td>
<td>The ID of the acquirer which processed the transaction</td>
</tr>
<tr>
<td>  <a href="#merchantid">MerchantID</a></td>
<td>✔</td>
<td>String</td>
<td>The acquirer merchant ID (MID)</td>
</tr>
<tr>
<td>  <a href="#acquirerPOIID">AcquirerPOIID</a></td>
<td>✔</td>
<td>String</td>
<td>The acquirer terminal ID (TID)</td>
</tr>
<tr>
<td>  <strong>AcquirerTransactionID</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>The acquirer transaction ID</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Timestamp from the acquirer, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
<tr>
<td>  <a href="#approvalcode">ApprovalCode</a></td>
<td>✔</td>
<td>String</td>
<td>The Acquirer Approval Code. Also referred to as the Authentication Code</td>
</tr>
<tr>
<td>  <a href="#responsecode">ResponseCode</a></td>
<td>✔</td>
<td>String</td>
<td>The Acquirer Response Code. Also referred as the PINPad response code</td>
</tr>
<tr>
<td>  <a href="#stan">STAN</a></td>
<td></td>
<td>String</td>
<td>The Acquirer STAN if available</td>
</tr>
<tr>
<td>  <a href="#rrn">RRN</a></td>
<td></td>
<td>String</td>
<td>The Acquirer RRN if available</td>
</tr>
<tr>
<td>  <a href="#hostreconciliationid">HostReconciliationID</a></td>
<td>✔</td>
<td>String</td>
<td>Identifier of a reconciliation period with the acquirer. This normally has a date and time component in it</td>
</tr>
<tr>
<td> <a href="#allowedproductcodes">AllowedProductCodes</a></td>
<td></td>
<td>Array</td>
<td>Present if <code>ErrorCondition</code> is &quot;PaymentRestriction&quot;. Consists of a list of product codes corresponding to products that are purchasable with the given card. Items that exist in the basket but do not belong to this list corresponds to restricted items</td>
</tr>
<tr>
<td> <strong>PaymentReceipt</strong></td>
<td></td>
<td>Array</td>
<td>Array of payment receipt objects which represent receipts to be printed</td>
</tr>
<tr>
<td>  <a href="#documentqualifier">DocumentQualifier</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;CashierReceipt&quot; for a merchant receipt, otherwise &quot;CustomerReceipt&quot;</td>
</tr>
<tr>
<td>  <a href="#requiredsignatureflag">RequiredSignatureFlag</a></td>
<td>✔</td>
<td>Boolean</td>
<td>If true, the card holder signature is required on the merchant CashierReceipt.</td>
</tr>
<tr>
<td>  <strong>OutputContent</strong></td>
<td></td>
<td>Array</td>
<td>Array of payment receipt objects which represent receipts to be printed</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-outputformat">OutputFormat</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;XHTML&quot;</td>
</tr>
<tr>
<td>   <a href="#data-dictionary-outputxhtml">OutputXHTML</a></td>
<td>✔</td>
<td>String</td>
<td>The payment receipt in XHTML format but coded in BASE64</td>
</tr>
</tbody></table>
<h1 id='data-dictionary'>Data dictionary</h1><h2 id='data-dictionary-account'>Account</h2>
<p>Indicates a card account. Note that the list of available account names may change over time. </p>

<ul>
<li>Credit </li>
<li>Cheque </li>
<li>Savings</li>
<li>Default</li>
</ul>
<h2 id='data-dictionary-additionalproductinfo'>AdditionalProductInfo</h2>
<p>Additional information related to the product item</p>
<h2 id='data-dictionary-additionalresponse'>AdditionalResponse</h2>
<p>Provides extended response detail in the event of an error which may be used for analysis or diagnostics.  </p>

<aside class="success">
Error conditions may be added over time. To ensure forwards compatibility any error handling in the 
Sale System should allow for a "catch all" which handles currently undefined error conditions.
</aside>

<p>The possible <code>AdditionalResponse</code> values are based on the value of <a href="#data-dictionary-errorcondition">ErrorCondition</a></p>

<p>When <code>ErrorCondition</code> is &quot;MessageFormat&quot;</p>

<ul>
<li>&quot;Mandatory Data Element or Structure Absent: &lt;Absolute Data Name&gt;&quot;</li>
<li>&quot;Unexpected Data Element Value: &lt;Absolute Data Name&gt; - &lt;Expected Value(s) or Reason&gt;&quot;</li>
<li>&quot;&lt;Absolute Data Name&gt; Invalid Value &lt;Value&gt; for the Type &lt;Type&gt; [and Format <Format>]&quot;</li>
<li>&quot;&lt;Absolute Data Name&gt; Value is not part of the Enumerated or Cluster Type &lt;Type&gt;&quot; </li>
<li>&quot;Repeated Message: &lt;ID Name&gt; - &lt;Value&gt;&quot;</li>
<li>&quot;Empty Cluster: &lt;Absolute Data Name&gt;&quot;</li>
<li>&quot;Unacceptable Value Combination: [ &lt;Absolute Data Name&gt; : &lt;Value&gt; ]*&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;DeviceOut&quot;</p>

<ul>
<li>&quot;POI is Temporary Unavailable: &lt;Reason&gt;&quot;</li>
<li>&quot;POI is Permanently Unavailable: &lt;Reason&gt;&quot;</li>
<li>&quot;Security Alarm: &lt;Alarm&gt;&quot;

<ul>
<li>Alarm = The type of alarm. e.g. &quot;crypto key unknown&quot;</li>
</ul></li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;LoggedOut&quot;</p>

<ul>
<li>&quot;&lt;SaleID&gt; Never Login Since Last &lt;Event&gt; at &lt;Time&gt;&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;Busy&quot;</p>

<ul>
<li><p>&quot;POI &lt;Component&gt; Temporary Unavailable: &lt;Reason&gt;&quot;</p>

<ul>
<li>Component = &quot;System&quot; or &quot;Terminal&quot;</li>
<li>Reason = &quot;Installation in progress&quot;, &quot;Maintenance in progress&quot;, &quot;Device busy&quot;</li>
</ul></li>
<li><p>&quot;POI Terminal Busy to Process another Request: &lt;Request&gt;&quot;</p>

<ul>
<li>Request = &#39;PaymentRequest&#39;, &#39;LoginRequest&#39;</li>
</ul></li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;UnavailableService&quot;</p>

<ul>
<li>&quot;Sale Protocol Version &lt;Version&gt; Too Old. Version Implemented: &lt;Version&gt;&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;Cancel&quot;</p>

<ul>
<li>&quot;User Cancellation during &lt;Status&gt;&quot;</li>
<li>&quot;System Cancellation during &lt;Status&gt;&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;Abort&quot;</p>

<ul>
<li>&quot;Service Aborted during &lt;Status&gt; - Reason: &lt;AbortReason&gt; - from: &lt;SaleID&gt; - MessageID: &lt;ServiceID&gt;&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;InvalidCard&quot;</p>

<ul>
<li>&quot;No Card Entered after &lt;Time&gt; Seconds&quot;.</li>
<li>&quot;Invalid Card &lt;Reason&gt;&quot;

<ul>
<li>Reason = &quot;Card Expired&quot;, &quot;Card not allowed&quot;, &quot;Suspicion of fraud&quot;, etc.</li>
</ul></li>
<li>&quot;Unknown Card &lt;BIN:val or AID:val&gt;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;WrongPIN&quot;</p>

<ul>
<li>&quot;Wrong PIN &lt;RetryNumber&gt; Retries - Remaining &lt;RemainingRetries&gt;

<ul>
<li>Retries and RemainingRetries only if available.</li>
</ul></li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;UnreachableHost&quot;</p>

<ul>
<li>&quot;Host Unreachable: &lt;Reason&gt;&quot;</li>
<li>&quot;No Host Answer: &lt;Reason&gt;&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;Refusal&quot;</p>

<ul>
<li>&quot;Payment Refused by Acquirer: &lt;Acquirer&gt; Reason: &lt;Reason&gt; Code: &lt;Code&gt;&quot;</li>
<li>&quot;Payment Refused Locally - Reason: &lt;Reason&gt;&quot;</li>
</ul>

<p>When <code>ErrorCondition</code> is &quot;PaymentRestriction&quot;</p>

<ul>
<li>&quot;Restricted items&quot;</li>
</ul>
<h2 id='data-dictionary-algorithm'>Algorithm</h2>
<p>Defines the key algorithm. </p>

<p>Set to &quot;des-ede3-cbc&quot;</p>

<p>The data encryption session key = <a href="#data-dictionary-encryptedkey">EncryptedKey</a> is 3DES CBC encrypted by an agreed KEK 3DES key which should be unique per Sale Terminal or Sale System (To be agreed).</p>
<h2 id='data-dictionary-allowedpaymentbrands'>AllowedPaymentBrands</h2>
<p>Array of string.</p>

<p>Restricts payment to specific card brands included in the array. If not present, all supported cards are allowed.</p>

<p>Available values: </p>

<ul>
<li>&quot;VISA&quot;</li>
<li>&quot;MasterCard&quot;,</li>
<li>&quot;American Express&quot;</li>
<li>&quot;Diners Club&quot;</li>
<li>&quot;JCB&quot;</li>
<li>&quot;UnionPay&quot;</li>
<li>&quot;CUP Debit&quot;</li>
<li>&quot;Discover&quot;</li>
<li>&quot;Card&quot;</li>
</ul>
<h2 id='data-dictionary-applicationname'>ApplicationName</h2>
<p>The name of the Sale System application.</p>

<p>DataMesh will provide a <code>ApplicationName</code> to be used for the UAT environment. Once the Sale System is certified, DataMesh will provide a <code>ApplicationName</code> to be included in the production build of the Sale System. </p>
<h2 id='data-dictionary-cardbrand'>CardBrand</h2>
<p>Available values:</p>

<ul>
<li>&quot;VISA&quot;</li>
<li>&quot;MasterCard&quot;,</li>
<li>&quot;American Express&quot;</li>
<li>&quot;Diners Club&quot;</li>
<li>&quot;JCB&quot;</li>
<li>&quot;UnionPay&quot;</li>
<li>&quot;CUP Debit&quot;</li>
<li>&quot;Discover&quot;</li>
<li>&quot;PayPal&quot;</li>
<li>&quot;Card&quot;</li>
</ul>
<h2 id='data-dictionary-categories'>Categories</h2>
<p><code>Categories</code> is a string array which represents the categories of a <code>SaleItem</code></p>

<p>The main category is at the zero element.</p>

<p>For example: </p>

<table><thead>
<tr>
<th>Example</th>
<th>Array</th>
</tr>
</thead><tbody>
<tr>
<td>SaleItem with a single category</td>
<td><code>{ &quot;categories&quot;: [ &quot;Shirts&quot; ] }</code></td>
</tr>
<tr>
<td>SaleItem with a main and sub category</td>
<td><code>{ &quot;categories&quot;: [ &quot;Food&quot;, &quot;Mains&quot; ] }</code></td>
</tr>
<tr>
<td>SaleItem with multiple categories</td>
<td><code>{ &quot;categories&quot;: [ &quot;Computers&quot;, &quot;Accessories&quot;, &quot;Keyboards&quot; ] }</code></td>
</tr>
</tbody></table>
<h2 id='data-dictionary-certificationcode'>CertificationCode</h2>
<p>Certification code for this Sale System.</p>

<p>DataMesh will provide a <code>CertificationCode</code> to be used for the UAT environment. Once the Sale System is certified, DataMesh will provide a <code>CertificationCode</code> to be included in the production build of the Sale System. </p>
<h2 id='data-dictionary-datetime'>DateTime</h2>
<p>Current Sale System time, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. This will be included in receipts. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot; </p>
<h2 id='data-dictionary-eanupc'>EanUpc</h2>
<p>a standard unique identifier for the product. Either the UPC, EAN, or ISBN. Required for products with a UPC, EAN, or ISBN</p>
<h2 id='data-dictionary-encrypteddata'>EncryptedData</h2>
<p>Encryption of content = &quot;SensitiveCardData&quot;:{…} in canonical form (i.e. without white space). </p>

<p>Prior to encryption, pad the content with 80h then as many 00h bytes so that the result is a multiple of 8 bytes. </p>

<p>Encrypt the result. </p>

<p>Present as a string in hex.</p>
<h2 id='data-dictionary-encryptedkey'>EncryptedKey</h2>
<p>A double length 3DES key (i.e. 16 bytes) that is a unique Data Encryption Key which must be changed every time new sensitive data is sent and is encrypted by the KEK using the <a href="#data-dictionary-algorithm">Algorithm</a>.</p>

<p>The key value is represented in hex (32 hex digits). For example: &quot;F8131F320E499A1474A15B14F42F3E06&quot;.</p>
<h2 id='data-dictionary-entrymode'>EntryMode</h2>
<p>Indicates how a card was presented. </p>

<p>Possible values: </p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;File&quot;</td>
<td>Mirrored from the payment request if a <code>PaymentToken</code> was used</td>
</tr>
<tr>
<td>&quot;Keyed&quot;</td>
<td>Mirrored from the request if a card not present transaction</td>
</tr>
<tr>
<td>&quot;Manual&quot;</td>
<td>PAN was manually keyed on the POI terminal</td>
</tr>
<tr>
<td>&quot;Scanned&quot;</td>
<td>QR code was scanned by the POI terminal</td>
</tr>
<tr>
<td>&quot;MagStripe&quot;</td>
<td>Card was swiped</td>
</tr>
<tr>
<td>&quot;ICC&quot;</td>
<td>Card was inserted into the chip reader</td>
</tr>
<tr>
<td>&quot;Tapped&quot;</td>
<td>Card was read with contactless reader</td>
</tr>
<tr>
<td>&quot;Mobile&quot;</td>
<td>If a mobile phone was used to finalise the payment, for example, a mobile phone scanning a QR code</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-errorcondition'>ErrorCondition</h2>
<p>Providers extra detail in the event of an error which enables refinement of error processing by the sale software.</p>

<p>Error conditions may be added over time. To ensure forwards compatibility any error handling in the 
Sale System should allow for a &quot;catch all&quot; which handles currently undefined error conditions.</p>

<p>Possible values: </p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;Aborted&quot;</td>
<td>The Initiator of the request has sent an Abort message request, which was accepted and processed.</td>
</tr>
<tr>
<td>&quot;Busy&quot;</td>
<td>The system is busy, try later</td>
</tr>
<tr>
<td>&quot;Cancel&quot;</td>
<td>The user has aborted the transaction on the PED keyboard, for instance during PIN entering.</td>
</tr>
<tr>
<td>&quot;DeviceOut&quot;</td>
<td>Device out of order</td>
</tr>
<tr>
<td>&quot;InsertedCard&quot;</td>
<td>If the Input Device request a NotifyCardInputFlag and the card holder enters a card in the card reader without answers to the Input command, the POI abort the Input command processing, and answer a dedicated ErrorCondition value in the Input response message.</td>
</tr>
<tr>
<td>&quot;InProgress&quot;</td>
<td>The transaction is still in progress and then the command cannot be processed</td>
</tr>
<tr>
<td>&quot;LoggedOut&quot;</td>
<td>Not logged in</td>
</tr>
<tr>
<td>&quot;MessageFormat&quot;</td>
<td>Error on the format of the message, AdditionalResponse shall contain the identification of the data, and the reason in clear text.</td>
</tr>
<tr>
<td>&quot;NotAllowed&quot;</td>
<td>A service request is sent during a Service dialogue. A combination of services not possible to provide. During the CardReaderInit message processing, the user has entered a card which has to be protected by the POI, and cannot be processed with this device request from the external, and then the Sale System.</td>
</tr>
<tr>
<td>&quot;NotFound&quot;</td>
<td>The transaction is not found (e.g. for a reversal or a repeat)</td>
</tr>
<tr>
<td>&quot;PaymentRestriction&quot;</td>
<td>Some sale items are not payable by the card proposed by the card holder.</td>
</tr>
<tr>
<td>&quot;Refusal&quot;</td>
<td>The transaction is refused by the host or the rules associated to the card, and cannot be repeated.</td>
</tr>
<tr>
<td>&quot;UnavailableDevice&quot;</td>
<td>The hardware is not available (absent, not configured...)</td>
</tr>
<tr>
<td>&quot;UnavailableService&quot;</td>
<td>The service is not available (not implemented, not configured, protocol version too old...)</td>
</tr>
<tr>
<td>&quot;InvalidCard&quot;</td>
<td>The card entered by the card holder cannot be processed by the POI because this  card is not configured in the system</td>
</tr>
<tr>
<td>&quot;UnreachableHost&quot;</td>
<td>Acquirer or any host is unreachable or has not answered to an online request, so is considered as temporary unavailable. Depending on the Sale context, the request could be repeated (to be compared with &quot;Refusal&quot;).</td>
</tr>
<tr>
<td>&quot;WrongPIN&quot;</td>
<td>The user has entered the PIN on the PED keyboard and the verification fails</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-eventtonotify'>EventToNotify</h2>
<ul>
<li><strong>Reject</strong> - the request cannot be accepted. For example, message format error, mandatory fields missing, or payment/reversal transaction not found.</li>
<li><strong>CompletedMessage</strong> - if the Payment/Reversal has already been completed.</li>
</ul>
<h2 id='data-dictionary-eventdetails'>EventDetails</h2>
<p>When <code>EventToNotify</code> is &quot;Reject&quot;</p>

<ul>
<li>&quot;Message not Found, last &lt;MessageCategory&gt; has ID &lt;ServiceID&gt;&quot;</li>
<li>&quot;Mandatory Data Element or Structure Absent: &lt;Absolute Data Name&gt;&quot;</li>
<li>&quot;General Parsing Error: &lt;Absolute Data Name&gt;&quot;</li>
<li>&quot;Unexpected Data Element or Structure: &lt;Absolute Data Element&gt;&quot;</li>
<li>&quot;Unexpected Data Element Value: &lt;Absolute Data Element&gt; - &lt;Expected value(s) or reason&gt;&quot;</li>
<li>&quot;Repeated Message: ServiceID - &lt;Value&gt;&quot;</li>
</ul>

<p>When <code>EventToNotify</code> is &quot;CompletedMessage&quot;</p>

<ul>
<li>&quot;Service Not Aborted - Reason: Completed – from: &lt;SaleID&gt; - MessageID: &lt;ServiceID&gt;&quot;</li>
</ul>
<h2 id='data-dictionary-forceentrymode'>ForceEntryMode</h2>
<p>Used to restrict card presentment to the specified type</p>

<p><strong>Keyed</strong> - A Card Not Present transaction.
<strong>Manual</strong> - to enter manually into the POI terminal.
<strong>Scanned</strong> - for QR Code scanned by the POI terminal.
<strong>MagStripe</strong> - for card swipes.
<strong>ICC</strong> - for card insertions.
<strong>Tapped</strong> - if card taps.
<strong>Mobile</strong> - if a mobile phone is used to finalise the payment. For example, a mobile phone scanning a QR Code.</p>
<h2 id='data-dictionary-forceonlineflag'>ForceOnlineFlag</h2>
<p>Boolean.</p>

<p>If &#39;true&#39; the transaction will only be processed in online mode, and will fail if there is no response from the Acquirer.</p>
<h2 id='data-dictionary-infoqualify'>InfoQualify</h2>
<p>Qualification of the information to sent to an output logical device, to display or print to the Cashier.</p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Status</td>
<td>The information is a new state on which the message sender is entering. For instance, during a payment, the POI could display to the Cashier that POI request an authorisation to the host acquirer.</td>
</tr>
<tr>
<td>Error</td>
<td>The information is related to an error situation occurring on the message sender.</td>
</tr>
<tr>
<td>Display</td>
<td>Standard display interface.</td>
</tr>
<tr>
<td>Input</td>
<td>Merchant input is required.</td>
</tr>
<tr>
<td>POIReplication</td>
<td>Information displayed on the Cardholder POI interface, replicated on the Cashier interface.</td>
</tr>
<tr>
<td>CustomerAssistance</td>
<td>If card holder input is required but the merchant may assist by providing the input data via the CashierInput device.</td>
</tr>
</tbody></table>

<aside class="success">
For all input types, the card holder input may also be provided on the POI terminal. 
</aside>
<h2 id='data-dictionary-inputcommand'>InputCommand</h2>
<p>Defines the input type required by the cashier.</p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>GetAnyKey</td>
<td>Wait for any key press. For example, to get confirmation from the cashier that a display has been read.</td>
</tr>
<tr>
<td>GetConfirmation</td>
<td>Yes/No answer as in the case when prompting for &quot;Signature OK?&quot;. The result of this command is boolean true/false.</td>
</tr>
<tr>
<td>Password</td>
<td>A merchant password as in the case during a refund transaction.</td>
</tr>
<tr>
<td>GetMenuEntry</td>
<td>A selection from a list of options. For example, assisting the card holder by selecting the account type: Savings, Cheque or Credit.</td>
</tr>
<tr>
<td>TextString</td>
<td>A text string.</td>
</tr>
<tr>
<td>DigitString</td>
<td>A string of digits.</td>
</tr>
<tr>
<td>DecimalString</td>
<td>A string of digits with a decimal point.</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-itemamount'>ItemAmount</h2>
<p>Total amount of the item</p>
<h2 id='data-dictionary-itemid'>ItemID</h2>
<p>A unique identifier for the sale item within the context of this purchase. e.g. a 0..n integer which increments by one for each sale item.</p>
<h2 id='data-dictionary-keyidentifier'>KeyIdentifier</h2>
<p>Indicates the key type. Available values: </p>

<ul>
<li>&quot;SpecV2TestDATKey&quot; for test environment</li>
<li>&quot;SpecV2ProdDATKey&quot; for production environment</li>
</ul>
<h2 id='data-dictionary-keyversion'>KeyVersion</h2>
<p>Contains either a counter or the creation date/time of the key formatted as &quot;YYYYMMDDHHmmss.mmm&quot; where:</p>

<ul>
<li>YYYY is the 4-digit year</li>
<li>MM is the 2-digit month.</li>
<li>DD is the 2-digit day.</li>
<li>HH is the 2-digit hour from 00 to 23.</li>
<li>mm is the 2-digit minute.</li>
<li>ss is the 2-digit second.</li>
<li>mmm is the 3-digit millisecond.</li>
</ul>

<p>Any new value must be &gt; any previous value sent</p>
<h2 id='data-dictionary-mac'>MAC</h2>
<p>The last 8 bytes in hex (i.e. 16 hex digits) from:</p>

<ol>
<li>Concatenating the preceding data in canonical form (i.e. without white spaces and line feeds in key:value form: <code>&quot;MessageHeader&quot;:{...},&quot;LoginRequest&quot;:{...})</code></li>
<li>Hashing the result using SHA256. The result of the SHA256 hash is 32 bytes.</li>
<li>Append 80h 00h 00h 00h 00h 00h 00h 00h to the hash. The result has 40 bytes.</li>
<li>3DES CBC encrypt the result by the session Message Authentication Key.</li>
</ol>
<h2 id='data-dictionary-maintenanceallowed'>MaintenanceAllowed</h2>
<p>Optional. If not present, it default to true.</p>

<ul>
<li>If set to true, it indicates that the POI Terminal may go into maintenance mode. For example, the POI Terminal can be upgraded.</li>
<li>This does not restrict the POI Terminal but is treated as an advise. The POI Terminal may present a warning for example if set to false.</li>
</ul>
<h2 id='data-dictionary-maskedpan'>MaskedPAN</h2>
<p>First six digits of the PAN followed by dots followed by the last 4 digits of the PAN.</p>

<p>The total length of the string = PAN Length.</p>
<h2 id='data-dictionary-merchantcategorycode'>MerchantCategoryCode</h2>
<p>If present, overrides the MCC used for processing the transaction if allowed. Refer to ISO 18245 for available codes.</p>
<h2 id='data-dictionary-messageclass'>MessageClass</h2>
<p>Informs the receiver of the class of message. Available values: </p>

<ul>
<li><strong>Service</strong> - A transaction message pair initiated by the Sale System, and requested to the POI System</li>
<li><strong>Device</strong> - A device message pair</li>
<li><strong>Event</strong> - An unsolicited event notification by the POI System to the Sale System.</li>
</ul>
<h2 id='data-dictionary-messagecategory'>MessageCategory</h2>
<p>Category of message. Available values: </p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Abort</td>
<td>Abort message request</td>
</tr>
<tr>
<td>Admin</td>
<td>Admin request or response</td>
</tr>
<tr>
<td>BalanceInquiry</td>
<td>Balance Inquiry request or response</td>
</tr>
<tr>
<td>CardAcquisition</td>
<td>Card Acquisition request or response</td>
</tr>
<tr>
<td>Display</td>
<td>Display message request or response</td>
</tr>
<tr>
<td>Event</td>
<td>Event Notification message</td>
</tr>
<tr>
<td>Input</td>
<td>Input message request or response</td>
</tr>
<tr>
<td>Login</td>
<td>Login message request or response</td>
</tr>
<tr>
<td>Logout</td>
<td>Logout message request or response</td>
</tr>
<tr>
<td>Payment</td>
<td>Payment message request or response</td>
</tr>
<tr>
<td>Print</td>
<td>Print message request or response</td>
</tr>
<tr>
<td>Reconciliation</td>
<td>Reconciliation message request or response</td>
</tr>
<tr>
<td>TransactionStatus</td>
<td>TransactionStatus message request or response</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-messagetype'>MessageType</h2>
<p>Type of message of the Sale to POI protocol. Available values: </p>

<ul>
<li>Request</li>
<li>Response</li>
<li>Notification</li>
</ul>
<h2 id='data-dictionary-operatorid'>OperatorId</h2>
<p>An optional value sent in the <a href="#cloud-api-reference-methods-login">Login Request</a> for information only. Used to identify the cashier using the Sale Terminal during the session.</p>

<p>If present, totals in the <a href="#cloud-api-reference-methods-reconciliation">ReconciliationResponse</a> will be grouped by this value. If not present, payment transactions that do not specify a <code>OperatorId</code> will not be grouped under a <code>OperatorId</code>.</p>

<p>Note that different cashiers may still transact during the same login session by setting an <code>OperatorId</code> per payment. </p>
<h2 id='data-dictionary-originalpoitransaction'>OriginalPOITransaction</h2>
<p>An object which identifies a previous POI transaction. </p>

<p>For a purchase, it instructs the POI System to use the payment card details from the original transaction if available. Note that the <code>RequestedAmount</code> must be &lt;= the original transaction <code>RequestedAmount</code>.</p>

<p>For a refund or completion, indicates which original transaction this should be matched to. A refund or completion may occur on a different Sale System and POI Terminal to the original transaction.</p>
<h2 id='data-dictionary-outputformat'>OutputFormat</h2>
<p>Receipt format output. Always &quot;XHTML&quot;</p>
<h2 id='data-dictionary-outputxhtml'>OutputXHTML</h2>
<p>The payment receipt in XHTML format, coded in BASE64.</p>
<h2 id='data-dictionary-paymentacquirerdata-acquirerid'>PaymentAcquirerData.AcquirerID</h2>
<p>The ID of the acquirer which processed the transaction</p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;560251&quot;</td>
<td>NAB</td>
</tr>
</tbody></table>

<!--
"560279"             | CBA
"560254"             | ANZ
"560192"             | Westpac
-->
<h2 id='data-dictionary-paymentbrand'>PaymentBrand</h2>
<p>Identifies the payment brand used for a payment. </p>

<aside class="notice">
Please note that this list may expand in the future as new payment types are added. 
</aside>

<p>Available values:</p>

<ul>
<li>&quot;VISA&quot;</li>
<li>&quot;Mastercard&quot;</li>
<li>&quot;American Express&quot;</li>
<li>&quot;Diners Club&quot;</li>
<li>&quot;JCB&quot;</li>
<li>&quot;UnionPay&quot;</li>
<li>&quot;CUP Debit&quot;</li>
<li>&quot;Discover&quot;</li>
<li>&quot;Debit&quot;</li>
<li>&quot;AliPay&quot;</li>
<li>&quot;WeChat Pay&quot;</li>
<li>&quot;Card&quot;</li>
</ul>
<h2 id='data-dictionary-paymentcurrency'>PaymentCurrency</h2>
<p>Three digit currency code as defined by <a href="https://en.wikipedia.org/wiki/ISO_4217">ISO 4217</a></p>
<h2 id='data-dictionary-paymenttransaction-transactionconditions-acquirerid'>PaymentTransaction.TransactionConditions.AcquirerID</h2>
<p>Restricts card processing to the specified acquirers only. If not present, all acquirers are supported.</p>

<p>Array of string.</p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;560251&quot;</td>
<td>NAB</td>
</tr>
</tbody></table>

<!--
"560279"             | CBA
"560254"             | ANZ
"560192"             | Westpac
-->
<h2 id='data-dictionary-paymenttype'>PaymentType</h2>
<p>Indicates the type of payment to process. If not present in the payment request the value will default to &quot;Normal&quot;. </p>

<p>Available values: </p>

<ul>
<li>&quot;Normal&quot; a purchase transaction or purchase with cash-out transaction</li>
<li>&quot;Refund&quot; a refund</li>
<li>&quot;CashAdvance&quot; a cash-out only transaction</li>
</ul>
<h2 id='data-dictionary-poiid'>POIID</h2>
<p>Uniquely identifies the POI Terminal. This value is provided by DataMesh.</p>

<p>For Sale Systems that do not need a POI Terminal, the value must be &quot;POI Server&quot;</p>
<h2 id='data-dictionary-poireconciliationid'>POIReconciliationID</h2>
<p>Identification of the reconciliation period between Sale and POI, to provide the transaction totals during this period.</p>

<p>Allows counting of transactions by both parties in the Sale to POI reconciliation.</p>

<p>Returned in a <a href="#payment-response">payment response</a> if <a href="#data-dictionary-result">result</a> &quot;Success&quot; or &quot;Partial&quot;.</p>

<p>In the Reconciliation request, when <a href="#reconciliationtype">ReconciliationType</a> is &quot;PreviousReconciliation&quot;, this field allows to request the reconciliation result of a previous period of transaction.</p>
<h2 id='data-dictionary-poiserialnumber'>POISerialNumber</h2>
<p>This last POISerialNumber returned in an earlier login response. If this is the first login from the Sale System, this field is absent.</p>
<h2 id='data-dictionary-poitransactionid'>POITransactionID</h2>
<p>Unique identification of a POI transaction for a <a href="#data-dictionary-poiid">POIId</a>. </p>

<p>Contains the following fields: </p>

<table><thead>
<tr>
<th><div style="width:200px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>A unique transaction id from the POI system</td>
</tr>
<tr>
<td><a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time on the POI system, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
</tbody></table>
<h2 id='data-dictionary-productcode'>ProductCode</h2>
<p>a unique identifier for the product within the merchant. For example if two card holders purchase the same product at two different stores owned by the merchant, both purchases should contain the same <code>ProductCode</code>.</p>
<h2 id='data-dictionary-protocolversion'>ProtocolVersion</h2>
<p>Version of the Sale to POI protocol specifications. Set to &quot;3.1-dmg&quot; for the API outlined in this specification.</p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>&quot;3.1&quot;</td>
<td>Nexo 3.1 compliant</td>
</tr>
<tr>
<td>&quot;3.1-dmg&quot;</td>
<td>Nexo 3.1 with additional fields added by DataMesh which are outside the Nexo standard (e.g. surcharge)</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-provideridentification'>ProviderIdentification</h2>
<p>The name of the company supplying the Sale System. </p>

<p>DataMesh will provide a <code>ProviderIdentification</code> to be used for the UAT environment. Once the Sale System is certified, DataMesh will provide a <code>ProviderIdentification</code> to be included in the production build of the Sale System. </p>
<h2 id='data-dictionary-paymentinstrumentdata'>PaymentInstrumentData</h2>
<blockquote>
<p>PaymentInstrumentData object</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="p">{</span><span class="w">
   </span><span class="nl">"PaymentInstrumentData"</span><span class="p">:{</span><span class="w">
      </span><span class="nl">"PaymentInstrumentType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"CardData"</span><span class="p">:{</span><span class="w">
         </span><span class="nl">"EntryMode"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
         </span><span class="nl">"ProtectedCardData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-envelopedData"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"EnvelopedData"</span><span class="p">:{</span><span class="w">
               </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v0"</span><span class="p">,</span><span class="w">
               </span><span class="nl">"Recipient"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"KEK"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"Version"</span><span class="p">:</span><span class="s2">"v4"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"KEKIdentifier"</span><span class="p">:{</span><span class="w">
                        </span><span class="nl">"KeyIdentifier"</span><span class="p">:</span><span class="s2">"xxxDATKey"</span><span class="p">,</span><span class="w">
                        </span><span class="nl">"KeyVersion"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                     </span><span class="p">},</span><span class="w">
                     </span><span class="nl">"KeyEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
                        </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="w">
                     </span><span class="p">},</span><span class="w">
                     </span><span class="nl">"EncryptedKey"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                  </span><span class="p">}</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="nl">"EncryptedContent"</span><span class="p">:{</span><span class="w">
                  </span><span class="nl">"ContentType"</span><span class="p">:</span><span class="s2">"id-data"</span><span class="p">,</span><span class="w">
                  </span><span class="nl">"ContentEncryptionAlgorithm"</span><span class="p">:{</span><span class="w">
                     </span><span class="nl">"Algorithm"</span><span class="p">:</span><span class="s2">"des-ede3-cbc"</span><span class="p">,</span><span class="w">
                     </span><span class="nl">"Parameter"</span><span class="p">:{</span><span class="w">
                        </span><span class="nl">"InitialisationVector"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
                     </span><span class="p">}</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nl">"EncryptedData"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
               </span><span class="p">}</span><span class="w">
            </span><span class="p">}</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"SensitiveCardData"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"PAN"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"ExpiryDate"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"CCV"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">},</span><span class="w">
         </span><span class="nl">"PaymentToken"</span><span class="p">:{</span><span class="w">
            </span><span class="nl">"TokenRequestedType"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"TokenValue"</span><span class="p">:</span><span class="s2">"xxx"</span><span class="w">
         </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div>
<p>Object with represents card details for token or manually enter card details. </p>

<p><strong>PaymentInstrumentData</strong></p>

<table><thead>
<tr>
<th><div style="width:300px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-paymentinstrumenttype">PaymentInstrumentType</a></td>
<td></td>
<td>String</td>
<td>Defaults to &quot;Card&quot;. Indicates the card source for the payment. See <a href="#data-dictionary-paymentinstrumenttype">PaymentInstrumentType</a></td>
</tr>
<tr>
<td><strong>CardData</strong></td>
<td></td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td> <a href="#data-dictionary-entrymode">EntryMode</a></td>
<td></td>
<td>String</td>
<td>Only present if <code>PaymentInstrumentType</code> is &quot;Card&quot;. &quot;File&quot; if a Payment Token is used, and &quot;Keyed&quot; for a Card Not Present transaction.</td>
</tr>
<tr>
<td> <strong>ProtectedCardData</strong></td>
<td></td>
<td>Object</td>
<td>Only present if <code>EntryMode</code> is &quot;Keyed&quot;</td>
</tr>
<tr>
<td>  <a href="#contenttype">ContentType</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;id-envelopedData&quot;</td>
</tr>
<tr>
<td>  <strong>EnvelopedData</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>   <a href="#version">Version</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;v0&quot;</td>
</tr>
<tr>
<td>    <strong>Recipient</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>     <strong>KEK</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>      <a href="#version">Version</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;v4&quot;</td>
</tr>
<tr>
<td>      <strong>KEKIdentifier</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>       <a href="#data-dictionary-keyidentifier">KeyIdentifier</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;SpecV2TestDATKey&quot; for test environment, and &quot;SpecV2ProdDATKey&quot; for production</td>
</tr>
<tr>
<td>       <a href="#data-dictionary-keyversion">KeyVersion</a></td>
<td>✔</td>
<td>String</td>
<td>An incrementing value. Either a counter or date formatted as YYYYMMDDHHmmss.mmm. See <a href="#data-dictionary-keyversion">KeyVersion</a></td>
</tr>
<tr>
<td>      <strong>KeyEncryptionAlgorithm</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>       <a href="#data-dictionary-algorithm">Algorithm</a></td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;des-ede3-cbc&quot;.</td>
</tr>
<tr>
<td>      <a href="#data-dictionary-encryptedkey">EncryptedKey</a></td>
<td>✔</td>
<td>String</td>
<td>A double length 3DES key. See <a href="#data-dictionary-encryptedkey">EncryptedKey</a></td>
</tr>
<tr>
<td>    <strong>EncryptedContent</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>     ContentType</td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;id-data&quot;</td>
</tr>
<tr>
<td>     <strong>ContentEncryptionAlgorithm</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>      Algorithm</td>
<td>✔</td>
<td>String</td>
<td>Set to &quot;des-ede3-cbc&quot;</td>
</tr>
<tr>
<td>      <strong>Parameter</strong></td>
<td>✔</td>
<td>Object</td>
<td></td>
</tr>
<tr>
<td>      InitialisationVector</td>
<td>✔</td>
<td>String</td>
<td>An Initial Vector to use for the des-ede3-cbc encryption of the content = SensitiveCardData</td>
</tr>
<tr>
<td>     <a href="#data-dictionary-encrypteddata">EncryptedData</a></td>
<td>✔</td>
<td>String</td>
<td>Encrypted data. See <a href="#data-dictionary-encrypteddata">EncryptedData</a></td>
</tr>
<tr>
<td> <strong>PaymentToken</strong></td>
<td>✔</td>
<td>Object</td>
<td>Only present if <a href="#data-dictionary-entrymode">EntryMode</a> is &quot;File&quot;. Object with identifies the payment token.</td>
</tr>
<tr>
<td>  <a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td>✔</td>
<td>String</td>
<td>&quot;Transaction&quot; or &quot;Customer&quot;. Must match the type of token recorded in the POI System.</td>
</tr>
<tr>
<td>  <a href="#tokenvalue">TokenValue</a></td>
<td>✔</td>
<td>String</td>
<td>Token previously returned from the POI System in the payment, or card acquisition response</td>
</tr>
</tbody></table>

<aside class="warning">
Never send the SensitiveCardData object in the clear. This represents the content to be encrypted and sent within the `ProtectedCardData` element
</aside>

<p><strong>SensitiveCardData</strong></p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#pan">PAN</a></td>
<td>✔</td>
<td>String</td>
<td>The full credit card number</td>
</tr>
<tr>
<td><a href="#expirydate">ExpiryDate</a></td>
<td>✔</td>
<td>String</td>
<td>The expiry date in &quot;MMYY&quot; format</td>
</tr>
<tr>
<td><a href="#ccv">CCV</a></td>
<td></td>
<td>String</td>
<td>The 3 or 4 digit security code associated with the card</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-paymentinstrumenttype'>PaymentInstrumentType</h2>
<p>Indicates the card source for the payment. If not present in the payment defaults to &quot;Card&quot;. Available values:</p>

<ul>
<li>&quot;Card&quot; where the card source is defined by <code>EntryMode</code> and present in either <code>SensitiveCardData</code> or <code>PaymentToken</code>. If neither are present, then payment (card or mobile) is only accepted by the POI Terminal</li>
<li>&quot;Check&quot; where the transaction is simply recorded</li>
<li>&quot;Cash&quot; where the transaction is either recorded, or processed if the POI terminal has cash handling capabilities</li>
<li>&quot;Mobile&quot; to restrict payment to Mobile only. For example, QR Code payment</li>
</ul>
<h2 id='data-dictionary-paymenttoken'>PaymentToken</h2>
<p>An object representing a payment token. Consists of three fields: </p>

<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-tokenrequestedtype">TokenRequestedType</a></td>
<td>✔</td>
<td>String</td>
<td>Mirrored from the request</td>
</tr>
<tr>
<td><a href="#tokenvalue">TokenValue</a></td>
<td>✔</td>
<td>String</td>
<td>The value of the token</td>
</tr>
<tr>
<td><a href="#expirydatetime">ExpiryDateTime</a></td>
<td>✔</td>
<td>String</td>
<td>Expiry of the token, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a></td>
</tr>
</tbody></table>
<h2 id='data-dictionary-productlabel'>ProductLabel</h2>
<p>Product name of a <a href="#data-dictionary-saleitem">SaleItem</a>.</p>

<p>The <code>ProductLabel</code> should contain a short, human readable, descriptive name of the product. </p>

<p>For example, <code>ProductLabel</code> could contain the product name typically printed on the customer receipt. </p>
<h2 id='data-dictionary-quantity'>Quantity</h2>
<p>Item unit quantity</p>
<h2 id='data-dictionary-responserequiredflag'>ResponseRequiredFlag</h2>
<p>Boolean. </p>

<p>True if the Sale System needs to respond to this <code>DisplayRequest</code> with a <code>DisplayResponse</code>. </p>

<p>False if the Sale System does not need to send a <code>DisplayResponse</code>.</p>
<h2 id='data-dictionary-result'>Result</h2>
<p>Indicates the result of the response. Available values: </p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Success</td>
<td>Processing OK. Information related to the result of the processing is contained in other parts of the response message.</td>
</tr>
<tr>
<td>Failure</td>
<td>Processing of the request fails for various reasons. Some further processing according to the type of requested service, the context of the process, and some additional precision about the failure notified in the ErrorCondition data element.</td>
</tr>
<tr>
<td>Partial</td>
<td>The transaction has been processed successfully, but the success is not complete (e.g. only a partial amount is available for the payment, the format to be displayed is not supported and was replaced by a default format).</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-salecapabilities'>SaleCapabilities</h2>
<p>Advises the POI System of the Sale System capabilities and willingness to receive/send event messages. </p>

<p><code>SaleCapabilities</code> is an array of values containing a combination of the following:</p>

<ul>
<li><strong>CashierStatus</strong>: POI Terminal changes of state are reported back to the Sale System. e.g.

<ul>
<li>&quot;Waiting for Card Presentment&quot;</li>
<li>&quot;PIN Entry&quot;</li>
<li>&quot;Waiting for Host Authorisation&quot;</li>
<li>&quot;Signature Validation&quot;</li>
</ul></li>
<li><strong>CashierError</strong>: POI Terminal errors are reported back to the Sale System. e.g.

<ul>
<li>&quot;Out of paper&quot;</li>
<li>&quot;Printer Error&quot;</li>
<li>&quot;Card Swipe Error&quot;</li>
</ul></li>
<li><strong>CashierInput</strong>: Allows the cashier to provide input from the Sale System. e.g.

<ul>
<li>&quot;Signature OK?&quot;</li>
</ul></li>
<li><strong>CustomerAssistance</strong>: Allows the cashier to provide assistance to card holders by providing input at specific screens but card holders can still select on terminal. e.g.

<ul>
<li>&quot;Account Selection (Cheque, Savings or Credit).</li>
</ul></li>
<li><strong>PrinterReceipt</strong>: Redirects receipts to the Sale System instead of the POI Terminal.</li>
</ul>
<h2 id='data-dictionary-saleid'>SaleID</h2>
<p>Uniquely identifies the Sale System. This value is provided by DataMesh.</p>
<h2 id='data-dictionary-saleitem'>SaleItem</h2>
<p>The <code>SaleItem</code> array defines the basket attached to this transaction. Each item is an object which defines a group of similar products in the basket.</p>

<p>The sum of the sale items could be more than <code>RequestedAmount</code> in case of split payment without split of the items (split basket).</p>

<aside class="success">
Please contact the Data Mesh integrations team at <a href="mailto:integrations@datameshgroup.com">integrations@datameshgroup.com</a> to discuss how to map the Sale System basket to the SaleItem array.
</aside>
<h3 id='data-dictionary-saleitem-sale-items-with-a-upc-ean-isbn'>Sale items with a UPC/EAN/ISBN</h3>
<blockquote>
<p>Example <code>SaleItem</code> with UPC</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"SaleItem"</span><span class="p">:[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"5000112576009"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"EanUpc"</span><span class="p">:</span><span class="s2">"5000112576009"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"1.95"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"1.95"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Coca-Cola No Sugar 1.25L"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<ul>
<li>Items which have a UPC/EAN/ISBN must include the UPC/EAN/ISBN in the <a href="#data-dictionary-eanupc">EanUpc</a> field. </li>
<li>Both <a href="#data-dictionary-productcode">ProductCode</a> and <a href="#data-dictionary-eanupc">EanUpc</a> should be populated, even if they are the same value</li>
<li>Other standard mandatory fields in sale item are still mandatory.</li>
</ul>
<h3 id='data-dictionary-saleitem-sale-items-with-modifiers'>Sale items with modifiers</h3>
<blockquote>
<p>Example <code>SaleItem</code> with modifiers</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"SaleItem"</span><span class="p">:[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"15.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"15.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Big Kahuna Burger"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ParentItemID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776-0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Extra pineapple"</span><span class="w">
  </span><span class="p">},</span><span class="w">  
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ParentItemID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776-1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"5"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Side of fries"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXYU998"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"5.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"5.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Tasty Beverage"</span><span class="w">
  </span><span class="p">},</span><span class="w">  
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>A sale system may represent sale items in the basket as a hierarchy of sale items and sub items, typically referred to as &#39;modifiers&#39;, or &#39;substitutions&#39;. </p>

<p>Examples of products with modifiers: </p>

<ul>
<li>a &quot;Big Kahuna Burger&quot; could contain &quot;Extra pineapple&quot; or &quot;Side of fries&quot; as modifiers.</li>
<li>a &quot;Sirloin steak&quot; could contain &quot;Pepper sauce&quot; or &quot;Medium rare&quot; as modifiers.</li>
<li>a &quot;Cappuccino&quot; could contain &quot;Sugar&quot; or &quot;Large&quot; as modifiers.</li>
</ul>

<p>If the Sale System basket contains sale items and modifiers: </p>

<ul>
<li>Include both sale items and modifiers as <code>SaleItem</code> objects in the <code>SaleItem</code> array.</li>
<li>For each modifier, set the <code>ParentItemID</code> field to the value of the parent sale item <code>ItemID</code></li>
<li>Set the <code>ItemAmount</code> to the value of the modifier, or set to zero if no value </li>
<li>The total amount of an item will be the sum of <code>ItemAmount</code> in the sale item, and all associated modifiers</li>
<li>Modifiers may contain a unique <code>ProductCode</code> or share the same <code>ProductCode</code> as the parent sale item</li>
</ul>

<p>Some sale Sale Systems do not record modifiers as individual items. For example, they are stored in a &#39;notes&#39; or &#39;cooking instructions&#39; field. In this case the additional notes should be included in the <a href="#data-dictionary-additionalproductinfo">AdditionalProductInfo</a> field. </p>
<h3 id='data-dictionary-saleitem-item-bundles'>Item bundles</h3>
<p>A Sale System may sell items which are bundled together. </p>

<p>Examples of item &quot;bundles&quot;:</p>

<ul>
<li>a &quot;lunch special&quot;, containing a main, a dessert, and a drink</li>
<li>a &quot;Valentines day&quot; bundle, containing flowers, and chocolates </li>
<li>a &quot;mixed wine case&quot;, containing a selection of different wines </li>
<li>a &quot;burger meal&quot;, containing burger, chips and a drink</li>
</ul>

<p>The Sale System should populate the <code>SaleItem</code> array based on how the &quot;bundle&quot; is represented in the basket. </p>

<p>If the &quot;bundle&quot; is represented as a unique product with a title and a price, include the &quot;bundle&quot; product as a <code>SaleItem</code>. Contents of the bundle can then be included either as &quot;modifiers&quot; associated with the bundle, or as a text description in the <a href="#data-dictionary-additionalproductinfo">AdditionalProductInfo</a> field. </p>

<p>If the &quot;bundle&quot; is a shortcut in the Sale System which has no value associated and is simply used to add multiple products to the basket, include each product as a <code>SaleItem</code>.</p>

<p>Any <code>SaleItem</code> discounts associated with the &quot;item bundle&quot; should be included in the <code>Discount</code> field.</p>
<h3 id='data-dictionary-saleitem-discounts'>Discounts</h3><div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"SaleItem"</span><span class="p">:[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"100.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"80.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Shirt"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Discount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"DiscountReason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"20% OFF SALE"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ParentItemID"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH777"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"-10.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"$10 voucher"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Discount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"10.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"DiscountReason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$10 voucher"</span><span class="w"> 
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<p>Discounts applied to the basket should be reflected by the <code>SaleItem</code> array based on how the Sale System handles discounts: </p>

<ul>
<li>For discounts applied across the basket or to an individual item:

<ul>
<li>Set <code>UnitPrice</code> to the original item price</li>
<li>Update <code>ItemAmount</code> to reflect the discounted amount</li>
<li>Set <code>Discount</code> to reflect the discounted amount per item </li>
<li>Set <code>DiscountReason</code> to the reason the item was discounted</li>
</ul></li>
<li>For a discount or voucher applied as a sale item:

<ul>
<li>Set <code>UnitPrice</code> to <code>0</code></li>
<li>Include a <code>SaleItem</code> with a negative <code>ItemAmount</code> </li>
<li>Set <code>Discount</code> to the discount value </li>
<li>Set <code>DiscountReason</code> to the reason for the discount</li>
</ul></li>
</ul>
<h3 id='data-dictionary-saleitem-refunds'>Refunds</h3>
<p>If the sale items are known for a refund, they should be represented in the <code>SaleItem</code> array, otherwise the <code>SaleItem</code> array can be left empty.</p>

<p>For example, if a customer purchases three pairs of shoes, and returns one pair:</p>

<ul>
<li>If the Sale System records the returned item, it should include that item in the <code>SaleItem</code> array with the refund </li>
<li>If the Sale System does not record the returned item, but is able to match to the original purchase, it should populate the <code>SaleItem</code> array with the items from the orignial purchase. </li>
<li>If the Sale System does not record the return item, and is unable to match to the original purchase, the <code>SaleItem</code> array can be left empty</li>
</ul>

<p>Refund <code>SaleItem</code> objects are represented the same as purchase <code>SaleItem</code> objects.</p>

<p>For example:</p>

<ul>
<li>The fields marked as mandatory are still mandatory<br></li>
<li>Each <code>ItemAmount</code> is a positive amount which reflects the amount being refunded</li>
<li>The <code>Quantity</code> reflects the number of the sale item being refunded</li>
</ul>
<h3 id='data-dictionary-saleitem-saleitem-fields'>SaleItem fields</h3>
<blockquote>
<p>Example sale item array</p>
</blockquote>
<div class="highlight"><pre class="highlight json tab-json"><code><span class="nl">"SaleItem"</span><span class="p">:[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"5000112576009"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"EanUpc"</span><span class="p">:</span><span class="s2">"5000112576009"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"4"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"1.95"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"7.80"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Coca-Cola No Sugar 1.25L"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"CostBase"</span><span class="p">:</span><span class="s2">"0.75"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Discount"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Drinks"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Soft Drink"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"Coca-Cola"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"QuantityInStock"</span><span class="p">:</span><span class="s2">"42"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"HHBY663"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"EanUpc"</span><span class="p">:</span><span class="s2">"9310015241925"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"1.75"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"1.75"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Doritos Corn Chips Cheese Supreme Share Pack 170g"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"CostBase"</span><span class="p">:</span><span class="s2">"1.42"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Discount"</span><span class="p">:</span><span class="s2">"0.24"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Snacks &amp; Confectionery"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Chips"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"Doritos"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"QuantityInStock"</span><span class="p">:</span><span class="s2">"15"</span><span class="w">
  </span><span class="p">},</span><span class="w">   
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"HGY865"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Litre"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"54.25"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"1.45"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"78.66"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Fuel Unleaded 91"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Discount"</span><span class="p">:</span><span class="s2">"0.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Category"</span><span class="p">:</span><span class="s2">"Fuel"</span><span class="w">
  </span><span class="p">},</span><span class="w">  
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"54.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"54.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Sirloin steak"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Food"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mains"</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776.0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Pepper sauce"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Food"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mains"</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">  
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"XXVH776.1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"0"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"Side of fries"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Food"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Sides"</span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"24115522"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"79.95"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"79.95"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"NOLTE LS SHIRT"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"CostBase"</span><span class="p">:</span><span class="s2">"40.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Discount"</span><span class="p">:</span><span class="s2">"0.00"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Men"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Clothing"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Shirts"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"ACADEMY BRAND"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"QuantityInStock"</span><span class="p">:</span><span class="s2">"55"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PageURL"</span><span class="p">:</span><span class="s2">"https://myweb/24115522/Nolte-LS-Shirt.html"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ImageURLs"</span><span class="p">:[</span><span class="s2">"https://myweb/productimages/24115522.jpg"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"Size"</span><span class="p">:</span><span class="s2">"XL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Colour"</span><span class="p">:</span><span class="s2">"SLATE GREEN CHECK"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Weight"</span><span class="p">:</span><span class="mi">1000</span><span class="p">,</span><span class="w">
    </span><span class="nl">"WeightUnitOfMeasure"</span><span class="p">:</span><span class="s2">"Gram"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="nl">"ItemID"</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductCode"</span><span class="p">:</span><span class="s2">"24390516"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitOfMeasure"</span><span class="p">:</span><span class="s2">"Other"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Quantity"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"UnitPrice"</span><span class="p">:</span><span class="s2">"1650"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ItemAmount"</span><span class="p">:</span><span class="s2">"1650"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ProductLabel"</span><span class="p">:</span><span class="s2">"JIMMY CHOO LUIS 90 PUMP"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Categories"</span><span class="p">:[</span><span class="s2">"Women"</span><span class="p">,</span><span class="s2">"Shoes"</span><span class="p">,</span><span class="s2">"Heels"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"Brand"</span><span class="p">:</span><span class="s2">"JIMMY CHOO"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"QuantityInStock"</span><span class="p">:</span><span class="s2">"2"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"PageURL"</span><span class="p">:</span><span class="s2">"https://website/24390516/Luis-90-Pump.html"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"ImageURLs"</span><span class="p">:[</span><span class="s2">"https://website/productimages/24390516.jpg"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"Size"</span><span class="p">:</span><span class="s2">"38 EU"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Colour"</span><span class="p">:</span><span class="s2">"BALLET PINK/CRYSTAL"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Weight"</span><span class="p">:</span><span class="mi">500</span><span class="p">,</span><span class="w">
    </span><span class="nl">"WeightUnitOfMeasure"</span><span class="p">:</span><span class="s2">"Gram"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre></div>
<table><thead>
<tr>
<th><div style="width:180px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-itemid">ItemID</a></td>
<td>✔</td>
<td>Integer</td>
<td>A unique identifier for the sale item within the context of this payment. e.g. a 0..n integer which increments by one for each sale item.</td>
</tr>
<tr>
<td><a href="#data-dictionary-productcode">ProductCode</a></td>
<td>✔</td>
<td>String</td>
<td>A unique identifier for the product within the merchant, such as the SKU. For example if two customers purchase the same product at two different stores owned by the merchant, both purchases should contain the same <code>ProductCode</code>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-eanupc">EanUpc</a></td>
<td></td>
<td>String</td>
<td>A standard unique identifier for the product. Either the UPC, EAN, or ISBN. Required for products with a UPC, EAN, or ISBN</td>
</tr>
<tr>
<td><a href="#data-dictionary-unitofmeasure">UnitOfMeasure</a></td>
<td>✔</td>
<td>String</td>
<td>Unit of measure of the <code>Quantity</code>. If this item has no unit of measure, set to &quot;Other&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-quantity">Quantity</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Sale item quantity based on <code>UnitOfMeasure</code>.</td>
</tr>
<tr>
<td><a href="#data-dictionary-unitprice">UnitPrice</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Price per sale item unit. Present if <code>Quantity</code> is included.</td>
</tr>
<tr>
<td><a href="#data-dictionary-itemamount">ItemAmount</a></td>
<td>✔</td>
<td>Decimal</td>
<td>Total amount of the sale item</td>
</tr>
<tr>
<td><a href="#data-dictionary-taxcode">TaxCode</a></td>
<td></td>
<td>String</td>
<td>Type of tax associated with the sale item. Default = &quot;GST&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-salechannel">SaleChannel</a></td>
<td></td>
<td>String</td>
<td>Commercial or distribution channel of the sale item. Default = &quot;Unknown&quot;</td>
</tr>
<tr>
<td><a href="#data-dictionary-productlabel">ProductLabel</a></td>
<td>✔</td>
<td>String</td>
<td>a short, human readable, descriptive name of the product.  For example, <code>ProductLabel</code> could contain the product name typically printed on the customer receipt.</td>
</tr>
<tr>
<td><a href="#data-dictionary-additionalproductinfo">AdditionalProductInfo</a></td>
<td></td>
<td>String</td>
<td>Additional information, or more detailed description of the product item.</td>
</tr>
<tr>
<td><a href="#parentitemid">ParentItemID</a></td>
<td></td>
<td>Integer</td>
<td><em>Required</em> if this item is a &#39;modifier&#39; or sub-item. Contains the <a href="#data-dictionary-itemid">ItemID</a> of the parent <code>SaleItem</code></td>
</tr>
<tr>
<td><a href="#costbase">CostBase</a></td>
<td></td>
<td>Decimal</td>
<td>Cost of the product to the merchant per unit</td>
</tr>
<tr>
<td><a href="#discount">Discount</a></td>
<td></td>
<td>Decimal</td>
<td>If applied, the amount this sale item was discounted by</td>
</tr>
<tr>
<td><a href="#data-dictionary-categories">Categories</a></td>
<td></td>
<td>Array</td>
<td>Array of categories. Top level &quot;main&quot; category at categories[0]. See <a href="#data-dictionary-categories">Categories</a> for more information.</td>
</tr>
<tr>
<td><a href="#brand">Brand</a></td>
<td></td>
<td>String</td>
<td>Brand name - typically visible on the product packaging or label</td>
</tr>
<tr>
<td><a href="#data-dictionary-quantityinstock">QuantityInStock</a></td>
<td></td>
<td>Decimal</td>
<td>Remaining number of this item in stock in same unit of measure as <code>Quantity</code></td>
</tr>
<tr>
<td><a href="#sale-item-tags">Tags</a></td>
<td></td>
<td>Array</td>
<td>String array with descriptive tags for the product</td>
</tr>
<tr>
<td><a href="#restricted">Restricted</a></td>
<td></td>
<td>Boolean</td>
<td><code>true</code> if this is a restricted item, <code>false</code> otherwise. Defaults to <code>false</code> when field is null.</td>
</tr>
<tr>
<td><a href="#productpageurl">PageURL</a></td>
<td></td>
<td>String</td>
<td>URL link to the sale items product page</td>
</tr>
<tr>
<td><a href="#productimageurls">ImageURLs</a></td>
<td></td>
<td>Array</td>
<td>String array of images URLs for this sale item</td>
</tr>
<tr>
<td><a href="#style">Style</a></td>
<td></td>
<td>String</td>
<td>Style of the sale item</td>
</tr>
<tr>
<td><a href="#size">Size</a></td>
<td></td>
<td>String</td>
<td>Size of the sale item</td>
</tr>
<tr>
<td><a href="#colour">Colour</a></td>
<td></td>
<td>String</td>
<td>Colour of the sale item</td>
</tr>
<tr>
<td><a href="#weight">Weight</a></td>
<td></td>
<td>Decimal</td>
<td>Sale item weight, based on <code>WeightUnitOfMeasure</code></td>
</tr>
<tr>
<td><a href="#data-dictionary-unitofmeasure">WeightUnitOfMeasure</a></td>
<td></td>
<td>String</td>
<td>Unit of measure of the <code>Weight</code>.</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-salechannel'>SaleChannel</h2>
<p>Commercial or distribution channel of the item. Default = &quot;Unknown&quot;</p>
<h2 id='data-dictionary-salereferenceid'>SaleReferenceID</h2>
<p>Mandatory for pre-authorisation and completion, otherwise optional.</p>

<p>A globally unique value, used to link a related series of transactions. </p>

<p>For example, a pre-authorisation, followed by a pre-authorisation top-up, and then a completion all require the same <code>SaleReferenceID</code> in the request.</p>

<p>The Sale System must ensure the <code>SaleReferenceID</code> is unique across all <a href="#data-dictionary-saleid">SaleID</a>&#39;s and <a href="#data-dictionary-poiid">POIID</a>&#39;s across the merchant. If Sale Systems are not synchronised, it is recommended that this value should be a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> to ensure uniqueness.</p>
<h2 id='data-dictionary-saletransactionid'>SaleTransactionID</h2>
<p>Identification of a transaction for a given <a href="#data-dictionary-saleid">SaleId</a>. </p>

<p>Contains the following fields: </p>

<table><thead>
<tr>
<th><div style="width:200px">Attribute</div></th>
<th>Requ.</th>
<th>Format</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="#data-dictionary-transactionid">TransactionID</a></td>
<td>✔</td>
<td>String</td>
<td>Unique reference for this sale ticket. Not necessarily unique per payment request; for example a sale with split payments will have a number of payments with the same <a href="#data-dictionary-transactionid">TransactionID</a></td>
</tr>
<tr>
<td><a href="#data-dictionary-timestamp">TimeStamp</a></td>
<td>✔</td>
<td>String</td>
<td>Time of initiating the payment request on the POI System, formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> DateTime. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-shiftnumber'>ShiftNumber</h2>
<p>An optional value sent in the <a href="#cloud-api-reference-methods-login">Login Request</a> for information only. Used to identify the shift that drives the Sale Terminal during the session.</p>

<p>If present, totals in the <a href="#cloud-api-reference-methods-reconciliation">ReconciliationResponse</a> will be grouped by this value. If not present, payment transactions that do not specify a <code>ShiftNumber</code> will not be grouped under a <code>ShiftNumber</code>.</p>

<p>Note that different shifts may still occur during the same login session by setting a <code>ShiftNumber</code> per payment. </p>
<h2 id='data-dictionary-serviceid'>ServiceID</h2>
<p>The <code>ServiceID</code> is a text string between 1 and 10 characters long, which must uniquely identify a transaction between a Sale System and a POI Terminal over a short time period (e.g. one day). </p>

<p>The <code>ServiceID</code> of the message response is mirrored from the <code>ServiceID</code> in the message request. This allows for duplicate message checks. </p>

<p>The POI System will validate that the <code>ServiceID</code> is different from the previous request. The Sale System should validate that the <code>ServiceID</code> in the response matches the <code>ServiceID</code> sent in the request.</p>

<p>The <code>ServiceID</code> is used to identify a transaction to retrieve in a <a href="#cloud-api-reference-methods-transaction-status">transaction status</a> request. </p>
<h2 id='data-dictionary-softwareversion'>SoftwareVersion</h2>
<p>The software version of the Sale System.</p>

<p>Must be the software version of the current Sale System build. </p>
<h2 id='data-dictionary-splitpaymentflag'>SplitPaymentFlag</h2>
<p>Indicates if a payment is a split payment. Default to false. </p>
<h2 id='data-dictionary-taxcode'>TaxCode</h2>
<p>Type of tax associated with the item. Default = &quot;GST&quot;</p>
<h2 id='data-dictionary-totalsgroupid'>TotalsGroupId</h2>
<p>Groups transactions in a login session. </p>

<p>This can be used for reconciliation purposes and may span a single day or different periods.</p>

<p>If not present, payment transactions will remain ungrouped. </p>
<h2 id='data-dictionary-transactiontype'>TransactionType</h2>
<p>Type of transaction for which totals are grouped.</p>

<table><thead>
<tr>
<th>Label</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>Debit</td>
<td>Payment Debit transactions (e.g. if <code>PaymentType</code> is &quot;Normal&quot;)</td>
</tr>
<tr>
<td>Credit</td>
<td>Payment Credit transactions (e.g. if <code>PaymentType</code> is &quot;Refund&quot;)</td>
</tr>
<tr>
<td>CashAdvance</td>
<td>Cash-out payment types or cash components of a Normal payment type</td>
</tr>
<tr>
<td>ReverseDebit</td>
<td>Payment Reversal Debit transactions</td>
</tr>
<tr>
<td>ReverseCredit</td>
<td>Payment Reversal Credit transactions</td>
</tr>
<tr>
<td>OneTimeReservation</td>
<td>Outstanding one-time pre-authorisation transactions, i.e. between pre-authorisation and completion</td>
</tr>
<tr>
<td>CompletedDeffered</td>
<td>One-time Pre-authorisation transactions which have been completed by the completion.</td>
</tr>
<tr>
<td>FirstReservation</td>
<td>Initial pre-authorisation payment types</td>
</tr>
<tr>
<td>UpdateReservation</td>
<td>Updated pre-authorisation payment types</td>
</tr>
<tr>
<td>CompletedReservation</td>
<td>Pre-authorisation transactions which have been completed by the completion</td>
</tr>
<tr>
<td>Declined</td>
<td>Transactions which has not been approved (<code>Result</code> = &quot;Failure&quot; and <code>ErrorCondition</code> = &quot;Refusal&quot;).</td>
</tr>
<tr>
<td>Failed</td>
<td>Transactions which have not successfully completed (<code>Result</code> = &quot;Failure&quot; and <code>ErrorCondition</code> not equal to &quot;Refusal&quot;).</td>
</tr>
</tbody></table>
<h2 id='data-dictionary-terminalenvironment'>TerminalEnvironment</h2>
<p>Available values:</p>

<ul>
<li><strong>Attended</strong> - a cashier interface is present</li>
<li><strong>SemiAttended</strong> - a cashier is present but not interfaced</li>
<li><strong>Unattended</strong> - no cashier is present</li>
</ul>
<h2 id='data-dictionary-timestamp'>TimeStamp</h2>
<p>Date and time of a transaction for the Sale System, the POI System or the Acquirer. </p>

<p>Formatted as <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a>. e.g. &quot;2019-09-02T09:13:51.0+01:00&quot;</p>

<p>Used to ensure the uniqueness of a transaction for Sale System, the POI System or the Acquirer, or indicates the time when the event occurs in the <code>EventNotification</code> message.</p>
<h2 id='data-dictionary-tokenrequestedtype'>TokenRequestedType</h2>
<p>The <code>TokenRequestedType</code> is an optional field per transaction. Indicates if a token should be created for this sale, and if so which type of token. </p>

<ul>
<li>If not present no token is created</li>
<li>If set to &quot;Transaction&quot; a token is created which is only valid for the transaction. For example to process a subsequent Refund or Void/Reversal.</li>
<li>If set to &quot;Customer&quot; a token is created which represents the PAN, and can be used to represent the card holder for a longer period.</li>
</ul>

<aside class="warning">
If a `Payment` is requested using a PaymentToken of the same TokenRequestedType and this JSON element is present, the existing Token is replaced. This can affect other Sale Terminals, so use with caution.
</aside>
<h2 id='data-dictionary-transactionid'>TransactionID</h2>
<p>String.</p>

<p>Used to identify a transaction on the Sale System or POI System.</p>
<h2 id='data-dictionary-unitofmeasure'>UnitOfMeasure</h2>
<p>Unit of measure of the <a href="#data-dictionary-quantity">Quantity</a></p>

<p>Available values: </p>

<ul>
<li>Case</li>
<li>Foot</li>
<li>UKGallon</li>
<li>USGallon</li>
<li>Gram</li>
<li>Inch</li>
<li>Kilogram</li>
<li>Pound</li>
<li>Meter</li>
<li>Centimetre</li>
<li>Litre</li>
<li>Centilitre</li>
<li>Ounce</li>
<li>Quart</li>
<li>Pint</li>
<li>Mile</li>
<li>Kilometre</li>
<li>Yard</li>
<li>Other</li>
</ul>
<h2 id='data-dictionary-unitprice'>UnitPrice</h2>
<p>Price per item unit</p>
<h1 id='testing'>Testing</h1>
<aside class="notice">Pending...</aside>

<p>Download the Fusion accreditation script, complete and return to <a href="mailto:integrations@datameshgroup.com">integrations@datameshgroup.com</a></p>

<!--
- Spreadsheet to include tests on 
  - Test happy path
  - Test unhappy path
  - Test timeouts etc
-->
<h1 id='production'>Production</h1>
<p>The production build of the Sale System should include the following: </p>

<ul>
<li>A production <a href="#data-dictionary-certificationcode">CertificationCode</a>, provided by DataMesh after successful accreditation </li>
<li>Update the <a href="#endpoints">EndPoint</a> to the production URL</li>
</ul>

<p>Merchant checklist for go-live.</p>

<ul>
<li>Wi-Fi network performance</li>
<li>Terminals required</li>
<li>Merchant account setup / terminals required</li>
<li>Bank specific setup</li>
<li>POS configuration </li>
</ul>
<h1 id='appendix'>Appendix</h1><h2 id='appendix-glossary-of-terms'>Glossary of terms</h2>
<ul>
<li><strong>API</strong> - application programming interface.</li>
<li><strong>Card holder</strong> - the owner of a credit or debit card.</li>
<li><strong>Cashier</strong> - operator of the Sale System.</li>
<li><strong>CHD</strong> - cardholder data. Personally identifiable information associated with a person who has a credit or debit card.</li>
<li><strong>JSON</strong> - JavaScript object notation.</li>
<li><strong>MAC</strong> - message authentication code.</li>
<li><strong>Merchant</strong> - a business entity which can accept payments.</li>
<li><strong>Payment</strong> - a request sent from a <code>Sale System</code> to a <code>POI System</code> to perform an operation on a <code>Card holders</code> card.</li>
<li><strong>Payment receipt</strong> - receipt generated by the <code>POI Terminal</code> which contains information about the payment</li>
<li><strong>PIN</strong> - personal identification number.</li>
<li><strong>POI</strong> - point of interaction.</li>
<li><strong>POI System</strong> - system which co-ordinates communication between a Sale System and POI Terminal. i.e. DataMesh Unify.</li>
<li><strong>POI Terminal</strong> - the physical PIN entry device which processes the card payment. i.e. DataMesh Satellite.</li>
<li><strong>POS</strong> - point of sale.</li>
<li><strong>Sale</strong> - a sale, created by a <code>Cashier</code> on a <code>Sale System</code>, with associated <code>Sale Items</code>. A Sale may be paid with one or more <code>Payments</code>.</li>
<li><strong>Sale item</strong> - a item sold to a card holder as a part of a sale.</li>
<li><strong>Sale receipt</strong> - the receipt generated by the <code>Sale System</code> which contains all sale information. The <code>Payment receipt</code> may be embedded into the <code>Sale receipt</code></li>
<li><strong>Sale system</strong> - the system used to process merchant sales. The POS.</li>
<li><strong>Satellite app</strong> - the DataMesh payment application </li>
<li><strong>Unify</strong> - the DataMesh payment switch</li>
<li><strong>UUID</strong> - universally unique identifier.</li>
</ul>
<h2 id='appendix-protocolversion-updates-from-3-1-to-3-1-dmg'>ProtocolVersion updates from 3.1 to 3.1-dmg</h2>
<p>The DataMesh API supports two versions. 
- &quot;3.1&quot; is based on the Nexo 3.1 standard
- &quot;3.1-dmg&quot; is &quot;3.1&quot; with additional fields added by DataMesh which are outside the Nexo standard (e.g. surcharge)</p>

<p>Breaking changes when moving from &quot;3.1&quot; to &quot;3.1-dmg&quot;</p>

<ul>
<li><a href="#data-dictionary-protocolversion">MessageHeader.ProtocolVersion</a> should be set to &quot;3.1-dmg&quot;</li>
<li>Tip amount is now present in <a href="#tipamount">PaymentResponse.PaymentResult.AmountsResp.TipAmount</a>.</li>
<li>Surchage amount is now present in <a href="#surchargeamount">PaymentResponse.PaymentResult.AmountsResp.SurchargeAmount</a>.</li>
<li><code>PaymentResponse.PaymentResult.PaymentReceipt</code> is now an array of receipts. This was a single object in &quot;3.1&quot;</li>
<li>For a successful payment, the acquirer STAN is returned in <code>PaymentResponse.PaymentResult.PaymentAcquirerData.STAN</code>. </li>
<li>For a successful payment, the acquirer RRN is returned in <code>PaymentResponse.PaymentResult.PaymentAcquirerData.RRN</code>. </li>
<li>POS should support the &quot;3.1-dmg&quot; <code>mandatory features checklist</code>

<ul>
<li>Support for <a href="#cloud-api-reference-perform-a-purchase">purchase</a> and <a href="#cloud-api-reference-perform-a-refund">refund</a> payment types</li>
<li>Include <a href="#cloud-api-reference-product-data">product data</a> in each payment request</li>
<li>Additional fields will be added to the message specification over time. To ensure forwards compatibility the Sale System must ignore when extra objects and fields are present in response messages. This includes valid MAC handling in the SecurityTrailer.</li>
<li>Support for TLS and other <a href="#cloud-api-reference-security-requirements">security requirements</a></li>
<li><a href="#settings-user-interface">Settings user interface</a></li>
<li><a href="#payment-user-interface">Payments user interface</a> which handles the <code>Initial UI</code>, <code>Final UI</code>, and <code>cancelling a sale in progress</code></li>
<li>Handle error scenarios as outlined in <a href="#cloud-api-reference-error-handling">error handling</a></li>
<li>Ensure Sale System provides a unique <a href="#payment-identification">payment identification</a></li>
</ul></li>
</ul>
<h2 id='appendix-terminal-configuration'>Terminal configuration</h2><h3 id='appendix-terminal-configuration-pax-terminals'>PAX terminals</h3><h4 id='appendix-terminal-configuration-pax-terminals-enable-access-to-the-home-screen'>Enable access to the home screen</h4>
<p>In a production environment a terminal will typically be locked to the payment application, however in development and test it is useful to enable access to the home screen. </p>

<ul>
<li>In the Satellite payment app, tap the settings icon (⚙)</li>
</ul>

<p><img src="images/pinpad-merchant-password-270x480-716b3765.png" alt="" /></p>

<ul>
<li>Enter <code>0000</code> as the merchant password and ensure the following are ticked

<ul>
<li>Navigation bar</li>
<li>Status Bar</li>
</ul></li>
</ul>

<p><img src="images/pinpad-settings-270x480-831d14c3.png" alt="" /></p>

<ul>
<li>Tap the back icon (⬅) </li>
<li>Hit the &quot;home&quot; button on the terminal to view the home page</li>
</ul>
<h4 id='appendix-terminal-configuration-pax-terminals-configure-terminal-environment'>Configure terminal environment</h4>
<p>Your development terminal will be conncted to the UAT environment, which is the correct environemnt for testing. </p>

<p>To confirm or change the environemnt:</p>

<ul>
<li>Launch the Satellite payment app</li>
<li>Tap the settings icon (⚙)</li>
<li>Enter 8801 as the merchant password</li>
<li>You&#39;ll be presented with a &quot;Change Host URL&quot; dialog</li>
<li>Ensure the URL is <code>wss://test.datameshgroup.com.au/peduat1</code> and tap Enter</li>
</ul>

<p><img src="images/pinpad-host-url-270x480-8d00913e.png" alt="" /></p>

<ul>
<li>Restart the Satellite payment app 

<ul>
<li>Tap the task switcher button</li>
<li>Close the Satellite payment app</li>
<li>Launch the Satellite payment app again </li>
</ul></li>
</ul>
<h4 id='appendix-terminal-configuration-pax-terminals-connect-to-wi-fi'>Connect to Wi-Fi</h4>
<p>The terminal can be connected to Wi-Fi where cellular access isn&#39;t avaiable. </p>

<ul>
<li>Press the Home button </li>
<li>Launch the &quot;Settings&quot; app (⚙icon)</li>
</ul>

<p><img src="images/pinpad-launch-settings-270x480-a26aea90.png" alt="" /></p>

<ul>
<li>If it asks for a password, enter <code>pax9876@@</code></li>
<li>Select Wi-Fi open, choose your Wi-Fi network and enter the password</li>
<li>You should see your Wi-Fi network with a &quot;Connected&quot; status underneath </li>
</ul>
<h4 id='appendix-terminal-configuration-pax-terminals-update-settings'>Update settings</h4>
<p>The terminal will periodically connect to the host and download updated settings.</p>

<p>To force a settings update:</p>

<ul>
<li>Launch the Satellite payment app</li>
<li>Tap the &quot;info&quot; icon (ⓘ) at the top of the screen</li>
<li>The terminal will update settings from the host</li>
<li>Then current software version, terminal ID, and merchant ID will be displayed on screen</li>
</ul>

<p><img src="images/pinpad-info-270x480-e7a16dc0.png" alt="" /></p>
<h4 id='appendix-terminal-configuration-pax-terminals-update-software'>Update software</h4>
<p>The terminal will periodically connect to the host and update to the configured software version. </p>

<p>To force a software update:</p>

<ul>
<li>Launch the Satellite payment app</li>
<li>Tap the settings icon (⚙) at the top of the screen</li>
<li>Enter <code>0000</code> as the merchant password</li>
<li>Select the <code>SOFTWARE UPGRADE</code> option and select <code>YES</code> on the confirmation dialog</li>
<li>The software will be downloaded, and Satellite will restart</li>
</ul>
<h4 id='appendix-terminal-configuration-pax-terminals-checking-wi-fi-connection'>Checking Wi-Fi connection</h4>
<p>To check Wi-FI connection status at any time:</p>

<ul>
<li>Swipe down from the top of the screen to open the notification shade</li>
<li>Swipe down again to expand the notification shade</li>
<li>Top left icon will be your Wi-Fi status and connected access point</li>
</ul>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">JSON</a>
                <a href="#" data-language-name="java">Java</a>
          </div>
      </div>
    </div>
  </body>
</html>
